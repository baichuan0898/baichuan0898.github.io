{
    "version": "https://jsonfeed.org/version/1",
    "title": "Cocoa with Love",
    "home_page_url": "https://www.cocoawithlove.com/",
    "feed_url": "https://www.cocoawithlove.com/feed.json",
    "author": {
        "name": "Matt Gallagher"
    },
    "items": [
        
         {
            "title": "Model-View-Controller without the Controller",
            "id": "https://www.cocoawithlove.com/blog/mvc-without-the-c.html",
            "url": "https://www.cocoawithlove.com/blog/mvc-without-the-c.html",
            "content_html": "\n\n\u003cp\u003e\u003ca href=\"/blog/a-view-construction-syntax.html\"\u003eIn the previous article\u003c/a\u003e, I presented a syntax for constructing views in a self-contained expression. The syntax comes from my upcoming CwlViews library, which I hope to release in a few weeks; but in the meantime, I wanted to take a look at the effect this syntax has on the application design pattern.\u003c/p\u003e\n\n\u003cp\u003eView construction syntax might seem like a trivial matter of aesthetics but an app built around the syntax I presented ends up with some dramatic changes: it makes all state changes naturally unidirectional and eliminates the controller role from the application design pattern. Given that controllers are probably the \u003cem\u003emost\u003c/em\u003e prominent aspect of Cocoa app programming, their removal constitutes a substantial change.\u003c/p\u003e\n\n\u003cp\u003eWhich raises the question: what do you have left if you remove the Controller from the Cocoa Model-View-Controller pattern?\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eBook announcement!\u003c/strong\u003e I\u0026rsquo;m writing a book with two other amazing developers, \u003ca href=\"https://twitter.com/chriseidhof\"\u003eChris Eidhof\u003c/a\u003e and \u003ca href=\"https://twitter.com/floriankugler\"\u003eFlorian Kugler\u003c/a\u003e from \u003ca href=\"https://www.objc.io\"\u003eobjc.io\u003c/a\u003e, titled \u003ca href=\"https://www.objc.io/books/app-architecture/\"\u003e\u003cstrong\u003eApp Architecture\u003c/strong\u003e\u003c/a\u003e. It will cover a range of conventional and experimental application design patterns and architectural techniques – including the application design pattern described in this article. The book is \u003ca href=\"https://www.objc.io/books/app-architecture/\"\u003e\u003cstrong\u003eavailable now\u003c/strong\u003e in Early Access\u003c/a\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\n\u003ch2 id=\"background\"\u003eBackground\u003c/h2\u003e\n\n\u003cp\u003eI\u0026rsquo;ve previously described \u0026ldquo;ideal\u0026rdquo; Model-View-Controller as any implementation where model changes take the path shown in the following diagram:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/blog/ideal_mvc.svg\" alt=\"\" /\u003e\u003c/p\u003e\n\n\u003cfigcaption\u003eIdeal data-flow path in a Model-View-Controller application\u003c/figcaption\u003e\n\n\u003cp\u003eWhy do I consider this \u0026ldquo;ideal\u0026rdquo;? I explain the reasons in \u003ca href=\"/blog/worst-possible-application.html\"\u003eThe worst possible application\u003c/a\u003e; a good application requires a cleanly separately model and view and a cleanly separated model must be passively observed (instead of \u0026ldquo;getting\u0026rdquo; data imperatively) to maintain its abstraction. Invoking actions and passively observing creates this \u003cem\u003efeedback loop\u003c/em\u003e between the view and the model.\u003c/p\u003e\n\n\u003cp\u003eIn \u003ca href=\"/blog/view-state-driven-applications.html\"\u003eView-state driven applications\u003c/a\u003e, I talked about the benefits of making view-state (not just document state) go through this same loop. Making view-state and document-state go through a loop like this is sometimes called \u0026ldquo;unidirectional data flow\u0026rdquo; because changes go in just one direction (no shortcuts and no doubling back).\u003c/p\u003e\n\n\u003cp\u003eThere are multiple frameworks for enforcing unidirectional data flow on other platforms – Elm, Flux, Redux, etc. These usually model their state as a \u0026ldquo;reducer\u0026rdquo;. I\u0026rsquo;ve previously \u003ca href=\"/blog/statements-messages-reducers.html\"\u003etalked about reducers\u003c/a\u003e – they\u0026rsquo;re functions that take message inputs, update state and emit notifications. Their key advantage is that they\u0026rsquo;re isolated; they can run in their own execution context, interacting with the rest of the program only via inputs and notifications. Common frameworks for unidirectional data flow tend use use a single change pipeline that invokes all reducers as part of a managed approach to changes.\u003c/p\u003e\n\n\u003cp\u003eMy \u003ca href=\"/blog/statements-messages-reducers.html\"\u003eView-state driven pattern\u003c/a\u003e (MVC+ViewState) offered a more lightweight approach to unidirectional data flow – deliberately avoiding reliance on any larger framework or global pipeline. Instead, MVC+ViewState added a separate View-state model to the standard MVC pattern and pushed view-state through that model using the same techniques used for the regular model. However, manually maintaining a separate View-state model doubled the observation work and coordinating views dependent on state from both models were clear drawbacks.\u003c/p\u003e\n\n\u003ch2 id=\"a-simple-view-controller-in-cocoa-mvc\"\u003eA simple view controller in Cocoa MVC\u003c/h2\u003e\n\n\u003cp\u003eI\u0026rsquo;ll come back to the ideas of view-state and unidirectional data flow but first, I want to discuss the role of view controller in a simple Cocoa Model-View-Controller application.\u003c/p\u003e\n\n\u003cp\u003eFor this, I\u0026rsquo;ll look at the MVC (non-View-state) version of \u003ca href=\"/blog/view-state-driven-applications.html\"\u003ethe \u0026ldquo;Clocks\u0026rdquo; app I presented a couple of months ago\u003c/a\u003e. The app has a \u0026ldquo;Select Timezone\u0026rdquo; screen that looks like this:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/blog/clocks3.png\" alt=\"Clocks app MasterViewController\" /\u003e\u003c/p\u003e\n\n\u003cfigcaption\u003eThe \"Select Timezone\" screen in the Clocks app\u003c/figcaption\u003e\n\n\u003cp\u003eThis screen is a basic table view showing plain text rows, backed by a view controller named \u003ccode\u003eSelectTimezoneViewController\u003c/code\u003e. The table view is populated by the standard \u003ccode\u003eUITableViewDataSource\u003c/code\u003e and \u003ccode\u003eUITableViewDelegate\u003c/code\u003e methods:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003erows\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTimeZone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eknownTimeZoneIdentifiers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003esorted\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003enumberOfSections\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUITableView\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUITableView\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enumberOfRowsInSection\u003c/span\u003e \u003cspan class=\"n\"\u003esection\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003erows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003ecount\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUITableView\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecellForRowAt\u003c/span\u003e \u003cspan class=\"n\"\u003eindexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIndexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eUITableViewCell\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ecell\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edequeueReusableCell\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithIdentifier\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;textRow\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eindexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"n\"\u003ecell\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etextLabel\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erows\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ecell\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis is about as simple as \u003ccode\u003eUITableViewDataSource\u003c/code\u003e and \u003ccode\u003eUITableViewDelegate\u003c/code\u003e method implementations can get: a fixed single section is specified, the number of rows for the section comes from the \u003ccode\u003erows\u003c/code\u003e array, a \u003ccode\u003eUITableViewCell\u003c/code\u003e with identifier \u003ccode\u003e\u0026quot;textRow\u0026quot;\u003c/code\u003e is constructed and the cell\u0026rsquo;s \u003ccode\u003etextLabel\u003c/code\u003e is configured with a value from the \u003ccode\u003erows\u003c/code\u003e array.\u003c/p\u003e\n\n\u003cp\u003eThe scene also includes a search field. In the storyboard for this scene, the \u003ccode\u003edelegate\u003c/code\u003e of the search field is set to the \u003ccode\u003eSelectTimezoneViewController\u003c/code\u003e and the following \u003ccode\u003eUISearchBarDelegate\u003c/code\u003e function is called when the search text changes:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003esearchBar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003esearchBar\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUISearchBar\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etextDidChange\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etextDidChange\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elowercased\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n   \u003cspan class=\"n\"\u003erows\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTimeZone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eknownTimeZoneIdentifiers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003esorted\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"bp\"\u003efilter\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n      \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eisEmpty\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elowercased\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eof\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereloadData\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis recreates and filters the timezone identifiers, producing a new \u003ccode\u003erows\u003c/code\u003e array and reloads the table data.\u003c/p\u003e\n\n\u003cp\u003eFinally, since the purpose of the scene is to select timezone identifiers and add timezones to the model, it\u0026rsquo;s necessary to handle row selection:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUITableView\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edidSelectRowAt\u003c/span\u003e \u003cspan class=\"n\"\u003eindexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIndexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eindexPath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eindexPathForSelectedRow\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003erows\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eindices\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003econtains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaddTimezone\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erows\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"n\"\u003epresentingViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003edismiss\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eanimated\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecompletion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhen a row is selected, two separate actions occur:\u003ccode\u003eaddTimezone\u003c/code\u003e is called on the \u003ccode\u003eDocument\u003c/code\u003e and the entire \u0026ldquo;Select Timezone\u0026rdquo; modal presentation is dismissed.\u003c/p\u003e\n\n\u003cp\u003eAll of the code I have shown for the \u0026ldquo;Select Timezone\u0026rdquo; scene is implemented on a single view controller. This is the standard Cocoa MVC approach for this type of scene.\u003c/p\u003e\n\n\u003ch2 id=\"implementing-the-same-code-with-cwlviews\"\u003eImplementing the same code with CwlViews\u003c/h2\u003e\n\n\u003cp\u003eI now want to look at how this same code would be implemented in CwlViews. The code will need to fulfill the same roles of:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eDefine the section and row structure of the table view\u003c/li\u003e\n\u003cli\u003eConstruct cells from the row data\u003c/li\u003e\n\u003cli\u003eWhen the search text changes, sort and filter the timezone identifiers and refresh the display\u003c/li\u003e\n\u003cli\u003eWhen a row is selected, add the timezone to the document and dismiss the modal presentation.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eHere\u0026rsquo;s the code:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSelectState\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"bp\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSplitState\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003edoc\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eDocumentAdapter\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTableView\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eTableView\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etableData\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esearch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n         \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elowercased\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n         \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eTimeZone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eknownTimeZoneIdentifiers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003esorted\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"bp\"\u003efilter\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n            \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eisEmpty\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elowercased\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eof\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e}.\u003c/span\u003e\u003cspan class=\"n\"\u003etableData\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecellIdentifier\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003erowDescription\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etextRowIdentifier\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecellConstructor\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ecellIdentifier\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003erowData\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n         \u003cspan class=\"n\"\u003eTableViewCell\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003etextLabel\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eLabel\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003erowData\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edidSelectRow\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003emulticast\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n         \u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003efilterMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erowData\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}.\u003c/span\u003e\u003cspan class=\"n\"\u003ebind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003edoc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n         \u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e}.\u003c/span\u003e\u003cspan class=\"n\"\u003ebind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"bp\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e\u003cstrong\u003eThere\u0026rsquo;s no view controller\u003c/strong\u003e. This one code sample includes all the functionality of the previous three Swift code samples but the functionality is implemented by attaching behaviors directly to the table view, itself.\u003c/p\u003e\n\n\u003cp\u003eYou can probably see the sorting and filtering of the \u003ccode\u003eknownTimeZoneIdentifiers\u003c/code\u003e in the middle of this example – it\u0026rsquo;s largely unchanged from before – but I\u0026rsquo;ll probably need to explain the remaining details.\u003c/p\u003e\n\n\u003cp\u003eUnderstanding what\u0026rsquo;s happening involves learning about the two key components of CwlViews: \u003cstrong\u003eview-binders\u003c/strong\u003e and \u003cstrong\u003emodel-adapters\u003c/strong\u003e.\u003c/p\u003e\n\n\u003ch2 id=\"view-binders\"\u003eView-binders\u003c/h2\u003e\n\n\u003cp\u003eThis code uses the type names \u003ccode\u003eTableView\u0026lt;String\u0026gt;\u003c/code\u003e, \u003ccode\u003eTableViewCell\u003c/code\u003e and \u003ccode\u003eLabel\u003c/code\u003e instead of \u003ccode\u003eUITableView\u003c/code\u003e, \u003ccode\u003eUITableViewCell\u003c/code\u003e or \u003ccode\u003eUILabel\u003c/code\u003e. These type names are the view-binders for their respective views.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eView-binders\u003c/strong\u003e in CwlViews are the constructors of underlying view objects. They fully describe the view through a series of \u0026ldquo;bindings\u0026rdquo; (either constant values, closures or reactive programming signals). You can call \u003ccode\u003einstance()\u003c/code\u003e on the view-binder to force construction of the underlying view but in general, this will happen automatically when the view-binder is used by a parent so you don\u0026rsquo;t generally do it yourself.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThe structure of the table – the sections and rows – are specified by applying the function \u003ccode\u003e.tableData()\u003c/code\u003e to the end of the sorted, filtered \u003ccode\u003eTimeZone.knownTimeZoneIdentifiers\u003c/code\u003e array transformation. This is a convenience function provided by CwlViews to turn an array into a \u003ccode\u003eTableData\u0026lt;RowData\u0026gt;\u003c/code\u003e structure that describes a single-section, static table view. In this case, the \u003ccode\u003eRowData\u003c/code\u003e is a \u003ccode\u003eString\u003c/code\u003e, since the rows are the string timezone identifiers. The same structure can describe mutable animatable table rows and sections but those features are not needed, here.\u003c/p\u003e\n\n\u003cp\u003eThe \u003ccode\u003e.cellIdentifier\u003c/code\u003e and \u003ccode\u003e.cellConstructor\u003c/code\u003e closures together specify the same construction of the \u003ccode\u003eUITableViewCell\u003c/code\u003e that we performed in \u003ccode\u003etableView(_:,cellForRowAt:)\u003c/code\u003e in the MVC version.\u003c/p\u003e\n\n\u003cp\u003eThe \u003ccode\u003e.didSelectRow\u003c/code\u003e binding handles the same work as the \u003ccode\u003etableView(_:,didSelectRowAt:)\u003c/code\u003e from the MVC version. Since this one binding needs to handle two actions (adding the timezone identifier to the model and dismissing the modal selection view controller), a \u003ccode\u003emulticast\u003c/code\u003e is used, which splits the single \u003ccode\u003eInput\u003c/code\u003e into two: an \u003ccode\u003e.add\u003c/code\u003e message sent to the \u003ccode\u003edoc\u003c/code\u003e (which will create the new timezone entry in the document) and a \u003ccode\u003enil\u003c/code\u003e message sent to the \u003ccode\u003esplit.select\u003c/code\u003e variable (the \u0026ldquo;Select Timezone\u0026rdquo; modal presentation is constructed from this view-state variable in the parent split view so setting the variable to \u003ccode\u003enil\u003c/code\u003e implicitly clears the modal presentation).\u003c/p\u003e\n\n\u003ch2 id=\"model-adapters\"\u003eModel-adapters\u003c/h2\u003e\n\n\u003cp\u003eI want to talk a little about \u003cem\u003estate\u003c/em\u003e. All mutable state in CwlView must be wrapped in what CwlViews calls model-adapters.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eModel-adapters\u003c/strong\u003e are a concept that CwlViews provides for handling the \u003cem\u003emodel\u003c/em\u003e-end of bindings. A model-adapter is any object that internally wraps and maintains a state value internally – using a reducer – and externally exposes reactive programming inputs and outputs.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"aside\"\u003e\u003cstrong\u003eCompared to view-binders:\u003c/strong\u003e model-adapters expose a bindable interface (so you can attach bindings after construction) whereas view-binders consume bindings on construction (their bindable properties are concealed internally).\u003c/div\u003e\n\n\u003cp\u003eExamples of model-adapters in the \u003ccode\u003etableView\u003c/code\u003e construction example include the \u003ccode\u003eDocumentAdapter\u003c/code\u003e and the \u003ccode\u003eselect.search\u003c/code\u003e and \u003ccode\u003esplit.select\u003c/code\u003e properties. All properties and parameters in CwlViews are expected to be either immutable or wrapped in a model-adapter so the remaining parameters – the \u003ccode\u003eSelectState\u003c/code\u003e and \u003ccode\u003eSplitState\u003c/code\u003e objects which contain the \u003ccode\u003esearch\u003c/code\u003e and \u003ccode\u003eselect\u003c/code\u003e properties – are immutable model structs (technically, they are emitted from model-adapters higher up in the view-state hierarchy but that\u0026rsquo;s not relevant here).\u003c/p\u003e\n\n\u003cp\u003eThis expectation that model-adapters must wrap all mutable state might seem restrictive but it turns out to be entirely pragmatic:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003ethe only possible mutations on a view-binder are through bindings\u003c/li\u003e\n\u003cli\u003ebindings on a view-binder need to connect to other objects\u003c/li\u003e\n\u003cli\u003ethe other objects must expose a bindable interface to work with bindings\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eA model-adapter is any stateful object that exposes a bindable interface allowing it to be the \u0026ldquo;other object\u0026rdquo;.\u003c/p\u003e\n\n\u003cp\u003eThe most important model-adapter to the \u0026ldquo;Select Timezone\u0026rdquo; scene is the \u003ccode\u003eselect.search\u003c/code\u003e object that represents the contents of the search field. This property is referenced in the \u003ccode\u003etableView\u003c/code\u003e construction code and is an example of the most common kind of model-adapter, the \u003ccode\u003eVar\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003esearch\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eVar\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eA \u003ccode\u003eVar\u003c/code\u003e is a model-adapter with \u0026ldquo;set\u0026rdquo; semantics – a basic setter where any value you send it replaces the existing value. You can see how this \u003ccode\u003esearch\u003c/code\u003e property is \u0026ldquo;set\u0026rdquo; by looking at the construction of the \u003ccode\u003eSearchBar\u003c/code\u003e for the \u0026ldquo;Select Timezone\u0026rdquo; scene:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003esearchBar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSelectState\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eSearchBarConstructor\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eSearchBar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esearch\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edidChange\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esearch\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhen the search bar changes, it emits a value through the \u003ccode\u003e.didChange\u003c/code\u003e binding and \u003ccode\u003eselect.search\u003c/code\u003e is set. If \u003ccode\u003eselect.search\u003c/code\u003e changes, it will emit a value through its output to the \u003ccode\u003e.text\u003c/code\u003e binding, updating the search bar (\u003ccode\u003e.didChange\u003c/code\u003e won\u0026rsquo;t be called if the value is unchanged, so this configuration won\u0026rsquo;t cause an infinite loop).\u003c/p\u003e\n\n\u003ch2 id=\"feedback-loops-and-unidirectional-data-flow\"\u003eFeedback loops and unidirectional data flow\u003c/h2\u003e\n\n\u003cp\u003eThe search bar example shows the full view/model feedback loop that I diagrammed at the top of this article: \u003ccode\u003eSearchBar.didChange\u003c/code\u003e \u0026rarr; \u003ccode\u003eSelectState.search\u003c/code\u003e (input) \u0026rarr; \u003ccode\u003eSelectState.search\u003c/code\u003e (output) \u0026rarr; \u003ccode\u003eSearchBar.text\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eI mentioned briefly in the \u003ca href=\"#background\"\u003eBackground\u003c/a\u003e that having all view outputs go via the model and all view inputs come from the model is sometimes called \u0026ldquo;unidirectional data flow\u0026rdquo;. In Elm/Flux/Redux, this path is enforced by the framework. In the \u003ca href=\"/blog/view-state-driven-applications.html\"\u003eMVC+ViewState approach I presented in the Clocks app\u003c/a\u003e it was enforced through manual effort.\u003c/p\u003e\n\n\u003cp\u003eIn CwlViews, all view-state is naturally handled on its own very simple, unidirectional view/model feedback loops. It\u0026rsquo;s an emergent effect of the syntax requiring neither framework enforcement nor significant vigilance.\u003c/p\u003e\n\n\u003ch2 id=\"controller-or-bindings-does-it-matter\"\u003eController or bindings, does it matter?\u003c/h2\u003e\n\n\u003cp\u003eSo I made a dramatic statement in the introduction that this pattern eliminates the controller – but it doesn\u0026rsquo;t really eliminate the \u003cem\u003ework\u003c/em\u003e, it just moves that work down into bindings on each view. It\u0026rsquo;s reasonable to ask: why does it matter if they\u0026rsquo;re implemented in bindings or if they\u0026rsquo;re implemented in methods on a controller?\u003c/p\u003e\n\n\u003cp\u003eThe biggest reason why bindings are an improvement is that bindings don\u0026rsquo;t share state and they can\u0026rsquo;t depend on each other. Bindings can depend on their source-end but they can\u0026rsquo;t depend on anything else. Bindings avoid unwanted interdependence.\u003c/p\u003e\n\n\u003cp\u003eUsing regular Cocoa view-controller subclasses without bindings, you can keep behaviors independent – if you\u0026rsquo;re disciplined – but there\u0026rsquo;s no syntax to enforce this or framework help to ensure it, so dependencies and other interference creep in. Non-trivial controllers are typically filled with shared state, manually propagated dependencies and expectations of sequentiality between different actions. In many cases, the size of larger view controllers is enough to create \u003cem\u003evisual\u003c/em\u003e interference between behaviors.\u003c/p\u003e\n\n\u003cp\u003eInterference between behaviors in view controllers causes code complexity to grow in a greater-than-linear way per new behavior. Along with the significant over-assignment of responsibilities to a small number of view controllers in Cocoa MVC, this leads to the problem jokingly called \u0026ldquo;Massive-View-Controller\u0026rdquo; (using the same \u0026ldquo;MVC\u0026rdquo; acronym) where Cocoa view controllers are overloaded with behaviors and each new behavior is increasingly fragile, slowing development and requiring continuous refactoring.\u003c/p\u003e\n\n\u003ch2 id=\"scalability-view-models-and-testing\"\u003eScalability, view-models and testing\u003c/h2\u003e\n\n\u003cp\u003eMost MVC alternatives attempt to address controller complexity issues by adding separate roles to the application design pattern that split the controller into multiple smaller objects. CwlViews does almost the \u003cem\u003eopposite\u003c/em\u003e – it eliminates the controller and throws everything into a single large expression.\u003c/p\u003e\n\n\u003cp\u003eAt first glance, this might seem ridiculous; how is a single expression more scalable than an entire class? Or cluster of classes?\u003c/p\u003e\n\n\u003cp\u003eThe truth is that the CwlViews approach isn\u0026rsquo;t about forcing everything into a single expression. The point about declarative expressions like CwlViews\u0026rsquo; construction is that it is easily \u003cem\u003edecomposable\u003c/em\u003e. You can build your view-binders however you choose and break functionality out into its own function as it grows.\u003c/p\u003e\n\n\u003cp\u003eIn fact, the \u003ccode\u003etableView\u003c/code\u003e and \u003ccode\u003esearchBar\u003c/code\u003e functions I\u0026rsquo;ve already shown are themselves broken out of the construction of the overall scene because I think it looks better to keep the construction of components separate from the layout of those components:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebarTint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elayout\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertical\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enavBar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esearchBar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efillRemaining\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"bp\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edoc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003eThis code sample does reveal something else: the \u003ccode\u003eViewController\u003c/code\u003e is not totally \u003cem\u003egone\u003c/em\u003e in CwlViews. \u003ccode\u003eViewController\u003c/code\u003es are still used for their role in swapping in and out sections of the view-tree. However, they don\u0026rsquo;t have many other responsibilities. Notice that the only binding used here for the \u003ccode\u003eViewController\u003c/code\u003e is to specify its child \u003ccode\u003e.view\u003c/code\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eIt\u0026rsquo;s not just child views that you can easily move out of the construction syntax to their own locations. Imagine that you decided the \u003ccode\u003e.tableData\u003c/code\u003e binding transformation that I showed previously during the \u003ccode\u003eTableView\u003c/code\u003e construction:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etableData\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esearch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elowercased\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eTimeZone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eknownTimeZoneIdentifiers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003esorted\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"bp\"\u003efilter\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n      \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eisEmpty\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elowercased\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eof\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}.\u003c/span\u003e\u003cspan class=\"n\"\u003etableData\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ewas growing too large.\u003c/p\u003e\n\n\u003cp\u003eThe decomposeable nature of CwlViews\u0026rsquo; declarative syntax means that it is trivial to pull this code out and put it somewhere else. The most natural place to move a transformation like this is into a \u003ccode\u003evar\u003c/code\u003e or \u003ccode\u003efunc\u003c/code\u003e on the model-adapters whose properties the transformation processes.\u003c/p\u003e\n\n\u003cp\u003eFor example, you could move this transformation into a \u003ccode\u003evar\u003c/code\u003e on the \u003ccode\u003eSelectState\u003c/code\u003e view-state adapter where the \u003ccode\u003esearch\u003c/code\u003e property resides:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003etableData\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSignal\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTableData\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003esearch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n      \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elowercased\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eTimeZone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eknownTimeZoneIdentifiers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003esorted\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"bp\"\u003efilter\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n         \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eisEmpty\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elowercased\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003erange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eof\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}.\u003c/span\u003e\u003cspan class=\"n\"\u003etableData\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWith this property in-place, the code at the binding location is reduced to:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etableData\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etableData\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhen you add this type of transformation to the view-state adapter, the effect starts to get very similar to a \u003cstrong\u003epresentation model\u003c/strong\u003e, also known as \u003cstrong\u003eview-model\u003c/strong\u003e (a representation of state from the model, combined with partial state from the view that encodes the presentation and interaction logic of the view). You can also move these transformations to the main document adapter. In that scenario, these transformations start to look like \u003cstrong\u003euse-cases\u003c/strong\u003e (specialized slices of the model as needed by views within the app).\u003c/p\u003e\n\n\u003cp\u003eBy lifting transformation logic out of the view-binder and up into model-adapters, you can make specialized versions that further transform more general versions so that the appropriate level of abstraction and transformation is provided and the whole architecture scales as needed.\u003c/p\u003e\n\n\u003cp\u003eThe question is: should all transformations be lifted out to form a complete presentation-model in all cases? The Model-View-ViewModel pattern suggests this approach because the presentation-model can be used as a testable interface for testing the logic and state of the entire view.\u003c/p\u003e\n\n\u003cp\u003eWhile you could do this in CwlViews if you wanted, the reality is that a manually created presentation-model isn\u0026rsquo;t necessary for testing because the view-binder already makes it possible to access the presentation and interaction logic.\u003c/p\u003e\n\n\u003cp\u003eFor example, if we wanted to test that the correct \u003ccode\u003e.cellIdentifier\u003c/code\u003e binding was used in the table view returned from our \u003ccode\u003etableView\u003c/code\u003e construction function, we could write the following test:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etestTableViewCellIdentifier\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"c1\"\u003e// Create the inputs\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eselect\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSelectState\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003esplit\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSplitState\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003edoc\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDocumentAdapter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n   \n   \u003cspan class=\"c1\"\u003e// Call our tableView function to create the view-binder then extract the bindings\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ebindings\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"bp\"\u003esplit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edoc\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003econsumeBindings\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n   \n   \u003cspan class=\"c1\"\u003e// Select the binding we want\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003eTableRowDescription\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e?)?\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n   \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ebindings\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecellIdentifier\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n         \u003cspan class=\"n\"\u003efunction\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\n         \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \n   \u003cspan class=\"c1\"\u003e// Test the result\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e?(\u003c/span\u003e\u003cspan class=\"n\"\u003eTableRowDescription\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIndexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003erowData\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eXCTAssert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eresult\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;textRow\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI should probably build some helper functions to simplify this type of scenrio a little but the premise is clear: you can ask a view-binder for its bindings and test them in the same way that you would test the observable properties of a view-model.\u003c/p\u003e\n\n\u003ch2 id=\"what-s-the-result\"\u003eWhat\u0026rsquo;s the result?\u003c/h2\u003e\n\n\u003cp\u003eGetting back to the initial question I posed: what do you have left if you remove the Controller from the Cocoa Model-View-Controller pattern?\u003c/p\u003e\n\n\u003cp\u003eTaken literally, the simplest name would be Model-View – and it wouldn\u0026rsquo;t be \u003cem\u003ewrong\u003c/em\u003e since everything except the bindings in this approach is either a model-layer object or a view-layer object. But I have spent too many years writing in MFC\u0026rsquo;s Document-View, which sounds a lot like Model-View and whose defining aspect is that the whole program is coordinated from the window\u0026rsquo;s message queue. I hardly want to court comparison with that.\u003c/p\u003e\n\n\u003cp\u003eWith \u0026ldquo;bindings\u0026rdquo; forming such a significant part of this pattern – largely replacing the Controller from Model-View-Controller – it would be natural to describe this pattern as Model-View-Bindings but unfortunately, Model-View-Binder is already a synonym for Model-View-ViewModel on some platforms. Probably better to avoid confusion.\u003c/p\u003e\n\n\u003cp\u003eUltimately, since I\u0026rsquo;ve taken to describing the pattern with the following diagram:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/blog/mavb.svg\" alt=\"\" /\u003e\u003c/p\u003e\n\n\u003cfigcaption\u003eThe CwlViews application design pattern\u003c/figcaption\u003e\n\n\u003cp\u003eI\u0026rsquo;ve been calling the pattern ModelAdapter-ViewBinder (MAVB).\u003c/p\u003e\n\n\u003cp\u003eYeah, it\u0026rsquo;s a bit of a word-salad but I persuaded my co-authors \u003ca href=\"https://www.objc.io/books/app-architecture/\"\u003eApplication Architecture\u003c/a\u003e to let me put this crazy idea into the book (because I\u0026rsquo;ve been having so much fun with it), so I figured I should give it a name.\u003c/p\u003e\n\n\u003ch2 id=\"view-the-code\"\u003eView the code\u003c/h2\u003e\n\n\u003cp\u003eYou can view the \u003ca href=\"https://github.com/mattgallagher/Clocks/blob/undoredo/Clocks/SelectTimezoneViewController.swift?ts=3\"\u003eoriginal MVC version of the \u0026ldquo;SelectTimezoneViewController.swift\u0026rdquo; file\u003c/a\u003e on the \u003ca href=\"https://github.com/mattgallagher/Clocks/tree/undoredo\"\u003eundoredo branch of the Clocks repository\u003c/a\u003e on github. It\u0026rsquo;s received some touch-ups since I released the code in November but most of the project is unchanged.\u003c/p\u003e\n\n\u003cp\u003eYou can also view the \u003ca href=\"https://github.com/mattgallagher/Clocks/blob/cwlviews/Clocks/SelectView.swift?ts=3\"\u003eCwlViews version of the \u0026ldquo;SelectView.swift\u0026rdquo; file\u003c/a\u003e on the \u003ca href=\"https://github.com/mattgallagher/Clocks/tree/cwlviews\"\u003ecwlviews branch of the Clocks repository\u003c/a\u003e on github.\u003c/p\u003e\n\n\u003cp\u003eThe CwlViews version is a complete project, showing much more of CwlViews than I\u0026rsquo;ve revealed here. It also fully implements user-interface time-travel, like the View-state driven \u0026ldquo;master\u0026rdquo; branch.\u003c/p\u003e\n\n\u003cp\u003eBut at the moment, the CwlViews version won\u0026rsquo;t actually build. It will give errors similar to:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eerror: failed to clone; Cloning into bare repository '/Users/matt/Library/Developer/Xcode/DerivedData/Clocks-euhvzfgwykqqnrblysttdbspzjie/Build/Intermediates.noindex/repositories/CwlViews.git-1609764927845648232'...\nremote: Repository not found.\nfatal: repository 'https://github.com/mattgallagher/CwlViews.git/' not found\nerror: swift package resolve failed\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003ebecause there is no repository at \u003ca href=\"https://github.com/mattgallagher/CwlViews.git\"\u003ehttps://github.com/mattgallagher/CwlViews.git\u003c/a\u003e yet.\u003c/p\u003e\n\n\u003cp\u003eI\u0026rsquo;m still working on some final details before I release it publicly in a few weeks. Assuming I have the details right then this Clocks version will build correctly once I push CwlViews to github.\u003c/p\u003e\n\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\n\u003cp\u003eI started CwlViews by looking for a better view construction syntax. It\u0026rsquo;s interesting how a change to something as seemingly superficial as syntax has deep effects on the overall structure of a Cocoa application.\u003c/p\u003e\n\n\u003cp\u003eThe controller layer – the most prominent layer of Cocoa\u0026rsquo;s Model-View-Controller pattern – is eliminated as an architectural component and reduced to a trivial member of the view layer. The behaviors previously implemented on the view controller are moved into bindings on the views themselves.\u003c/p\u003e\n\n\u003cp\u003eEven this change is not a mere rearrangement. Moving behaviors into bindings keeps them independent, helping complexity to scale linearly with each additional behavior, instead of the greater-than-linear complexity scaling in typical view controllers. Additionally, the overall construction is arbitrarily decomposable as needed.\u003c/p\u003e\n\n\u003cp\u003eThe architecture is naturally unidirectional. This happens without a global driver to keep the application on a single pipeline or any need for constant discipline. It happens naturally since you need to give view-bindings both a view-end and a model-end.\u003c/p\u003e\n\n\u003cp\u003eUnder all of this: the underlying view objects and underlying model objects are unchanged. It\u0026rsquo;s all still standard Cocoa views and the model object is unchanged, it\u0026rsquo;s just the construction and wrapping that have changed.\u003c/p\u003e\n\n\u003ch3 id=\"looking-forward\"\u003eLooking forward\u0026hellip;\u003c/h3\u003e\n\n\u003cp\u003eI should probably just release CwlViews already.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eSelf promotion? On my own blog?!\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eThe ModelAdapter-ViewBinder pattern, along with other experimental and conventional patterns and architectural techniques, are examined in depth in a book I\u0026rsquo;m writing, with \u003ca href=\"https://twitter.com/chriseidhof\"\u003eChris Eidhof\u003c/a\u003e and \u003ca href=\"https://twitter.com/floriankugler\"\u003eFlorian Kugler\u003c/a\u003e from \u003ca href=\"https://www.objc.io\"\u003eobjc.io\u003c/a\u003e, titled \u003ca href=\"https://www.objc.io/books/app-architecture/\"\u003eApp Architecture\u003c/a\u003e (iOS Application Patterns in Swift).\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.objc.io/books/app-architecture/\"\u003e\u003cimg src=\"/assets/blog/app_architecture.png\" alt=\"App Architecture\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.objc.io/books/app-architecture/\"\u003eYou can \u003cstrong\u003eorder now\u003c/strong\u003e in Early Access to get the first chapter immediately and subsequent chapters as they\u0026rsquo;re released\u003c/a\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n",
            "date_published": "2018-01-20T15:21:40+10:00"
        }
        
        , {
            "title": "A view construction syntax",
            "id": "https://www.cocoawithlove.com/blog/a-view-construction-syntax.html",
            "url": "https://www.cocoawithlove.com/blog/a-view-construction-syntax.html",
            "content_html": "\n\n\u003cp\u003eIn this article, I\u0026rsquo;m going to look at constructing Cocoa views in code.\u003c/p\u003e\n\n\u003cp\u003eOn its own, that\u0026rsquo;s not a particularly daring idea but I\u0026rsquo;m going to use a unique syntax to aid the process:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eenabled\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis code trades conventional \u003ccode\u003eparameter: value\u003c/code\u003e syntax for a custom \u003ccode\u003e.parameter -- value\u003c/code\u003e syntax and uses this change to offer a few advantages: dynamic and constant options with no syntactic overhead, support for parameters inherited through the class hierarchy, support for large numbers of optional parameters without needing to push unused parameters onto the stack, avoidance of parentheses, and avoiding the need to specify types – all while remaining completely typesafe.\u003c/p\u003e\n\n\u003cp\u003eI\u0026rsquo;ll be looking at how this syntax is implemented and the various tricks it uses to make the Swift type system do all the menial work.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThis article is a sneak peek at one of the key ideas in an upcoming library named CwlViews that should be available soon. A \u003ca href=\"https://github.com/mattgallagher/CocoaWithLovePlaygrounds\"\u003eViewConstruction.playground is available right now\u003c/a\u003e, so you can play with the examples presented in this article.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\n\u003ch2 id=\"aim\"\u003eAim\u003c/h2\u003e\n\n\u003cp\u003eIn an app wireframe (a rough layout of a user-interface provided by the graphic artist or user-experience designer), a \u003ccode\u003eUITextField\u003c/code\u003e might be appear as a simple box. The wireframe usually gives (or implies) the layout constraints required for the text field but otherwise might not offer any information about the \u003cem\u003ebehaviors\u003c/em\u003e of the text field.\u003c/p\u003e\n\n\u003cp\u003eWhen implementing user interfaces, before I start coding, I normally go through the wireframes and break down each element of the user interface with descriptions that look like this:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003enameField: UITextField\n   - borderStyle: `.roundRect`\n   - isEnabled:\n      `true` if `personViewState.isEditing` is `true`, otherwise `false`\n   - backgroundColor:\n      `.white` while `personViewState.isEditing` is `true`, otherwise `.lightGray`\n   - text:\n      - `name` value of `Person` object in `Document` where `id`==`personViewState.id`\n   - on UITextFieldDidChange:\n      - set `name` value of `Person` object in `Document` where\n        `id`==`personViewState.id` to the value of `text`\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eI write this type of description because it\u0026rsquo;s how I mentally consider the properties of the view. It\u0026rsquo;s really just a list of view properties and the behaviors I want them to have. Structurally, it resembles a property list, similar to YAML or other text-based property formats. The precise syntax involved isn\u0026rsquo;t as important as the relatively simple structure.\u003c/p\u003e\n\n\u003cp\u003eIdeally, I would like my view construction code to look as close to this description as possible.\u003c/p\u003e\n\n\u003cp\u003eAs we\u0026rsquo;ll see though, typical Cocoa view construction code looks \u003cem\u003enothing\u003c/em\u003e like this.\u003c/p\u003e\n\n\u003ch2 id=\"interface-builder\"\u003eInterface Builder?\u003c/h2\u003e\n\n\u003cp\u003eThis article is about building views in code. It\u0026rsquo;s worth briefly discussing \u003cem\u003ewhy\u003c/em\u003e we would construct in Swift code, given that Apple promote construction via Interface Builder as a first choice.\u003c/p\u003e\n\n\u003cp\u003eThe original idea behind Interface Builder was to offer a \u0026ldquo;what-you-see-is-what-you-get\u0026rdquo; editor for pixel-based layout of fixed sized windows and dialogs. The original Interface Builder ran the program, live – so it actually was WYSIWYG – and fixed size windows were the norm. None of this has been true for years.\u003c/p\u003e\n\n\u003cp\u003eInstead, the common uses for Interface Builder are:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003econfiguring auto-layout constraints\u003c/li\u003e\n\u003cli\u003esetting values for \u003cem\u003esome\u003c/em\u003e (but not all) constant properties in Interface Builder\u003c/li\u003e\n\u003cli\u003edefining segues\u003c/li\u003e\n\u003cli\u003esupporting Storyboard-based view-state restoration\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eFor a range of reasons though, none of these are valuable to me.\u003c/p\u003e\n\n\u003cp\u003eOn the first point: I find using specifying individual constraints in Interface Builder is laborious and frustrating. As I mentioned in \u003ca href=\"/blog/cwllayout.html\"\u003eCwlLayout: a Swift wrapper around Auto Layout\u003c/a\u003e, I prefer to specify layout by \u003cem\u003eintent\u003c/em\u003e and let the framework handle specific constraints (as with \u003ccode\u003eUIStackView\u003c/code\u003e or my own CwlLayout).\u003c/p\u003e\n\n\u003cp\u003eOn the second point: the difficult properties to handle are the \u003cem\u003edynamic\u003c/em\u003e properties but Interface Builder helps only with constant properties. Even with constant properties, as my apps grow, I usually end up with pre-prepared sets of properties – \u0026ldquo;Styles\u0026rdquo; – for the views in my app and you can\u0026rsquo;t really do this in Interface Builder, either.\u003c/p\u003e\n\n\u003cp\u003eOn the third point: I \u003cem\u003estrongly\u003c/em\u003e dislike how data is propagated during segues, requiring cooperation between  \u003ccode\u003eperform(segue:)\u003c/code\u003e and \u003ccode\u003eprepare(for:)\u003c/code\u003e and needing one \u003ccode\u003eUIViewController\u003c/code\u003e to push key data to another \u003ccode\u003eUIViewController\u003c/code\u003e \u003cem\u003eafter\u003c/em\u003e construction. This might seem like empty complaining but with data dependencies and data propagation being the single most important pipeline in an application, actively promoting bad practices like cooperative coupling and side-effects is a show stopping issue. Accordingly, I tend not to use segues, in favor of manual \u003ccode\u003eUIViewController\u003c/code\u003e construction and transitions.\u003c/p\u003e\n\n\u003cp\u003eOn the fourth point: if you use a persistent view-state approach, like the \u003ca href=\"/blog/view-state-driven-applications.html\"\u003eModel-View-Controller + ViewState approach I showed in the previous article\u003c/a\u003e, state restoration is already a part of the process, without needing Storyboards or restoration identifiers. So I don\u0026rsquo;t use Storyboard state restoration.\u003c/p\u003e\n\n\u003cp\u003eLike most long-term Cocoa programmers, I\u0026rsquo;ve gone back-and-forth about how much or little to use Interface Builder in my projects. Interface Builder has always been a core component of Cocoa development, as it was a core component of NeXTStep and \u003ca href=\"https://vimeo.com/62618532\"\u003eExperLISP before that\u003c/a\u003e. Writing Cocoa \u0026ldquo;properly\u0026rdquo; has generally involved using Interface Builder in some capacity.\u003c/p\u003e\n\n\u003cp\u003eFor the last few years though, the only argument in favor of Interface Builder has been that constructing Cocoa views in Objective-C/Swift is ugly. It\u0026rsquo;s not technically difficult to construct one or two views in code but the construction involves multiple statements without any obvious structure and as you add more views, the lack of structure leads to messy, hard to read code.\u003c/p\u003e\n\n\u003cp\u003eThe purpose of this article is to talk about the process I\u0026rsquo;ve gone through, trying to building views in Swift code using a clear, structured syntax so it might be a manageable alternative to Interface Builder.\u003c/p\u003e\n\n\u003ch2 id=\"construction-in-normal-cocoa-code\"\u003eConstruction in normal Cocoa code\u003c/h2\u003e\n\n\u003cp\u003eNearly every view can be default constructed:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIt\u0026rsquo;s a zero sized view with no contents and a transparent background – not that you\u0026rsquo;d notice at this point, since it\u0026rsquo;s a zero sized view.\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s set some simple values on this text field so that we can see it:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enameField\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eframe\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eCGRect\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e300\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eheight\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e80\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"n\"\u003enameField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esomeTextValue\u003c/span\u003e\n\u003cspan class=\"n\"\u003enameField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEnabled\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n\u003cspan class=\"n\"\u003enameField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhite\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eImmediately, you can see an inconsistency: some properties can be set through the constructor (in the case of a \u003ccode\u003eUITextField\u003c/code\u003e, the \u003ccode\u003eframe\u003c/code\u003e) but most properties require separate steps.\u003c/p\u003e\n\n\u003cp\u003eThe fact that the \u003ccode\u003eframe\u003c/code\u003e can be set in the \u003ccode\u003eUIView\u003c/code\u003e constructor might make this property appear important but its presence is an anachronism. In an auto-layout world, setting the \u003ccode\u003eframe\u003c/code\u003e is completely useless – layout constraints will totally override any value we set here. We might as well stick with the default constructor.\u003c/p\u003e\n\n\u003cp\u003eSetting the other properties isn\u0026rsquo;t much more helpful. In my description of the \u003ccode\u003eUITextField\u003c/code\u003e, all of these properties are supposed to be \u003cem\u003edynamic\u003c/em\u003e which means that they have a data dependency on another value elsewhere in the program. Setting them here in isolation – without a connection to their data dependency – is dangerous; it can make them look as though they\u0026rsquo;ve been correctly configured when they are not.\u003c/p\u003e\n\n\u003cp\u003eIt\u0026rsquo;s far better to handle dynamic properties when we set up our connection to the data dependency. We should use some form of observing that guarantees to immediately provide the initial value. In the previous article, I used an \u003ccode\u003eaddObserver\u003c/code\u003e wrapper around \u003ccode\u003eNotificationCenter.addObserver\u003c/code\u003e  that guaranteed this.\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s properly construct the \u003ccode\u003eUITextField\u003c/code\u003e with all of the requirements specified in my text description in the \u0026ldquo;Aim\u0026rdquo; section.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003enameField\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003epersonViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ePersonViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003eperson\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ePerson\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003eobservations\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nb\"\u003eNSObjectProtocol\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\n\u003cspan class=\"kr\"\u003eoverride\u003c/span\u003e \u003cspan class=\"n\"\u003eloadView\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003efield\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n   \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enameField\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efield\u003c/span\u003e\n\n   \u003cspan class=\"c1\"\u003e// Constant properties\u003c/span\u003e\n   \u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eborderStyle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eroundedRect\u003c/span\u003e\n   \n   \u003cspan class=\"c1\"\u003e// Dynamic properties\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eobservations\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaddObserver\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kr\"\u003eweak\u003c/span\u003e \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003es\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003eself\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonViewState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonViewState\u003c/span\u003e\n      \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enameField\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEnabled\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e\n      \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enameField\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n         \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhite\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elightGray\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eperson\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n         \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eperson\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eperson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eforId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n         \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eupdatePerson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eperson\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eobservations\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaddObserver\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kr\"\u003eweak\u003c/span\u003e \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003edocument\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003es\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n         \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eperson\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eperson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eforId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eupdatePerson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eperson\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n   \u003cspan class=\"c1\"\u003e// Actions\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eo\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNotificationCenter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaddObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eforName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUITextFieldDidChange\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003equeue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kr\"\u003eweak\u003c/span\u003e \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003es\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003etext\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eobject\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e)?.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n         \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003epvs\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonViewState\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esetName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eforPersonId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003epvs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eobservations\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eupdatePerson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003eperson\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ePerson\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eperson\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eperson\u003c/span\u003e\n   \u003cspan class=\"n\"\u003enameField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eperson\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOuch! That\u0026rsquo;s gigantic! What happened?\u003c/p\u003e\n\n\u003cp\u003eEven \u003cem\u003ewith\u003c/em\u003e a wrapper around \u003ccode\u003eNotificationCenter.addObserver\u003c/code\u003e to make it more syntactically efficient, my eleven line text description has turned into 30+ lines of multi-structured, visually complex code. The actual properties we\u0026rsquo;re manipulating are lost in the middle somewhere.\u003c/p\u003e\n\n\u003cp\u003eThere\u0026rsquo;s a number of reasons why the code is verbose and complex. The biggest problems are the cross dependency between the \u003ccode\u003ePerson\u003c/code\u003e model object and the \u003ccode\u003ePersonViewState\u003c/code\u003e (because we want to observe the \u003ccode\u003ePerson\u003c/code\u003e identified by the \u003ccode\u003eid\u003c/code\u003e on the view\u0026rsquo;s \u003ccode\u003ePersonViewState\u003c/code\u003e), the clumsy need to observe the \u003ccode\u003e.UITextFieldDidChange\u003c/code\u003e notification to get the text changes and the continual need to use \u003ccode\u003eweak self\u003c/code\u003e and other quirks associated with callbacks from a child object needing to access data and methods on the parent view controller.\u003c/p\u003e\n\n\u003ch2 id=\"reactive-programming\"\u003eReactive programming\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"/blog/reactive-programming-what-and-why.html\"\u003eI\u0026rsquo;ve previously shown how reactive programming can be used to simplify observing code\u003c/a\u003e. By taking advantage of the \u003ccode\u003eflatMapLatest\u003c/code\u003e operator (which starts a new observation when its input changes) and some other mapping and combining functions, we can dramatically simplify these dependent observations:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003eendpoints\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eCancellable\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003econstructTextField\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003efield\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n   \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enameField\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003efield\u003c/span\u003e\n   \n   \u003cspan class=\"c1\"\u003e// Constant properties\u003c/span\u003e\n   \u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eborderStyle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eroundedRect\u003c/span\u003e\n   \n   \u003cspan class=\"c1\"\u003e// Dynamic properties\u003c/span\u003e\n   \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendpoints\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubscribeValues\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n      \u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEnabled\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e\n      \u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhite\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elightGray\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendpoints\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMapLatest\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esignalForPerson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esubscribeValues\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \n   \u003cspan class=\"c1\"\u003e// Actions\u003c/span\u003e\n   \u003cspan class=\"n\"\u003esignalFromNotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eUITextFielddidChange\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efield\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efilterMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eobject\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e)?.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etriggerCombine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esetName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esample\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis is much better: half the size of the previous example and eliminating some of the quirks like the need for \u003ccode\u003eweak self\u003c/code\u003e in the observing closures. Most importantly for clarity and maintenance: with the data dependencies combined cleanly, each \u003ccode\u003eUITextField\u003c/code\u003e property is updated on just a single path.\u003c/p\u003e\n\n\u003cp\u003eBut it\u0026rsquo;s still 5 separate statements to properly define a single \u003ccode\u003eUITextField\u003c/code\u003e and you need to look closely to see that this code exists to configure the \u003ccode\u003enameField\u003c/code\u003e since the references to this view are buried deep inside the \u003ccode\u003esubscribeValues\u003c/code\u003e closures.\u003c/p\u003e\n\n\u003cp\u003eIt\u0026rsquo;s also pretty strange to require an \u003ccode\u003eendpoints\u003c/code\u003e property (for maintaining the lifetime of the \u003ccode\u003esubscribeValues\u003c/code\u003e observing) on the \u003ccode\u003eUIViewController\u003c/code\u003e. This effectively makes the \u003ccode\u003eUIViewController\u003c/code\u003e, not the \u003ccode\u003eUITextField\u003c/code\u003e, the observer of the changes. It would be better if the \u003ccode\u003eUITextField\u003c/code\u003e were the owner of its own reactive lifetimes.\u003c/p\u003e\n\n\u003cp\u003eExtending \u003ccode\u003eUITextField\u003c/code\u003e so that it exposes a signal input and output for each settable property and observable action – a common approach in reactive programming frameworks like ReactiveCocoa or RxCocoa – would eliminate another line or two but wouldn\u0026rsquo;t otherwise improve the structure of the code: it would still require \u003ccode\u003edisposables\u003c/code\u003e to be held by the \u003ccode\u003eUIViewController\u003c/code\u003e, would still require a handful of separate statements to fully describe a single view and would still hide the affected view and properties deep inside larger expressions.\u003c/p\u003e\n\n\u003cp\u003eI want everything to be a single, self-contained expression where the \u003ccode\u003eUITextField\u003c/code\u003e manages its own behaviors, rather than requiring another object to facilitate.\u003c/p\u003e\n\n\u003ch2 id=\"everything-in-a-single-expression\"\u003eEverything in a single expression\u003c/h2\u003e\n\n\u003cp\u003eFor a moment, let\u0026rsquo;s set aside the difficulties of dynamic properties and output actions. We\u0026rsquo;ll come back to them later.\u003c/p\u003e\n\n\u003cp\u003eIt is very simple to write a \u003cem\u003especialized\u003c/em\u003e constructor to configure the \u003ccode\u003eUITextField\u003c/code\u003e properties that we care about in a single expression:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eborderStyle\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eroundedRect\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esomeTextValue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eisEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhite\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"n\"\u003etextChanged\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esomeSignalInput\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe real question is: can we use this approach to solve the \u003cem\u003egeneral\u003c/em\u003e case, not just a specialized case?\u003c/p\u003e\n\n\u003cp\u003eWe could write an \u003ccode\u003einit\u003c/code\u003e function that had parameters for \u003cem\u003eevery\u003c/em\u003e possible property and offered default values for each parameter, so we could specify only those parameters for which we want non-default values. For a basic \u003ccode\u003eUIView\u003c/code\u003e – considering only those properties on \u003ccode\u003eUIView\u003c/code\u003e itself – there\u0026rsquo;s about 25 properties that you might want to set on construction.\u003c/p\u003e\n\n\u003cp\u003eHere\u0026rsquo;s how an \u003ccode\u003einit\u003c/code\u003e function with all of these parameters might look:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"nc\"\u003eUIView\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"n\"\u003ealpha\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eCGFloat\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIColor\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eclearsContextBeforeDrawing\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eBool\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eclipsToBounds\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eBool\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003econtentMode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIViewContentMode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecenter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eexclusiveTouch\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eBool\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003egestureRecognizers\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eUIGestureRecognizer\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[],\u003c/span\u003e\n      \u003cspan class=\"n\"\u003ehorizontalContentCompressionResistancePriority\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILayoutPriority\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e \u003cspan class=\"n\"\u003edefaultHigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003ehorizontalContentHuggingPriority\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILayoutPriority\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edefaultLow\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003elayoutMargins\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIEdgeInsets\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUIEdgeInsets\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etop\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebottom\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n      \u003cspan class=\"n\"\u003emask\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIView\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003emotionEffects\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eUIMotionEffect\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[],\u003c/span\u003e\n      \u003cspan class=\"n\"\u003emultipleTouchEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eBool\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eopaque\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eBool\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003epreservesSuperviewLayoutMargins\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eBool\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003erestorationIdentifier\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003esemanticContentAttribute\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUISemanticContentAttribute\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eunspecified\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003etag\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003etintAdjustmentMode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIViewTintAdjustmentMode\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eautomatic\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003etintColor\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIColor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhite\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003euserInteractionEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eBool\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003everticalContentCompressionResistancePriority\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILayoutPriority\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edefaultHigh\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"n\"\u003everticalContentHuggingPriority\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILayoutPriority\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edefaultLow\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* ... */\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe autocomplete feature in Xcode starts to get a little weird with this many defaulted parameters. Autocomplete issues might seem like a minor inconvenience but since the entire \u003cem\u003epurpose\u003c/em\u003e of this construction code is supposed to be convenience, it merits consideration.\u003c/p\u003e\n\n\u003cp\u003eAnother inconvenience is that Swift requires parameters be provided in-order. For long lists of properties, you\u0026rsquo;d probably need to carefully keep things in alphabetical order to make it work - which is a hassle since properties like these are not inherently an ordered concept.\u003c/p\u003e\n\n\u003cp\u003eThis approach really becomes strained when we look at inheritance hierarchies. There\u0026rsquo;s as many as 30 properties you might set on a \u003ccode\u003eUITextField\u003c/code\u003e, plus 6 on \u003ccode\u003eUIControl\u003c/code\u003e plus the 25 on \u003ccode\u003eUIView\u003c/code\u003e. That\u0026rsquo;s over \u003cem\u003e60 parameters\u003c/em\u003e before we\u0026rsquo;ve included actions, delegates and oddities like how to handle mutability, all of which would likely increase (and in the case of mutability \u003cem\u003emultiply\u003c/em\u003e) the number of parameters required.\u003c/p\u003e\n\n\u003cp\u003eNow, Swift itself doesn\u0026rsquo;t really mind if you pass hundreds or even thousands of defaulted parameters to a function. I generated a function with 10,000 parameters while writing this article and it appeared to work without issue.\u003c/p\u003e\n\n\u003cp\u003eThe real problem with huge numbers of parameters is in \u003cem\u003emaintaining\u003c/em\u003e all the constructors across multiple levels of subclass. If every \u003ccode\u003eUIView\u003c/code\u003e subclass has a constructor that needs to repeat every \u003ccode\u003eUIView\u003c/code\u003e property then every time \u003ccode\u003eUIView\u003c/code\u003e changes its set of properties, all \u003ccode\u003eUIView\u003c/code\u003e subclass constructors would need to be updated. This is completely unreasonable.\u003c/p\u003e\n\n\u003ch2 id=\"enum-cases-as-parameter-names\"\u003eEnum cases as parameter names\u003c/h2\u003e\n\n\u003cp\u003eLet\u0026rsquo;s try a different approach. In my previous article, \u003ca href=\"/blog/cwllayout.html\"\u003eCwlLayout: a Swift wrapper around Auto Layout\u003c/a\u003e, I showed a syntax where the parameters to a function were a variable argument list of \u003ccode\u003eenum\u003c/code\u003e cases. Here\u0026rsquo;s how it looked:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehorizontal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esizedView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elengthEqualTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eratio\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.75\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003espace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe can use a similar approach here by creating an \u003ccode\u003eenum\u003c/code\u003e with all the properties from \u003ccode\u003eUIView\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003eenum\u003c/span\u003e \u003cspan class=\"nc\"\u003eViewBinding\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003ealpha\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCGFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUIColor\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eclearsContextBeforeDrawing\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eBool\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"c1\"\u003e// ... and so on\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eand then we can write an \u003ccode\u003einit\u003c/code\u003e function that accepts a variable number of these arguments:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"nc\"\u003eUIView\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003ebindings\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eViewBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e...)\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eand construct \u003ccode\u003eUIView\u003c/code\u003e like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eUIView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ealpha\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.5\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhite\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis looks like it might be more promising. Parameters don\u0026rsquo;t need to be provided in-order, it\u0026rsquo;s not going to have the autocomplete problems in Xcode and it\u0026rsquo;s not going to put hundreds of parameters onto the stack each time.\u003c/p\u003e\n\n\u003cp\u003eThere\u0026rsquo;s the slight weirdness that you could inadvertently provide two instances of the same parameter, e.g.:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eUIView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhite\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003eblue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThere shouldn\u0026rsquo;t be any valid reason to do this but it isn\u0026rsquo;t any worse than setting the same property twice in code – a waste of time but not a show stopping scenario.\u003c/p\u003e\n\n\u003cp\u003eA bigger problem is that there\u0026rsquo;s no solution here for inheritance. If we had to exhaustively enumerate all \u003ccode\u003eUIView\u003c/code\u003e properties in each \u003ccode\u003eUIView\u003c/code\u003e subclass, then a change to \u003ccode\u003eUIView\u003c/code\u003e would still break every \u003ccode\u003eUIView\u003c/code\u003e subclass.\u003c/p\u003e\n\n\u003ch2 id=\"enums-with-inheritance\"\u003eEnums with inheritance\u003c/h2\u003e\n\n\u003cp\u003eWe could wrap the parameters of the inherited class in an \u003ccode\u003einheritedBinding\u003c/code\u003e case:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003eenum\u003c/span\u003e \u003cspan class=\"nc\"\u003eTextFieldBinding\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003einheritedBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eControlBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"c1\"\u003e// other UITextField properties\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eenum\u003c/span\u003e \u003cspan class=\"nc\"\u003eControlBinding\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003einheritedBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eViewBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eenabled\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eBool\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"c1\"\u003e// other UIControl properties\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eenum\u003c/span\u003e \u003cspan class=\"nc\"\u003eViewBinding\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003ealpha\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eCGFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eUIColor\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eclearsContextBeforeDrawing\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eBool\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"c1\"\u003e// ... and so on\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe could use this to create an \u003ccode\u003einit\u003c/code\u003e method on \u003ccode\u003eUITextField\u003c/code\u003e capable of this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esomeTextValue\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einheritedBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003eenabled\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einheritedBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003einheritedBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhite\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eTechnically \u003cem\u003eworks\u003c/em\u003e but it\u0026rsquo;s starting to get a little goofy. Needing to remember the correct inheritance level and correctly specify it is annoying and the real information on each line is starting to get a little lost in layers of wrapping.\u003c/p\u003e\n\n\u003cp\u003eFortunately, Swift has the ability to look up \u003ccode\u003estatic\u003c/code\u003e members using the dot operator so we could simplify this slightly by adding a \u003ccode\u003estatic\u003c/code\u003e function on \u003ccode\u003eTextFieldBinding\u003c/code\u003e that shortcuts to any subclass:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"nc\"\u003eTextFieldBinding\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003econtrolBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003eBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eControlBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTextFieldBinding\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einheritedBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eviewBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003eBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eViewBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTextFieldBinding\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einheritedBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003einheritedBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003eparam\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eand we could rewrite the initialization as:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etextFieldBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esomeTextValue\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econtrolBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eviewBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhite\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe \u003ccode\u003e.textFieldBinding\u003c/code\u003e wrapper isn\u0026rsquo;t required here but I\u0026rsquo;ve included for consistency.\u003c/p\u003e\n\n\u003cp\u003eThis does address the problems of inheritance and large numbers of defaulted parameters but the aesthetics are certainly not ideal. The property name that we\u0026rsquo;re trying to set is buried in the \u003cem\u003emiddle\u003c/em\u003e of each line and there\u0026rsquo;s two layers of parentheses required to wrap the contents.\u003c/p\u003e\n\n\u003cp\u003eAnd I\u0026rsquo;ve been omitting the most important part: these parameters are constant and I want a solution that handles \u003cem\u003edynamic\u003c/em\u003e parameters.\u003c/p\u003e\n\n\u003ch2 id=\"dynamic-values\"\u003eDynamic values\u003c/h2\u003e\n\n\u003cp\u003eWe need to be able to satisfy any property with a \u003cem\u003edynamic value\u003c/em\u003e – a property that gets its value from a dynamic source, like a reactive programming signal. Of course, just because a property \u003cem\u003ecan\u003c/em\u003e be dynamic, doesn\u0026rsquo;t mean it \u003cem\u003emust\u003c/em\u003e be dynamic. This means that we need to be able to set any dynamic property in two different ways:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eConstant (e.g. a value like \u003ccode\u003e.white\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003eDynamic (e.g. a signal like \u003ccode\u003esignal.map { $0.isEditing ? .white : .lightGray }\u003c/code\u003e)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eTo handle these two scenarios, the associated values in our Binding \u003ccode\u003eenum\u003c/code\u003e values will no longer be simple types (like \u003ccode\u003eString\u003c/code\u003e or \u003ccode\u003eUIColor\u003c/code\u003e or \u003ccode\u003eBool\u003c/code\u003e) and will instead be wrapped in \u003ccode\u003eDynamicValue\u003c/code\u003e so we can provide \u003ccode\u003e.constant\u003c/code\u003e or \u003ccode\u003e.dynamic\u003c/code\u003e versions:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003eenum\u003c/span\u003e \u003cspan class=\"nc\"\u003eDynamicValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003econstant\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kr\"\u003edynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSignal\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eOur construction might then become:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etextFieldBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"kr\"\u003edynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMapLatest\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esignalForPerson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e))),\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econtrolBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003eenabled\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"kr\"\u003edynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e))),\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eviewBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"kr\"\u003edynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhite\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elightGray\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe \u003ccode\u003eUITextField\u003c/code\u003e owns the endpoints that keep the bindings alive. These endpoints are stored with the object itself using \u003ccode\u003eobjc_setAssociatedObject\u003c/code\u003e. Since bindings must be created on construction – they cannot be added later – we can do this efficiently and set an associated storage only if the object has dynamic bindings that need to be retained.\u003c/p\u003e\n\n\u003cp\u003eConceptually, this is what I want but it looks really clumsy and we\u0026rsquo;re approaching a LISP-level of parentheses.\u003c/p\u003e\n\n\u003ch2 id=\"hiding-dirty-work-in-the-type-system\"\u003eHiding dirty work in the type system\u003c/h2\u003e\n\n\u003cp\u003eLet\u0026rsquo;s start by trying to hide the \u003ccode\u003e.dynamic\u003c/code\u003e/\u003ccode\u003e.constant\u003c/code\u003e wrapper.\u003c/p\u003e\n\n\u003cp\u003eThere\u0026rsquo;s an interesting trick for \u003ccode\u003eenum\u003c/code\u003e cases with associated values: if they are used \u003cem\u003ewithout\u003c/em\u003e their associated values, they refer to their own construction function. For example, \u003ccode\u003eTextFieldBinding.text\u003c/code\u003e has the type \u003ccode\u003e(DynamicValue\u0026lt;String\u0026gt;) -\u0026gt; TextFieldBinding\u003c/code\u003e (a function that constructs a \u003ccode\u003eTextFieldBinding\u003c/code\u003e from a \u003ccode\u003eDynamicValue\u0026lt;String\u0026gt;\u003c/code\u003e).\u003c/p\u003e\n\n\u003cp\u003eWe can use this trick to build abstractions around our enum cases. For example, we could construct overloaded versions of the existing \u003ccode\u003eviewBinding\u003c/code\u003e, \u003ccode\u003econtrolBinding\u003c/code\u003e and \u003ccode\u003etextBinding\u003c/code\u003e static functions – one that takes dynamic values and another that takes constant values.\u003c/p\u003e\n\n\u003cp\u003eHere\u0026rsquo;s an example of an overload version of the \u003ccode\u003eviewBinding\u003c/code\u003e static function:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"nc\"\u003eTextFieldBinding\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eviewBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDynamicBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eViewBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTextFieldBinding\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einherited\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003einherited\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003econstant\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eviewBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eDynamicBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eViewBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSignal\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTextFieldBinding\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einherited\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003einherited\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"kr\"\u003edynamic\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis is probably confusing to read but notice that the first of these overloads uses an unwrapped \u003ccode\u003eValue\u003c/code\u003e as the second parameter and returns a \u003ccode\u003e.constant\u003c/code\u003e at the center of the wrapping layers, whereas the second takes a \u003ccode\u003eSignal\u0026lt;Value\u0026gt;\u003c/code\u003e and wraps in \u003ccode\u003e.dynamic\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eHere\u0026rsquo;s the effect on the code:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etextFieldBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTextFieldBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMapLatest\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esignalForPerson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e),\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econtrolBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eControlBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e),\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eviewBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eViewBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhite\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elightGray\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eHmm. We \u003cem\u003edid\u003c/em\u003e get rid of the \u003ccode\u003e.constant\u003c/code\u003e/\u003ccode\u003e.dynamic\u003c/code\u003e wrapper but we\u0026rsquo;ve been forced to fully specify the type of the first parameter to \u003ccode\u003e.textFieldBinding\u003c/code\u003e/\u003ccode\u003e.controlBinding\u003c/code\u003e/\u003ccode\u003e.viewBinding\u003c/code\u003e because the expected parameter is now a function instead of a \u003ccode\u003eTextFieldBinding\u003c/code\u003e/\u003ccode\u003eControlBinding\u003c/code\u003e/\u003ccode\u003eViewBinding\u003c/code\u003e and because of this, we can\u0026rsquo;t use \u003ccode\u003e.\u003c/code\u003e lookup.\u003c/p\u003e\n\n\u003cp\u003eThat\u0026rsquo;s a real nuisance. We made a syntactic saving in one spot only to lose most of it in another.\u003c/p\u003e\n\n\u003ch2 id=\"intermediate-type\"\u003eIntermediate type\u003c/h2\u003e\n\n\u003cp\u003eTo get the \u003ccode\u003e.\u003c/code\u003e lookup back for the first parameter, we can use an intermediate type to provide a location for \u003ccode\u003e.\u003c/code\u003e lookup to occur and encapsulate the desired \u003ccode\u003e(Value) -\u0026gt; TextFieldBinding\u003c/code\u003e function internally.\u003c/p\u003e\n\n\u003cp\u003eI\u0026rsquo;m going to use a type named \u003ccode\u003eBindingName\u003c/code\u003e as the intermediate type. This type will be defined as follows:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eBindingName\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBinding\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eBinding\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e@\u003c/span\u003e\u003cspan class=\"n\"\u003eescaping\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eValue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstructor\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003econstructor\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"nc\"\u003eBindingName\u003c/span\u003e \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"n\"\u003eBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eTextFieldBinding\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003epublic\u003c/span\u003e \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingName\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDynamicValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBinding\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eBindingName\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDynamicValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBinding\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"n\"\u003ev\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etextFieldBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eTextField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe \u003ccode\u003econstructor\u003c/code\u003e property of this type can then be used by the \u003ccode\u003eviewBinding\u003c/code\u003e/\u003ccode\u003econtrolBinding\u003c/code\u003e/\u003ccode\u003etextFieldBinding\u003c/code\u003e wrappers in place of the previous \u003ccode\u003ename\u003c/code\u003e function.\u003c/p\u003e\n\n\u003cp\u003eWith this, \u003ccode\u003e.text\u003c/code\u003e, \u003ccode\u003e.isEnabled\u003c/code\u003e and \u003ccode\u003e.backgroundColor\u003c/code\u003e no longer require a full typename:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etextFieldBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMapLatest\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esignalForPerson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e),\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econtrolBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEnabled\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e),\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eviewBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhite\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elightGray\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"a-little-operator-overloading\"\u003eA little operator overloading\u003c/h2\u003e\n\n\u003cp\u003eThis is \u003cem\u003ealmost\u003c/em\u003e what I want but I still don\u0026rsquo;t like the fact that a wrapper function is the first visual element on each line. The only way to omit this wrapper in Swift is with operator overloading.\u003c/p\u003e\n\n\u003cp\u003eThe idea is to replace the \u003ccode\u003etextFieldBinding\u003c/code\u003e, \u003ccode\u003econtrolViewBinding\u003c/code\u003e and \u003ccode\u003eviewBinding\u003c/code\u003e wrapper functions with an operator overload that does the same work. I am not normally a fan of custom operators but I opted to use one here after becoming frustrated with scenarios involving huge numbers of closing parentheses (three or four closing parentheses becomes very difficult to read).\u003c/p\u003e\n\n\u003cp\u003eI opted to use the custom operator \u003ccode\u003e--\u003c/code\u003e (two hyphens) because it\u0026rsquo;s easy to type, is very visually light and it resembles an em-dash which might be validly used for separating keys and values in a list. I realize that it is used to denote code comments in some languages but I don\u0026rsquo;t think that\u0026rsquo;s a major conceptual conflict for use as a key-value separator.\u003c/p\u003e\n\n\u003cp\u003eThe final result is that the function looks like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eborderStyle\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eroundedRect\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eenabled\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhite\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elightGray\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMapLatest\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esignalForPerson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edidChange\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etriggerCombine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esetName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esample\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eI\u0026rsquo;ve included the the \u003ccode\u003e.didChange\u003c/code\u003e action binding here. Unlike the other bindings which model \u003cem\u003esetter\u003c/em\u003e properties on the \u003ccode\u003eUITextField\u003c/code\u003e, this \u003ccode\u003e.didChange\u003c/code\u003e binding models a callback.\u003c/p\u003e\n\n\u003cp\u003eOn a syntactic level, the only difference here is that instead of an \u003ccode\u003eenum\u003c/code\u003e case with a \u003ccode\u003eDynamicValue\u0026lt;T\u0026gt;\u003c/code\u003e, the \u003ccode\u003e.didChange\u003c/code\u003e case has an associated \u003ccode\u003eSignalInput\u0026lt;String\u0026gt;\u003c/code\u003e. An additional overload of the \u003ccode\u003e--\u003c/code\u003e operator matches this \u003ccode\u003eSignalInput\u003c/code\u003e scenario and ensures we provide the appropriate right-hand-side.\u003c/p\u003e\n\n\u003cp\u003eThe right-hand-side of the \u003ccode\u003e--\u003c/code\u003e operator constructs a new \u003ccode\u003eInput()\u003c/code\u003e to receive the callback and the \u003ccode\u003eString\u003c/code\u003e parameter in the callback is combined with the \u003ccode\u003eid\u003c/code\u003e from the \u003ccode\u003eViewState.shared.personSignal\u003c/code\u003e before sending a \u003ccode\u003esetName\u003c/code\u003e message through to the \u003ccode\u003eDocument\u003c/code\u003e with a \u003ccode\u003ebind(to:)\u003c/code\u003e call.\u003c/p\u003e\n\n\u003ch2 id=\"alternatives\"\u003eAlternatives\u003c/h2\u003e\n\n\u003cp\u003eI\u0026rsquo;ve gone back and forth on the design for this view construction syntax as much as any other code I\u0026rsquo;ve written. If you\u0026rsquo;re wondering why I didn\u0026rsquo;t choose a different approach\u0026hellip; I probably did, for a while, and either ran into a problem or otherwise grew to dislike something.\u003c/p\u003e\n\n\u003cp\u003eOne of the obvious alternatives is avoiding the custom operator. It is possible to implement a version with all the same features but looks like this:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emodel\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e}),\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eenabled\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eMy dislike of custom operators fought my dislike of parentheses and lost. It didn\u0026rsquo;t help that this approach required multiple overloads of \u003cem\u003eeach\u003c/em\u003e binding name to allow dynamic/constant and other variants so it wasn\u0026rsquo;t as extensible.\u003c/p\u003e\n\n\u003cp\u003eI also spent a long time using separate \u003ccode\u003e\u0026lt;--\u003c/code\u003e and \u003ccode\u003e--\u0026gt;\u003c/code\u003e operators for inputs and outputs. This was originally due to an older implementation where the operator overloads weren\u0026rsquo;t scaling well. I split the operator to lighten the overload resolution burden on the type system. After some restructuring, the operator resolution performance improved but I kept the separate operators for a while. Showing a direction for \u0026ldquo;inputs\u0026rdquo; and \u0026ldquo;outputs\u0026rdquo; might seem helpful but the types, the parameter names and the values you supply already indicate the direction of data flow and I liked the much plainer key-value styling of using \u003ccode\u003e--\u003c/code\u003e everywhere, rather than trying to be visually clever about it.\u003c/p\u003e\n\n\u003ch2 id=\"drawbacks\"\u003eDrawbacks\u003c/h2\u003e\n\n\u003cp\u003eIt\u0026rsquo;s usually not a good idea to use an overloaded operator like \u003ccode\u003e--\u003c/code\u003e inside array-literal square brackets. Past a half dozen values it can start to resolve slowly. This is a problem that \u003cem\u003ecould\u003c/em\u003e occur by accident if you\u0026rsquo;re not paying attention. If you want to construct an array of these bindings, construct the array on its own line and assign to a variable with a fully specified type – Swift uses optimized type inference in this scenario.\u003c/p\u003e\n\n\u003cp\u003eThere\u0026rsquo;s a related problem when constructing a large generic type using this syntax. If resolving the \u003ccode\u003e--\u003c/code\u003e terms is required to resolve the generic parameters, it\u0026rsquo;s not going to scale past a dozen or so parameters. Far better to explicitly specify your generic parameters.\u003c/p\u003e\n\n\u003cp\u003eVariable argument lists \u003cem\u003ereally\u003c/em\u003e confuse the Swift compilation error reporting mechanism. Accidentally omit a comma, add an extra comma, mix up your types, or make some other typo and the Swift compiler might:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003esuggest you fix the second argument (even if the error is in the 20th argument)\u003c/li\u003e\n\u003cli\u003esuggest you add a parameter name, even though no parameters should be named\u003c/li\u003e\n\u003cli\u003ecomplain about being unable to resolve generic parameters that are explicitly specified\u003c/li\u003e\n\u003cli\u003ecomplain that there are too many arguments in your variable argument list\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAs an example, during the writing of this article, I accidentally wrote:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eborderStyle\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eroundRect\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ewhen the correct spelling is:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eborderStyle\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eroundedRect\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSwift\u0026rsquo;s error message was \u0026ldquo;Generic parameter \u0026lsquo;Interface\u0026rsquo; could not be inferred\u0026rdquo;. \u003ccode\u003eInterface\u003c/code\u003e is a generic parameter on one of the \u003ccode\u003e--\u003c/code\u003e operator overloads – but it\u0026rsquo;s on a \u003cem\u003edifferent\u003c/em\u003e overload to the one you\u0026rsquo;d expect, here. The error message might as well be Swift shrugging its shoulders \u0026ldquo;Um\u0026hellip; not sure?\u0026rdquo;\u003c/p\u003e\n\n\u003cp\u003eWith this type of code, you need to consider that any error reported by the compiler may point to the wrong location or otherwise indicate that the compiler has no idea at all what\u0026rsquo;s gone wrong. There are plenty of cases where I\u0026rsquo;ve needed to comment out parameter lines to narrow down the location of the problem.\u003c/p\u003e\n\n\u003cp\u003eIf you\u0026rsquo;re having difficulty isolating \u003cem\u003ewhy\u003c/em\u003e a compiler error is occurring in a given line, you can always replace the optimized syntax:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eborderStyle\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eroundedRect\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ewith the verbose syntax:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etextFieldBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003eborderStyle\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003econstant\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003eroundedRect\u003c/span\u003e\u003cspan class=\"p\"\u003e))),\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eSwift tends to give much better error reporting as you start to make things more explicit. Theoretically, you could be \u003cem\u003ecompletely\u003c/em\u003e explicit:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eTextField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etextFieldBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eTextField\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eBinding\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eborderStyle\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eDynamicValue\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eUITextFieldBorderStyle\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstant\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n         \u003cspan class=\"n\"\u003eUITextFieldBorderStyle\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eroundedRect\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e),\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ealthough I\u0026rsquo;ve never had to go that far and there\u0026rsquo;s a reason why we want the compiler to do this work for us.\u003c/p\u003e\n\n\u003cp\u003eTake another look at that last code sample. We need only write \u003ccode\u003e.borderStyle -- .roundedRect\u003c/code\u003e and the compiler fills in the remainder – that\u0026rsquo;s what this article is all about.\u003c/p\u003e\n\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\n\u003cp\u003eYou can play with some of the examples in this article in the \u003ca href=\"https://github.com/mattgallagher/CocoaWithLovePlaygrounds\"\u003eViewConstruction.playground\u003c/a\u003e. The playground builds the following view:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/blog/viewconstructor.png\" alt=\"\" /\u003e\u003c/p\u003e\n\n\u003cp\u003eThe \u003ccode\u003enameField\u003c/code\u003e discussed in this article is visible at the top, along with some basic controls to alter the View-state and the Document to observe the effects on the \u003ccode\u003eUITextField\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe playground includes three different code paths that can construct this \u003ccode\u003eUITextField\u003c/code\u003e:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003estandard Cocoa \u003ccode\u003ecocoaViews\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ereactive programming \u003ccode\u003ereactiveViews\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ethe \u003ccode\u003ecwlViews\u003c/code\u003e approach\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThey should all appear the same to the user.\u003c/p\u003e\n\n\u003cp\u003eThe \u0026ldquo;Sources\u0026rdquo; folder in the playground contains a collection of files hastily butchered from CwlViews and a lazily constructed \u0026ldquo;Model\u0026rdquo; to provide the \u003ccode\u003eViewState\u003c/code\u003e and \u003ccode\u003eDocument\u003c/code\u003e in the examples. The result is not easy to read and the only purpose is to keep the actual playground page functional. The purpose of this playground is purely to present the ViewContruction playground page itself.\u003c/p\u003e\n\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\n\u003cp\u003eI aimed to construct a view in a single, self-contained expression using a syntax that resembled a declarative description of properties. The result is the following syntax:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eUITextField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eborderStyle\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eroundedRect\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eenabled\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebackgroundColor\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewhite\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elightGray\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMapLatest\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esignalForPerson\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edidChange\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e \u003cspan class=\"n\"\u003eInput\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etriggerCombine\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epersonSignal\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003emap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esetName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esample\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe result is 14 lines, versus 11 lines in the original text description. It\u0026rsquo;s less than half the length of common Cocoa code to achieve the same result with significantly clearer structure.\u003c/p\u003e\n\n\u003cp\u003eIt\u0026rsquo;s possible that the right-hand side might look cluttered or cryptic if you\u0026rsquo;re unfamiliar with reactive programming. However, even if you can\u0026rsquo;t read code at all, the structure of the code should reveal what it does: it is a list of 5 properties (\u003ccode\u003e.borderStyle\u003c/code\u003e, \u003ccode\u003e.enabled\u003c/code\u003e, \u003ccode\u003e.backgroundColor\u003c/code\u003e, \u003ccode\u003e.text\u003c/code\u003e and \u003ccode\u003e.didChange\u003c/code\u003e) that we\u0026rsquo;re specifying on a \u003ccode\u003eUITextField\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eIf you do understand code and you know how verbose and unstructured this type of code can be, then you should appreciate how clearly and succinctly it is expressed. Inherited properties, constant or dynamic sources, inputs or outputs – all are possible while maintaining a clean, minimal aesthetic.\u003c/p\u003e\n\n\u003cp\u003eI did use a custom operator. I\u0026rsquo;m normally opposed to custom operators and I will often dismiss others\u0026rsquo; code involving custom operators on the grounds that they makes things needlessly cryptic. I\u0026rsquo;m sure some programmers will look at this code and immediately dismiss it for the same reasons. I hope that most programmers will see that I\u0026rsquo;m not trying to be fancy with the custom operator; in fact it\u0026rsquo;s the best way to keep things simple.\u003c/p\u003e\n\n\u003cp\u003eThe \u003ccode\u003e.parameter -- value\u003c/code\u003e syntax is intended to read like a standard \u003ccode\u003eparameter: value\u003c/code\u003e argument list, it just offers the ability to hide some boilerplate wrappers and handle a wider range of scenarios automatically.\u003c/p\u003e\n\n\u003ch3 id=\"looking-forward\"\u003eLooking forward\u003c/h3\u003e\n\n\u003cp\u003eThis syntax is one aspect of the CwlViews framework. While I\u0026rsquo;m still scrambling to finish the framework itself, I\u0026rsquo;ll spend the next article talking a little about the impact on a program when its views have their behaviors fully specified and can entirely self-manage after construction.\u003c/p\u003e\n",
            "date_published": "2017-12-15T22:35:03+10:00"
        }
        
        , {
            "title": "View-state driven applications",
            "id": "https://www.cocoawithlove.com/blog/view-state-driven-applications.html",
            "url": "https://www.cocoawithlove.com/blog/view-state-driven-applications.html",
            "content_html": "\n\n\u003cp\u003eCocoa applications are traditionally \u0026ldquo;presentation driven\u0026rdquo;. By that, I mean that view changes commence by first choosing the presentation change – like a view controller segue – and later we set the data to give the view content.\u003c/p\u003e\n\n\u003cp\u003eIn this article, I\u0026rsquo;ll look at why a presentation driven approach conflicts with the \u003ca href=\"worst-possible-application.html\"\u003eprimary rule of application design discussed in the previous article\u003c/a\u003e. I\u0026rsquo;ll look at some limitations caused by this conflict and look at what happens when we invert the steps by first setting data – an encoding of display intent – then later update the presentation to match this data.\u003c/p\u003e\n\n\u003cp\u003eTo demonstrate some potential benefits of a data driven approach, the code in this article will show how you can implement complete user-interface logging, full state restoration and user-interface \u0026ldquo;time travel\u0026rdquo; in an app that remains as close as possible to Xcode\u0026rsquo;s \u0026ldquo;Master-Detail App\u0026rdquo; project template.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThis article will be a more in-depth look at the same topic and \u003ca href=\"https://github.com/mattgallagher/Clocks\"\u003esample project\u003c/a\u003e (significantly updated) that I presented at try! Swift NYC 2017. \u003ca href=\"https://academy.realm.io/posts/try-swift-nyc-2017-matt-gallagher-driving-view-state-through-data/\"\u003eThe video for that talk is available\u003c/a\u003e if you\u0026rsquo;d prefer to start there.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\n\u003ch2 id=\"ideal-model-view-controller\"\u003eIdeal Model-View-Controller\u003c/h2\u003e\n\n\u003cp\u003eIdeally, in a Model-View-Controller application, user-actions occur along the following data-flow path:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/blog/ideal_mvc.svg\" alt=\"\" /\u003e\u003c/p\u003e\n\n\u003cfigcaption\u003eIdeal data-flow path in a Model-View-Controller application\u003c/figcaption\u003e\n\n\u003cp\u003eA User-action is received by a View which targets its Controller. The Controller performs an action on the Model. Neither the targeted Controller nor the interacted View make any changes at this time – they are merely propagating an event.\u003c/p\u003e\n\n\u003cp\u003eThe Model makes whatever changes are appropriate for the action and sends a notification. Any Controller interested in the notification may observe it. Observing Controllers update Views according to the changes described in the notification.\u003c/p\u003e\n\n\u003cp\u003eThis is ideal Model-View-Controller. User-actions always propagate through to the Model. No state changes until the action occurs on the Model. Views are updated solely as a result of notifications from the Model. As I discussed in the previous article, these requirements preserve the notion of the Model as an abstraction. These requirements are the minimum for any application design.\u003c/p\u003e\n\n\u003ch2 id=\"clocks\"\u003eClocks\u003c/h2\u003e\n\n\u003cp\u003eTo demonstrate a typical Model-View-Controller app, I wrote the following application.\u003c/p\u003e\n\n\u003cdiv style=\"text-align:center;padding:16px;\"\u003e\u003cimg src=\"/assets/blog/clocks1.png\" /\u003e \u003cimg src=\"/assets/blog/clocks2.png\" /\u003e\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eYou can view this version of the app on the \u003ca href=\"https://github.com/mattgallagher/Clocks/tree/undoredo\"\u003e\u0026ldquo;undoredo\u0026rdquo; branch of the Clocks github repository\u003c/a\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThe app is a basic world-time viewer. The main screen shows a list of timezones. You can tap the \u0026ldquo;+\u0026rdquo; button and add new timezones from the \u0026ldquo;Selection\u0026rdquo; screen. You can set \u0026ldquo;Edit\u0026rdquo; mode on the main screen and delete existing timezones. You can tap on a timezone on the main screen to show a detail view. You can rename the timezone on the detail view.\u003c/p\u003e\n\n\u003cp\u003eIt\u0026rsquo;s not the functionality of the app that\u0026rsquo;s important but the fact that the app is, as close as I can make it, directly based on Xcode\u0026rsquo;s \u0026ldquo;Master-Detail App\u0026rdquo; project template and follows the same basic formula implied in Apple\u0026rsquo;s sample code.\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s look at the code path for use-actions in this app. Code on the \u003ccode\u003eMasterViewController\u003c/code\u003e for deleting a \u003ccode\u003eTimezone\u003c/code\u003e from the list is:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"c1\"\u003e// Controller receives delegate action from View and invokes Model action\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eoverride\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUITableView\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecommit\u003c/span\u003e \u003cspan class=\"n\"\u003eeditingStyle\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eUITableViewCellEditingStyle\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eforRowAt\u003c/span\u003e \u003cspan class=\"n\"\u003eindexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIndexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eremoveTimezone\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esortedTimezones\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003euuid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Document notifies change and Controller updates View accordingly\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003ehandleDocumentNotification\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etimezones\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eDataType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eDocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eremoved\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003euuid\u003c/span\u003e\u003cspan class=\"p\"\u003e)?:\u003c/span\u003e\n      \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esortedTimezones\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euuid\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003euuid\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eupdateSortedTimezones\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etimezones\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etimezones\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeleteRows\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eat\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eIndexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esection\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)],\u003c/span\u003e \u003cspan class=\"n\"\u003ewith\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eautomatic\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThese two functions show all the steps from our \u0026ldquo;ideal Model-View-Controller\u0026rdquo; diagram. The first function shows the action from the View and the invocation on the Model. The second function shows the observation of the Model-notification and the application of changes to the View.\u003c/p\u003e\n\n\u003ch2 id=\"do-you-know-what-your-app-is-doing\"\u003eDo you know what your app is doing?\u003c/h2\u003e\n\n\u003cp\u003eIn the Clocks app, every time the Model is changed, a snapshot of the Model is saved. The app displays a slider at the bottom of the screen and by using the slider, you can rewind the Model back through each of the snapshots.\u003c/p\u003e\n\n\u003cp\u003eThe effect is straightforward: the slider and implements undo and redo using the Model snapshots.\u003c/p\u003e\n\n\u003cp\u003eHowever, try the following steps:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003ego to the \u0026ldquo;Selection\u0026rdquo; screen and add a new timezone\u003c/li\u003e\n\u003cli\u003efrom the main screen, select the \u0026ldquo;Edit\u0026rdquo; mode in the navigation bar\u003c/li\u003e\n\u003cli\u003edelete the newly added timezone and leave \u0026ldquo;Edit\u0026rdquo; mode by selecting \u0026ldquo;Done\u0026rdquo;\u003c/li\u003e\n\u003cli\u003euse the slider at the bottom of the screen to slowly undo these changes\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThe added timezone will reappear as its deletion is undone and then disappear again as its creation is undone. However \u0026ldquo;Edit\u0026rdquo; mode will not reappear and the selection screen will not reappear.\u003c/p\u003e\n\n\u003cdiv style=\"text-align:center\"\u003e\u003cvideo style=\"border:1px solid black;\" src=\"/assets/blog/clocks_undoredo.mp4\" controls /\u003e\u003c/div\u003e\n\n\u003cfigcaption\u003eA video of adding and deleting \"Casablanca\" then using the slider to undo and redo this change\u003c/figcaption\u003e\n\n\u003cp\u003eWe say that the View presents the Model and the Model is the true representation of the app but this simple app demonstrates that it\u0026rsquo;s a lie. \u003cstrong\u003eThe Model is \u003cem\u003enot\u003c/em\u003e a complete representation of the application\u0026rsquo;s state\u003c/strong\u003e. The View is \u003cem\u003enot\u003c/em\u003e a simple display of content from the Model. The \u0026ldquo;Selection\u0026rdquo; screen is not a part of the Model but it affects the display. \u0026ldquo;Edit\u0026rdquo; mode is not a part of the Model but it affects the display. Many User-actions in typical Model-View-Controller app do not follow the ideal data-flow path and change state without ever reaching the Model.\u003c/p\u003e\n\n\u003ch2 id=\"separate-pipelines\"\u003eSeparate pipelines\u003c/h2\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/blog/not_ideal_mvc.svg\" alt=\"Broken MVC\" /\u003e\u003c/p\u003e\n\n\u003cfigcaption\u003ePresentation driven changes involve View and Controller acting without the Model\u003c/figcaption\u003e\n\n\u003cp\u003eIn typical MVC Cocoa, as this diagram shows, segues and other \u0026ldquo;presentation\u0026rdquo; changes – like the appearance or disappearance of the \u003ccode\u003eSelectionViewController\u003c/code\u003e in the Clocks app – are handled entirely within the Controller layer, leaving the Model out-of-the-loop.\u003c/p\u003e\n\n\u003cp\u003eIt\u0026rsquo;s not just a problem with \u0026ldquo;presentation\u0026rdquo; changes. Many common View and Controller classes in Cocoa are built around they idea that they can be constructed, updated and mutated without a Model being involved at all. It is common for any of the following data to exist \u003cem\u003eonly\u003c/em\u003e in Views or Controllers and not in the Model:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eThe navigation stack in a navigation controller.\u003c/li\u003e\n\u003cli\u003eScroll position of a scroll view.\u003c/li\u003e\n\u003cli\u003eRow selection in a table view.\u003c/li\u003e\n\u003cli\u003eTab selections in a tab view.\u003c/li\u003e\n\u003cli\u003eThe state of Switches and sliders.\u003c/li\u003e\n\u003cli\u003eUncommitted text fields.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThis data that lives outside the Model is called \u0026ldquo;View-state\u0026rdquo;. This is a collection of the most user-visible state in our application and the standard approach in Model-View-Controller is to \u003cem\u003eignore\u003c/em\u003e it.\u003c/p\u003e\n\n\u003ch2 id=\"rethinking-what-should-be-a-model\"\u003eRethinking what should be a Model\u003c/h2\u003e\n\n\u003cp\u003eYes, I know that traditional Model-View-Controller \u003cem\u003eintentionally\u003c/em\u003e excludes View-state from the Model. Traditional formulations of the Model describe the \u003cem\u003epersistent\u003c/em\u003e data of the app and everything non-persistent is excluded. The View intentionally held uncommitted data so validation and other business logic could be delayed until a \u0026ldquo;commit\u0026rdquo; step. RAM for multiple copies, CPU for validation, HD space for persistent storage – these things were slow and highly constrained resources.\u003c/p\u003e\n\n\u003cp\u003eBut in modern applications, we have the CPU power to validate everything continuously, we have the spare RAM to keep multiple copies of state and the View is persistent between app launches. The premise that non-Document state isn\u0026rsquo;t worthy of the same benefits as Document state lacks justification and discourages programmers from correctly abstracting non-Document state.\u003c/p\u003e\n\n\u003cp\u003eIf we demand clean Model abstractions for the Document, then I don\u0026rsquo;t think there\u0026rsquo;s a good justification to exempt View-state – or any other state – from the same requirements. I think the fact that we can\u0026rsquo;t rewind the entire user-interface as easily as the document is an indication that lack of coordination and management of state has left us out-of-control of our own application.\u003c/p\u003e\n\n\u003cp\u003eI think we should expand the definition of Model to:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eAll mutable state\u003c/strong\u003e that is directly represented in the View – whether it is stored in the \u003cem\u003eDocument, View-state, User-settings, Filesystem, System-services, Network or elsewhere\u003c/em\u003e – \u003cstrong\u003eis a Model\u003c/strong\u003e and should be cleanly abstracted from the View. Failure to isolate this mutable state within a Model abstraction represents a failure of application design.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eFollowing this rule dogmatically, I should probably have united the use of \u003ccode\u003eTimer\u003c/code\u003e and \u003ccode\u003eDate\u003c/code\u003e under a single \u0026ldquo;Time\u0026rdquo; Model abstraction in the app but at this point, it\u0026rsquo;s far from the biggest problem.\u003c/p\u003e\n\n\u003ch2 id=\"a-model-for-view-state\"\u003eA Model for View-state\u003c/h2\u003e\n\n\u003cp\u003eWe need a Model abstraction for the View-state.\u003c/p\u003e\n\n\u003cp\u003eIf you\u0026rsquo;ve never treated View-state as a Model before, this can be a strange statement to make. To understand what\u0026rsquo;s required, let\u0026rsquo;s start by looking at the Document Model that we already have.\u003c/p\u003e\n\n\u003ch3 id=\"the-existing-document-model\"\u003eThe existing \u003ccode\u003eDocument\u003c/code\u003e Model\u003c/h3\u003e\n\n\u003cp\u003eThe Document Model in the Clocks app is called \u003ccode\u003eDocument\u003c/code\u003e and offers the following mutating methods:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eaddTimezone\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003eidentifier\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eupdateTimezone\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003euuid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUUID\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enewName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eremoveTimezone\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003euuid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUUID\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eBy understanding the actions we can perform on the Model, we can understand the Model. These actions lead to the internal representation of the \u003ccode\u003eDocument\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003etimezones\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eUUID\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eTimezone\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[:]\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eTimezone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eCodable\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003euuid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUUID\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eidentifier\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe primitive storage for the \u003ccode\u003eDocument\u003c/code\u003e is just a collection of \u003ccode\u003eidentifier\u003c/code\u003e and \u003ccode\u003ename\u003c/code\u003e pairs, keyed by \u003ccode\u003euuid\u003c/code\u003e in a dictionary.\u003c/p\u003e\n\n\u003ch3 id=\"our-new-viewstate-model\"\u003eOur new \u003ccode\u003eViewState\u003c/code\u003e Model\u003c/h3\u003e\n\n\u003cp\u003eLet\u0026rsquo;s look at the View-state in a similar way. I\u0026rsquo;ve already discussed the major actions a user can perform:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003etap a row in the main table view to change the detail selection\u003c/li\u003e\n\u003cli\u003eenable or disable \u0026ldquo;Edit\u0026rdquo; mode on the main table view\u003c/li\u003e\n\u003cli\u003eshow or hide the new timezone selection view\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThere\u0026rsquo;s also scrolling in both the main table view and the new timezone selection view and a search field in the new timezone selection view for filtering the list.\u003c/p\u003e\n\n\u003cp\u003eThat\u0026rsquo;s the full list of user actions that don\u0026rsquo;t immediately result in a change to the \u003ccode\u003eDocument\u003c/code\u003e. That gives the following list of mutating methods for our new \u003ccode\u003eViewState\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003escrollMasterView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoffsetY\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003escrollSelectionView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eoffsetY\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eDouble\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003echangeDetailSelection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euuid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUUID\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003echangeEditModeOnMaster\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eBool\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003echangeSelectionViewVisibility\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003evisible\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eBool\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eselectionViewSearchString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe could represent the values that these methods change as 6 properties on a single struct but I think it\u0026rsquo;s better to organize these properties as a tree of structs, reflecting the actual Controllers in the View-tree.\u003c/p\u003e\n\n\u003cp\u003eThis gives a data representation of our \u003ccode\u003eViewState\u003c/code\u003e Model as follows:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esplitView\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSplitViewState\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSplitViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eSplitViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eCodable\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003emasterView\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eMasterViewState\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003edetailView\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eDetailViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003eselectionView\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSelectionViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eMasterViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eCodable\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003emasterScrollOffsetY\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eDouble\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003eisEditing\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eBool\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eSelectionViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eCodable\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003eselectionScrollOffsetY\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eDouble\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esearchText\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eDetailViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eCodable\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003euuid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUUID\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eLook back over the roughly 30 lines of declaration code in this section. These declarations are an abstract representation of the entire 600 line program.\u003c/p\u003e\n\n\u003ch2 id=\"from-presentation-driven-to-view-state-driven\"\u003eFrom Presentation driven to View-state driven\u003c/h2\u003e\n\n\u003cp\u003eWe\u0026rsquo;ll look at how this changes our code but first, lets look at how a \u0026ldquo;presentation\u0026rdquo; change occurred in the \u0026ldquo;undo-redo\u0026rdquo; version of the app.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"c1\"\u003e// Controller receives delegate action from View and invokes performSegue\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eoverride\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUITableView\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edidSelectRowAt\u003c/span\u003e \u003cspan class=\"n\"\u003eindexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIndexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eperformSegue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithIdentifier\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;showDetail\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Controller sends data to segue destination\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eoverride\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eprepare\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003esegue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIStoryboardSegue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eAny\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003esegue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eidentifier\u003c/span\u003e \u003cspan class=\"p\"\u003e==\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;showDetail\u0026#34;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n       \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eindexPath\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eindexPathForSelectedRow\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n           \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003etimezone\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esortedTimezones\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n           \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003econtroller\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esegue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edestination\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\n              \u003cspan class=\"n\"\u003eUINavigationController\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003etopViewController\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e \u003cspan class=\"n\"\u003eDetailViewController\u003c/span\u003e\n           \u003cspan class=\"n\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euuid\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etimezone\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euuid\u003c/span\u003e\n           \u003cspan class=\"n\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enavigationItem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eleftBarButtonItem\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e\n              \u003cspan class=\"n\"\u003esplitViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003edisplayModeButtonItem\u003c/span\u003e\n           \u003cspan class=\"n\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enavigationItem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eleftItemsSupplementBackButton\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n       \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAs clumsy as this code looks, it is almost unchanged from the \u0026ldquo;Master-Detail App\u0026rdquo; template. This is a \u003cem\u003epresentation driven\u003c/em\u003e transition. It starts by asking a the Controller to change the View-tree in the \u003ccode\u003etableView(_:didSelectRowAt:)\u003c/code\u003e function and then during the View-tree change in the \u003ccode\u003eprepare(for:sender:)\u003c/code\u003e function, it attempt to find and set data on the newly created view.\u003c/p\u003e\n\n\u003cp\u003eThere\u0026rsquo;s so much to \u003cem\u003edislike\u003c/em\u003e about this code but from a Model abstraction perspective, the biggest problem is that the code never clearly encodes its \u003cem\u003eintent\u003c/em\u003e. The \u003ccode\u003eperformSegue\u003c/code\u003e line implies that the intent is merely to \u0026ldquo;showDetail\u0026rdquo; but that\u0026rsquo;s not true: the intent is to show the selected \u003ccode\u003etimezone.uuid\u003c/code\u003e \u003cem\u003ein\u003c/em\u003e the detail view. The hideously ugly work performed in the \u003ccode\u003eprepare(for:sender:)\u003c/code\u003e function is mostly just trying to reconstruct the key operand of that intent from the crime-scene wreckage left behind on the Controller and \u003ccode\u003etableView\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s now look at this code in a View-state driven approach.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"c1\"\u003e// MasterViewController receives delegate action from View and invokes performSegue\u003c/span\u003e\n\u003cspan class=\"kr\"\u003eoverride\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUITableView\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edidSelectRowAt\u003c/span\u003e \u003cspan class=\"n\"\u003eindexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eIndexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echangeDetailSelection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003euuid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003esortedTimezones\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindexPath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003euuid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// SplitViewController receives delegate action from View and invokes performSegue\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003ehandleViewStateNotification\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSplitViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSplitViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echangedDetail\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"k\"\u003ewhere\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edetailView\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"n\"\u003emasterViewController\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003eperformSegue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithIdentifier\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;detail\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"c1\"\u003e// other actions omitted\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWe invoke an action on the \u003ccode\u003eViewState\u003c/code\u003e which changes the \u003cem\u003edata\u003c/em\u003e first – immediately declaring an intent to change the detail selection to the selected UUID – then the \u003ccode\u003eSplitViewController\u003c/code\u003e (not the \u003ccode\u003eMasterViewController\u003c/code\u003e) observes that data change and updates the detail presentation in response. We never need to set the \u003ccode\u003euuid\u003c/code\u003e directly on the \u003ccode\u003eDetailViewController\u003c/code\u003e – the \u003ccode\u003eDetailViewController\u003c/code\u003e subscribes to the \u003ccode\u003eViewState\u003c/code\u003e and learns what its \u003ccode\u003euuid\u003c/code\u003e is from there.\u003c/p\u003e\n\n\u003cp\u003eCompare this code sample to the \u0026ldquo;ideal Model-View-Controller\u0026rdquo; Model change back in the \u003ca href=\"#clocks\"\u003eClocks section\u003c/a\u003e. The two changes follow a nearly identical series of steps.\u003c/p\u003e\n\n\u003ch2 id=\"what-do-we-gain\"\u003eWhat do we gain?\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eYou can find the \u003ccode\u003eViewState\u003c/code\u003e build on the \u003ca href=\"https://github.com/mattgallagher/Clocks\"\u003e\u0026ldquo;master\u0026rdquo; branch of the Clocks github repository\u003c/a\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch3 id=\"time-travel\"\u003eTime-travel\u003c/h3\u003e\n\n\u003cp\u003eUnlike the \u0026ldquo;undoredo\u0026rdquo; branch of this project, dragging the slider on the \u0026ldquo;master\u0026rdquo; branch offers full \u003cem\u003etime-travel\u003c/em\u003e.\u003c/p\u003e\n\n\u003cdiv style=\"text-align:center\"\u003e\u003cvideo style=\"border:1px solid black;\" src=\"/assets/blog/clocks_timetravel.mp4\" controls /\u003e\u003c/div\u003e\n\n\u003cfigcaption\u003eA video of adding and deleting \"Casablanca\" then using the slider to wind the entire user-interface forwards and backwards through the action.\u003c/figcaption\u003e\n\n\u003cp\u003eIronically, for an app that displays world time, time-travel will not affect the time displayed on any of the clocks since (state from \u003ccode\u003eTimer\u003c/code\u003e and \u003ccode\u003eDate\u003c/code\u003e is deliberately omitted from the \u003ccode\u003eHistoryViewController\u003c/code\u003e).\u003c/p\u003e\n\n\u003cp\u003eWhat time-travel means is that the slider at the bottom of the screen will rewind the \u003ccode\u003eViewState\u003c/code\u003e at the same time as the \u003ccode\u003eDocument\u003c/code\u003e, resulting in an entire app user-interface that can be wound forward and backward with the slider. Edit mode will pop on and off, the detail view will pop in and out, the selection view will appear and disappear, the scroll position will adjust, uncommitted text fields will wind forward and backward like committed text fields.\u003c/p\u003e\n\n\u003cp\u003eIf you\u0026rsquo;ve never seen a time-travelling user-interface before, I strongly recommend actually running the project and playing with the slider. It \u003cem\u003eshouldn\u0026rsquo;t\u003c/em\u003e be surprising to see an application instantly and completely respond to commands but it \u003cem\u003eis\u003c/em\u003e. We\u0026rsquo;re accustomed to being perpetually out-of-control of our own applications.\u003c/p\u003e\n\n\u003cp\u003eThe slider has a \u003ccode\u003eUISwitch\u003c/code\u003e on the left. When you activate the slider, it will split into separate sliders for \u0026ldquo;Document\u0026rdquo; and \u0026ldquo;View-state\u0026rdquo; so you can manipulate the two independently. This will occasionally result in quirks where the \u0026ldquo;View-state\u0026rdquo; needs to be altered to reconcile it with the \u0026ldquo;Document\u0026rdquo; but it\u0026rsquo;s proof that the two are truly separate models.\u003c/p\u003e\n\n\u003ch3 id=\"viewstate-acts-as-a-coordinator\"\u003e\u003ccode\u003eViewState\u003c/code\u003e acts as a \u0026ldquo;Coordinator\u0026rdquo;\u003c/h3\u003e\n\n\u003cp\u003eWith a View-state Model, separate controllers can implicitly coordinate by tracking the same data in the View-state Model. There\u0026rsquo;s no longer a need for the \u003ccode\u003eMasterViewController\u003c/code\u003e to traverse through the view and controller hierarchy to set values on the \u003ccode\u003eDetailViewController\u003c/code\u003e – the \u003ccode\u003eDetailViewController\u003c/code\u003e can simply ask the \u003ccode\u003eViewState\u003c/code\u003e for its values.\u003c/p\u003e\n\n\u003cp\u003eIn a presentation driven app, there\u0026rsquo;s an instinct to handle the full path of all actions on the Controller where the action is received. This dumps a lot of work on the \u003ccode\u003eMasterViewController\u003c/code\u003e, even though it\u0026rsquo;s not the parent of many of the actions it coordinates.\u003c/p\u003e\n\n\u003cp\u003eWith a View-state Model, the presentation of the \u003ccode\u003eSelectionViewController\u003c/code\u003e and \u003ccode\u003eDetailViewController\u003c/code\u003e can be managed by the actual parent of these actions (the \u003ccode\u003eSplitViewController\u003c/code\u003e) rather than trying to handle all this work from the table view in the \u003ccode\u003eMasterViewController\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eSome design patterns use a \u003ca href=\"http://khanlou.com/2015/01/the-coordinator/\"\u003e\u0026ldquo;Coordinator\u0026rdquo;\u003c/a\u003e to actively propagate communication between Controllers. The \u003ccode\u003eViewState\u003c/code\u003e fulfills a similar role through passively observed Model-data, rather than actively propagated Control-actions.\u003c/p\u003e\n\n\u003ch3 id=\"persistence-is-trivial\"\u003ePersistence is trivial\u003c/h3\u003e\n\n\u003cp\u003eIn a typical Cocoa app, we rely on Storyboards to help persist view controllers. Even with the help of Storyboards, there is often substantial \u003ccode\u003eUIStateRestoring\u003c/code\u003e or \u003ccode\u003eUIDataSourceModelAssociation\u003c/code\u003e work to fully restore our state.\u003c/p\u003e\n\n\u003cp\u003eWith \u003ccode\u003eViewState\u003c/code\u003e, all commit and verify work is already part of the \u003ccode\u003eViewState\u003c/code\u003e observing pipeline so everything is automatic. No \u003ccode\u003eUIStateRestoring\u003c/code\u003e or \u003ccode\u003eUIDataSourceModelAssociation\u003c/code\u003e needed. In fact, you don\u0026rsquo;t even need Storyboards.\u003c/p\u003e\n\n\u003cp\u003eAssuming you\u0026rsquo;re already handling the \u003ccode\u003eViewState\u003c/code\u003e notifications correctly, this is \u003cem\u003eall\u003c/em\u003e the code required for state restoration:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eapplication\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003eapplication\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewillEncodeRestorableStateWith\u003c/span\u003e\n   \u003cspan class=\"n\"\u003ecoder\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eNSCoder\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"n\"\u003ecoder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eencode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eserialized\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003eforKey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eviewStateKey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eapplication\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003eapplication\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edidDecodeRestorableStateWith\u003c/span\u003e\n   \u003cspan class=\"n\"\u003ecoder\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eNSCoder\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003edata\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecoder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edecodeObject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eforKey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eviewStateKey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003eData\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereloadAndNotify\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejsonData\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"restoring-state-for-testing-scenarios\"\u003eRestoring state for testing scenarios\u003c/h3\u003e\n\n\u003cp\u003eSince restoring the user-interface is no longer tied to \u003ccode\u003eUIStateRestoration\u003c/code\u003e or Storyboards, you can jump to a particular user-interface configuration at any time – speeding development and debugging scenarios.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ejsonString\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;\n\u003c/span\u003e\u003cspan class=\"s\"\u003e   {\u0026#34;\u003c/span\u003e\u003cspan class=\"n\"\u003edetailView\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;:{\u0026#34;\u003c/span\u003e\u003cspan class=\"n\"\u003euuid\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;:\u0026#34;\u003c/span\u003e\u003cspan class=\"mi\"\u003e8642\u003c/span\u003e\u003cspan class=\"n\"\u003eFA12\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eD3F7\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e48\u003c/span\u003e\u003cspan class=\"n\"\u003eB6\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eB308\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"n\"\u003eB415A7145D0\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;},\n\u003c/span\u003e\u003cspan class=\"s\"\u003e   \u0026#34;\u003c/span\u003e\u003cspan class=\"n\"\u003emasterView\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;:{\u0026#34;\u003c/span\u003e\u003cspan class=\"n\"\u003emasterScrollOffsetY\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;:0,\u0026#34;\u003c/span\u003e\u003cspan class=\"n\"\u003eisEditing\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;:false}}\n\u003c/span\u003e\u003cspan class=\"s\"\u003e   \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ejsonData\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonString\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eusing\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eutf8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\n\u003cspan class=\"n\"\u003eViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshared\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereloadAndNotify\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ejsonData\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonData\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf your document also supports arbitrary reloading (as the \u003ccode\u003eDocument\u003c/code\u003e does in the Clocks app) you can combine the two to jump to any debug or testing scenario at any time.\u003c/p\u003e\n\n\u003ch3 id=\"debug-information\"\u003eDebug information\u003c/h3\u003e\n\n\u003cp\u003eThe entire state of the view can be logged to the console on each step, enabling better debugging – you can know the exact state at any time (and the preceding transitions) so you can quickly find the cause of problems.\u003c/p\u003e\n\n\u003cp\u003eThe Clocks app logs both its Document and View-state when either changes:\u003c/p\u003e\n\n\u003cpre\u003e\u003ccode\u003eChanged Document to:\n[\u0026quot;CC0D7C93-3FBC-4D89-9127-ABBF798420F6\u0026quot;,{\u0026quot;identifier\u0026quot;:\u0026quot;Australia\\/Melbourne\u0026quot;,\n\u0026quot;name\u0026quot;:\u0026quot;Melbourne\u0026quot;,\u0026quot;uuid\u0026quot;:\u0026quot;CC0D7C93-3FBC-4D89-9127-ABBF798420F6\u0026quot;},\n\u0026quot;54FA679F-6036-431D-957F-6E8CC1B8DA50\u0026quot;,{\u0026quot;identifier\u0026quot;:\u0026quot;Africa\\/Addis_Ababa\u0026quot;,\n\u0026quot;name\u0026quot;:\u0026quot;Addis Ababa\u0026quot;,\u0026quot;uuid\u0026quot;:\u0026quot;54FA679F-6036-431D-957F-6E8CC1B8DA50\u0026quot;}]\nChanged ViewState to:\n{\u0026quot;detailView\u0026quot;:{\u0026quot;uuid\u0026quot;:\u0026quot;CC0D7C93-3FBC-4D89-9127-ABBF798420F6\u0026quot;},\u0026quot;masterView\u0026quot;:\n\u0026quot;masterScrollOffsetY\u0026quot;:0,\u0026quot;isEditing\u0026quot;:false}}\n\u003c/code\u003e\u003c/pre\u003e\n\n\u003cp\u003eThis logged state can be directly used in state restoration – as in the previous example – to recreate the scenario at any time.\u003c/p\u003e\n\n\u003ch2 id=\"what-is-the-cost\"\u003eWhat is the cost?\u003c/h2\u003e\n\n\u003ch3 id=\"code-size\"\u003eCode size\u003c/h3\u003e\n\n\u003cp\u003eTracking the View-state is usually more code. This is no different to any kind of Model – there are more declarations and more work to set and observe changes going into and out of the model abstraction.\u003c/p\u003e\n\n\u003cp\u003eMeasuring the \u0026ldquo;.swift\u0026rdquo; file size (excluding the \u0026ldquo;Utilities\u0026rdquo; folder) with the command-line tool \u003ca href=\"https://github.com/AlDanial/cloc\"\u003ecloc\u003c/a\u003e:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ethe \u0026ldquo;undoredo\u0026rdquo; version of the project is 437 lines\u003c/li\u003e\n\u003cli\u003ethe \u0026ldquo;timetravel\u0026rdquo; version is 610 lines\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e85 lines of that difference is the \u0026ldquo;ViewState.swift\u0026rdquo; file. The remaining 88 line difference is more complicated; it\u0026rsquo;s more like a 150 line difference, sometimes an increase, sometimes a decrease.\u003c/p\u003e\n\n\u003cp\u003eWithout needing to go via \u003ccode\u003eViewState\u003c/code\u003e, the \u0026ldquo;undoredo\u0026rdquo; branch has a few buttons connected directly to segues in the Storyboard. The \u0026ldquo;undoredo\u0026rdquo; branch also doesn\u0026rsquo;t track scrolling (the \u0026ldquo;timetravel\u0026rdquo; build could omit this but it\u0026rsquo;s part of making time-travel seem magical).\u003c/p\u003e\n\n\u003cp\u003eTracking View-state doesn\u0026rsquo;t always increase code size. For some tasks, it simplifies. The \u003ccode\u003eDetailViewController\u003c/code\u003e actually benefits from not needing to self-manage when the \u003ccode\u003eTimezone\u003c/code\u003e it is observing is deleted from the \u003ccode\u003eDocument\u003c/code\u003e. All \u0026ldquo;prepare for segue\u0026rdquo; methods are removed from \u003ccode\u003eMasterViewController\u003c/code\u003e. All \u003ccode\u003eUIStateRestoring\u003c/code\u003e methods are removed.\u003c/p\u003e\n\n\u003ch3 id=\"lots-of-observing\"\u003eLots of observing\u003c/h3\u003e\n\n\u003cp\u003eIn an app without View-state, you might need to observe just one object – the Document Model – in each Controller. If you add View-state to this, your observation needs are going to double.\u003c/p\u003e\n\n\u003cp\u003eMy particular implementation of observing for the \u003ccode\u003eDocument\u003c/code\u003e and \u003ccode\u003eViewState\u003c/code\u003e doubles this \u003cem\u003eagain\u003c/em\u003e. Have a look at the \u003ccode\u003ehandleViewStateNotification\u003c/code\u003e for the \u003ccode\u003eSelectionViewController\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003ehandleViewStateNotification\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSelectionViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eSelectionViewState\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eAction\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003eaction\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echangedSearchString\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"n\"\u003eupdateForSearchString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esearchText\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003escrolled\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003econtentOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCGFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselectionScrollOffsetY\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kr\"\u003enone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"n\"\u003etableView\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003econtentOffset\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eCGFloat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselectionScrollOffsetY\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"n\"\u003esearchBar\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esearchText\u003c/span\u003e\n      \u003cspan class=\"n\"\u003eupdateForSearchString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esearchText\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis function has to handle two possible \u003ccode\u003eViewState\u003c/code\u003e actions – \u0026ldquo;search string change\u0026rdquo; and \u0026ldquo;search table scrolled\u0026rdquo; – but it \u003cem\u003ealso\u003c/em\u003e has to handle a third \u003ccode\u003e.none\u003c/code\u003e case which is used when the \u003ccode\u003eViewState\u003c/code\u003e is reloaded and \u003cem\u003eeverything\u003c/em\u003e needs to be reprocessed.\u003c/p\u003e\n\n\u003cp\u003eIt would be nice to avoid this redundancy but I\u0026rsquo;m not sure how to do this cleanly since sometimes, responding to an already applied action and restoring state requires slightly different logic (see the need to set the \u003ccode\u003esearchBar?.text\u003c/code\u003e during restore which isn\u0026rsquo;t needed on \u003ccode\u003e.changedSearchString\u003c/code\u003e because the user has \u003cem\u003ealready\u003c/em\u003e set this value).\u003c/p\u003e\n\n\u003ch3 id=\"uncooperative-uikit-appkit-classes\"\u003eUncooperative UIKit/AppKit classes\u003c/h3\u003e\n\n\u003cp\u003eThe hardest part when writing an application for the first time in a View-state driven approach is learning how to handle Views and Controllers that fail to precisely notify when changes occur and refuse to accurately adhere to state they are given.\u003c/p\u003e\n\n\u003cp\u003eTo be clear: none of these are show stopping problems, nor even particularly difficult to manage, but they all require guesswork and multiple steps since Cocoa classes were never written to clearly notify changes in state or follow programmatic (rather than user) instructions.\u003c/p\u003e\n\n\u003ch4 id=\"conflicting-actions\"\u003eConflicting actions\u003c/h4\u003e\n\n\u003cp\u003eMultiple \u0026ldquo;present\u0026rdquo; animations are not permitted to occur at the same time – so if you\u0026rsquo;re trying to restore two pieces of state simultaneously, these might need to be queued – otherwise the app will raise an exception. This causes problems in the Clocks app when the modal \u0026ldquo;Selection\u0026rdquo; screen and the \u0026ldquo;Detail\u0026rdquo; view need to be restored at the same time. The \u003ccode\u003eSplitViewController\u003c/code\u003e class contains some careful sequencing interaction between \u003ccode\u003eselectionViewController\u003c/code\u003e and \u003ccode\u003ereloadDetailView\u003c/code\u003e to avoid problems.\u003c/p\u003e\n\n\u003cp\u003eA less fatal conflict occurs when trying to set a scroll position during \u003ccode\u003eUITableView\u003c/code\u003e reloads. The \u003ccode\u003eUITableView\u003c/code\u003e reloads asynchronously over an indeterminate amount of time. There is no way to queue the scroll position change to occur when this operation is complete. When a \u003ccode\u003etableView.reloadData()\u003c/code\u003e occurs, \u003ccode\u003eMasterViewController\u003c/code\u003e does not bother to set the scroll position at all since I was not able to find a reliable way to both reload data and scroll.\u003c/p\u003e\n\n\u003ch4 id=\"poorly-notified-changes\"\u003ePoorly notified changes\u003c/h4\u003e\n\n\u003cp\u003e\u003ccode\u003eUINavigationController\u003c/code\u003e may change its navigation stack without explaining why when the user taps the back button. The \u003ccode\u003enavigationController(_:didShow:animated:)\u003c/code\u003e method is forced to guess what may have happened.\u003c/p\u003e\n\n\u003cp\u003eDetecting scroll state presents a slightly different problem: to detect when scrolling has ended, you need to implement \u003cem\u003etwo\u003c/em\u003e separate delegate methods – \u003ccode\u003escrollViewDidEndDecelerating\u003c/code\u003e and \u003ccode\u003escrollViewDidEndDragging\u003c/code\u003e – and carefully check the \u003ccode\u003edecelerate\u003c/code\u003e parameter on the latter to determine if it is actually the end of scrolling.\u003c/p\u003e\n\n\u003ch4 id=\"user-actions-with-no-clear-programmatic-equivalent\"\u003eUser-actions with no clear programmatic equivalent\u003c/h4\u003e\n\n\u003cp\u003eIn portrait on an iPhone, the detail view of the split view will also collapse onto the master view\u0026rsquo;s navigation stack. The user can tap the back button to remove this collapsed view but there\u0026rsquo;s no clean action to ask the split view to do it. It\u0026rsquo;s necessary to check the \u003ccode\u003eUINavigationController\u003c/code\u003e and \u003cem\u003eguess\u003c/em\u003e whether the top view is a collapsed detail view and use \u003ccode\u003epopViewController\u003c/code\u003e to evict it. Messy work.\u003c/p\u003e\n\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eYou can explore the two versions of the Clocks app on github:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/mattgallagher/Clocks/tree/undoredo\"\u003ethe \u0026ldquo;undoredo\u0026rdquo; branch of the Clocks app\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/mattgallagher/Clocks\"\u003ethe master, aka \u0026ldquo;timetravel\u0026rdquo; branch of the Clocks app\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e(\u003cstrong\u003eMinor note\u003c/strong\u003e: when debugging one branch after using the other, you may see non-fatal state restoration errors as the two apps contain incompatible state restoration formats.)\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThe purpose of this article was to present an approach for tracking View-state in an application that is otherwise as close as possible to a typical Cocoa Model-View-Controller application.\u003c/p\u003e\n\n\u003cp\u003eI would argue that tracking View-state in a Model is more true to the spirit of Model-View-Controller than the traditional \u0026ldquo;ignore View-state\u0026rdquo; approach. When you track View-state in a Model, then the sum of Models in your app is truly a representation of your \u003cem\u003eentire\u003c/em\u003e app and your View is the simple display of the Model that it should be, rather than being a complex combination of Model plus other untracked state.\u003c/p\u003e\n\n\u003cp\u003eAs I write this article, I have now written a handful of trivial to small apps using this pattern. It manages navigation and state restoration really well while offering good conceptual clarity and excellent debugging capabilities. I think I\u0026rsquo;ll continue to write all small MVC apps this way. Observing both View-state and the Model on each Controller does get a little tiring and some Cocoa classes can feel truly obstinate when you\u0026rsquo;re trying to get them to behave precisely and punctually but the balance still feels strongly in favor of this approach.\u003c/p\u003e\n\n\u003cp\u003eThere are numerous frameworks that aim to simplify issues with observing multiple Models or driving Cocoa classes through data by using reactive programming or reducers. However, these bigger frameworks increase the distance between the code you write and the effects of that code. The advantage to this View-state approach is that there is no real framework \u0026ldquo;in the way\u0026rdquo;.\u003c/p\u003e\n\n\u003cp\u003eThe time-travel capability in the Clocks app is fun but you\u0026rsquo;d never ship time-travel in a real application. Even when debugging, simple View-state logging and the ability to restore your UI from JSON at any time are far more useful tools. I actually keep View-state logging on all the time because it is \u003cem\u003ereally\u003c/em\u003e helpful when something goes wrong – you can immediately understand if the problem was due to mis-setting View-state or mis-interpreting/observing.\u003c/p\u003e\n\n\u003cp\u003eHowever, time-travel is \u003cem\u003econceptually\u003c/em\u003e important for programmers who have forgotten that our programs are supposed to precisely and punctually obey our intent. Speaking for myself, I know that I had grown accustomed to boringly repetitive human-driven actions to arrange the user-interface while developing or testing. Launching the debugger directly into the precise state that I\u0026rsquo;m developing and testing has huge benefits (yes, \u003ccode\u003eUIStateRestoration\u003c/code\u003e is supposed to do this but it\u0026rsquo;s far more opaque and difficult to control).\u003c/p\u003e\n\n\u003ch3 id=\"looking-forward\"\u003eLooking forward\u003c/h3\u003e\n\n\u003cp\u003eOne of the biggest drawbacks of this approach is the need for extensive observing code on the view controller that grows more complex with view properties that are interdependent on both the View-state and the Document.\u003c/p\u003e\n\n\u003cp\u003eIn the next article, I\u0026rsquo;ll start by simplifying these observations with reactive programming and then continue to improve the syntax by building views in code with all behaviors fully specified.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eSelf promotion? On my own blog?!\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003eThis pattern, along with other experimental and conventional patterns and architectural techniques, are examined in depth in a book I\u0026rsquo;m writing with \u003ca href=\"https://twitter.com/chriseidhof\"\u003eChris Eidhof\u003c/a\u003e and \u003ca href=\"https://twitter.com/floriankugler\"\u003eFlorian Kugler\u003c/a\u003e from \u003ca href=\"https://www.objc.io\"\u003eobjc.io\u003c/a\u003e titled \u003ca href=\"https://www.objc.io/books/app-architecture/\"\u003eApp Architecture\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.objc.io/books/app-architecture/\"\u003e\u003cimg src=\"/assets/blog/app_architecture.png\" alt=\"App Architecture\" /\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.objc.io/books/app-architecture/\"\u003eYou can \u003cstrong\u003eorder now\u003c/strong\u003e in Early Access to get the first chapter immediately and subsequent chapters as they\u0026rsquo;re released\u003c/a\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n",
            "date_published": "2017-11-08T13:40:42+11:00"
        }
        
        , {
            "title": "The worst possible application",
            "id": "https://www.cocoawithlove.com/blog/worst-possible-application.html",
            "url": "https://www.cocoawithlove.com/blog/worst-possible-application.html",
            "content_html": "\n\n\u003cp\u003eIn this article, I deliberately try to write the worst possible application by breaking the primary rule of application design: keep the model and view separate.\u003c/p\u003e\n\n\u003cp\u003eThe purpose is to try to answer a question clearly: what direct effect does an application design pattern have on code? In an otherwise simple, clean implementation, will an application have any obvious flaws if I follow the worst possible application design pattern? Will it get dramatically better if I switch back to a more common pattern?\u003c/p\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\n\u003ch2 id=\"a-topic-of-contradictions\"\u003eA topic of contradictions\u003c/h2\u003e\n\n\u003cp\u003eIt is really difficult to make an unambiguously true statement when talking about application design patterns. The problem is that there\u0026rsquo;s a huge distance between the vague, high-level descriptions provided by application design patterns and the specific details of an application implementation. This distance creates a situation where almost anything can be true in the implementation, despite the intentions of the application design pattern.\u003c/p\u003e\n\n\u003cp\u003eOut of frustration, with the entire field of application architecture, I decided to take a different approach: deliberately write an app using the worst possible application design pattern. Perhaps if I made some serious mistakes, they would have dramatic, visible effects and I could start to build a foundation for talking about application design patterns in a clear and unambiguous manner.\u003c/p\u003e\n\n\u003ch2 id=\"seeking-out-disaster\"\u003eSeeking out disaster\u003c/h2\u003e\n\n\u003cp\u003eWhat\u0026rsquo;s the worst possible application design pattern?\u003c/p\u003e\n\n\u003cp\u003eI deliberately devised 5 scenarios that I felt seriously undermined the typical Cocoa Model-View-Controller pattern and discussed them with 4 different Cocoa programmers that I work with, presenting each scenario as though I had encountered it in a real app, to see which mistake people thought was the worst.\u003c/p\u003e\n\n\u003cp\u003eHere are the scenarios I presented:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThe app has a 4500 line \u003ccode\u003eUIViewController\u003c/code\u003e and changing any method seems to break the behavior of every child view.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eIt was pointed out that this isn\u0026rsquo;t a design pattern mistake as much as an implementation issue. While it is common – to the point of cliché – it can be handled through standard refactoring and decomposition steps.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThe Model contains blocks of CoreGraphics drawing code which are passed through to the View as a closure for rendering.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eA few people bought into the premise that this could be a valid approach; maybe it doesn\u0026rsquo;t seem different enough to passing around SVG data. I still think it has untapped potential as one of the worst ideas imaginable.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThe Model holds references to each of the app\u0026rsquo;s Controllers and when a value changes the Model directly invokes refresh on Controllers it knows to be dependent on the changed value.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThis evoked some actual groans. It might be the most mind bogglingly stupid of the scenarios that I presented but much of that stupidity derives from how simple the solution is (set up proper observers/notifications).\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThe app has 3 separate Models and it\u0026rsquo;s the View Controller\u0026rsquo;s responsibility to keep them all in sync.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eIf you tell people that you\u0026rsquo;re coordinating data from 3 different web services in a single View Controller, suddenly it seems like a real-world problem and people start suggesting practical solutions; not nearly terrible enough.\u003c/p\u003e\n\n\u003cp\u003eI decided the winner was the only application architectural mistake where:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003enobody tried to tell me the problem could be fixed with a simple refactoring\u003c/li\u003e\n\u003cli\u003enobody bought into the idea that you should ever write an app this way\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eDrumroll\u0026hellip;\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThere\u0026rsquo;s no separate Model in the app. Data is stored in whatever View requires it and the Controllers coordinate changes and communication between Views.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eI think this is one of the least exciting mistakes (after the totally banal \u0026ldquo;massive view controller\u0026rdquo;) but after decades of having Model-View-Controller drummed into our collective minds, \u0026ldquo;Failure to separate the Model and View\u0026rdquo; is widely agreed to be the worst possible mistake in application design.\u003c/p\u003e\n\n\u003cp\u003eVery well then, let\u0026rsquo;s make it happen!\u003c/p\u003e\n\n\u003ch2 id=\"unseparated\"\u003eUnseparated\u003c/h2\u003e\n\n\u003cp\u003eWhat does \u0026ldquo;Failure to separate the Model and View\u0026rdquo; mean?\u003c/p\u003e\n\n\u003cp\u003eUnfortunately, like everything else in application design patterns, it\u0026rsquo;s difficult to get a concrete answer. Prominent authors have written \u003ca href=\"https://martinfowler.com/eaaDev/SeparatedPresentation.html\"\u003ewhole articles on this type of separation\u003c/a\u003e without giving a single clear rule.\u003c/p\u003e\n\n\u003cp\u003eI\u0026rsquo;m going to use the following rules for a \u003cstrong\u003eseparated Model and View\u003c/strong\u003e:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eA Model interface must cleanly encapsulate all application state and must not reference any view or application frameworks.\u003c/li\u003e\n\u003cli\u003eNon-Model components may invoke mutating actions on the Model interface but the interface must present these as requests to perform an action, not primitive data operations.\u003c/li\u003e\n\u003cli\u003eAfter performing an action on the Model interface, a non-Model component must not immediately update or refresh any non-Model state. Updates dependent on Model data may occur only in response to change notifications from the Model.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003e\u0026ldquo;Failure to separate the Model and View\u0026rdquo; will be defined as breaking one or more of these rules.\u003c/p\u003e\n\n\u003cp\u003eIt might not be immediately clear why I\u0026rsquo;ve chosen all of these three rules but in short: it forces the Model to be walled off from the rest of the app and forces the rest of the app to avoid assuming how the Model works.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eSpoilers:\u003c/strong\u003e This article will eventually discuss \u0026ldquo;leaky abstractions\u0026rdquo;. Avoiding leaky abstractions is the real reason why it\u0026rsquo;s so important for the non-Model components to carefully avoid assuming how the internals of the Model work.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2 id=\"there-s-an-app-for-that\"\u003eThere\u0026rsquo;s an app for that\u003c/h2\u003e\n\n\u003cp\u003eIt turns out that I\u0026rsquo;ve already shared an example of a program that lacked Model and View separation. A few months ago, I \u003ca href=\"/blog/porting-from-macos8-to-sierra.html\"\u003eshared my \u0026ldquo;Mines\u0026rdquo; code from nearly 20 years ago\u003c/a\u003e. However the use of 90s era Classic MacOS C++ in that implementation gets in the way of a proper in-depth discussion. So I took a couple hours and implemented a streamlined version as an Swift iOS app.\u003c/p\u003e\n\n\u003cp\u003eI present the end result, totally devoid of any Model separation, \u003ca href=\"https://github.com/mattgallagher/CwlWorstPossibleApplication\"\u003eMines for iOS\u003c/a\u003e:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/blog/mines_screenshot.png\" alt=\"Figure 1: Mines\" /\u003e\n\u003cfigcaption\u003eMines for iOS\u003c/figcaption\u003e\u003c/p\u003e\n\n\u003cp\u003eThat seems about right: the worst possible application is a Minesweeper clone.\u003c/p\u003e\n\n\u003ch2 id=\"a-quick-summary-of-the-app\"\u003eA quick summary of the app\u003c/h2\u003e\n\n\u003cp\u003eThe app\u0026rsquo;s content is the minefield. I\u0026rsquo;ve used 100 squares (intended to be presented in a 10 by 10 grid). Each square potentially contains one of the 15 mines, randomly distributed on new game and each square starts covered but can be manually flagged or uncovered.\u003c/p\u003e\n\n\u003cp\u003eThere\u0026rsquo;s no other data \u003cem\u003erequired\u003c/em\u003e by the app but I\u0026rsquo;ve chosen to cache the number of adjacent mines for each square and the number of non-mine squares remaining to be uncovered before the game is considered \u0026ldquo;won\u0026rdquo;. The app includes a \u0026ldquo;Flag mode\u0026rdquo; slider but its value is considered \u0026ldquo;transient view-state\u0026rdquo; and it is omitted from the Model.\u003c/p\u003e\n\n\u003cp\u003eIf the app had a separate Model, it would include:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eThe 100 squares, each with \u003ccode\u003eisMine\u003c/code\u003e, \u003ccode\u003eadjacent\u003c/code\u003e and \u003ccode\u003ecovered\u003c/code\u003e values\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003enonMineSquaresRemaining\u003c/code\u003e count\u003c/li\u003e\n\u003cli\u003eFunctions to generate the squares for a new game (including \u003ccode\u003eisMine\u003c/code\u003e distribution and \u003ccode\u003eadjacent\u003c/code\u003e counts).\u003c/li\u003e\n\u003cli\u003eA function to handle clicking on a square (which might uncover or flag the square and might need to update the \u003ccode\u003enonMineSquaresRemaining\u003c/code\u003e count).\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eOf course, the app doesn\u0026rsquo;t have a separate Model because that would be too sensible.\u003c/p\u003e\n\n\u003ch2 id=\"breaking-all-the-rules\"\u003eBreaking all the rules\u003c/h2\u003e\n\n\u003cp\u003eLet\u0026rsquo;s look at what horrible things I\u0026rsquo;ve done by comparing against the rules I gave for a properly separated Model.\u003c/p\u003e\n\n\u003ch3 id=\"1-model-must-be-encapsulated-and-must-not-reference-the-view-or-application-framework\"\u003e1. Model must be encapsulated and must not reference the view or application framework\u003c/h3\u003e\n\n\u003cp\u003eEach of the \u003ccode\u003eSquareView\u003c/code\u003e objects (instances of \u003ccode\u003eUIButton\u003c/code\u003e) which represent the tiles in the game contains the following properties:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ecovering\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eCovering\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecovered\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003eisMine\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eBool\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003eadjacent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt8\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThis is not a cached representation of state store in another location, this is the \u003cem\u003eonly\u003c/em\u003e representation of the minefield, spread across the 100 different \u003ccode\u003eUIButton\u003c/code\u003e subclass instances used to display the minefield.\u003c/p\u003e\n\n\u003cp\u003eIt\u0026rsquo;s as big a violation of rule 1 as possible.\u003c/p\u003e\n\n\u003ch3 id=\"2-the-model-interface-must-expose-actions-not-primitive-data-operations\"\u003e2. The Model interface must expose actions, not primitive data operations\u003c/h3\u003e\n\n\u003cp\u003eThe primary change that occurs during the game is updating state when a square is tapped. How does this change occur?\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"c1\"\u003e// In a function on the GameViewController...\u003c/span\u003e\n\u003cspan class=\"n\"\u003esquareViews\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003ecovering\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euncovered\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn short: when a \u003ccode\u003eSquareView\u003c/code\u003e is tapped, it sends its action to the \u003ccode\u003eGameViewController\u003c/code\u003e which maintains an array of the \u003ccode\u003eSquareView\u003c/code\u003e buttons that comprise the minefield. The \u003ccode\u003eGameViewController\u003c/code\u003e reaches directly into the affected \u003ccode\u003eSquareView\u003c/code\u003e and directly edits its \u003ccode\u003ecovering\u003c/code\u003e property.\u003c/p\u003e\n\n\u003cp\u003eIt\u0026rsquo;s as big a violation of rule 2 as possible.\u003c/p\u003e\n\n\u003ch3 id=\"3-updates-may-occur-only-in-response-to-change-notifications-from-the-model\"\u003e3. Updates may occur only in response to change notifications from the Model\u003c/h3\u003e\n\n\u003cp\u003eHere\u0026rsquo;s the code invoked when you click on a mine:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003esquareView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisMine\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"n\"\u003esquareView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecovering\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003euncovered\u003c/span\u003e\n   \u003cspan class=\"n\"\u003enonMineSquaresRemaining\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n   \u003cspan class=\"n\"\u003erefreshSquaresToClear\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n   \u003cspan class=\"n\"\u003esquareView\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esetNeedsDisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eWhen the \u003ccode\u003eGameViewController\u003c/code\u003e changes either the \u003ccode\u003ecovering\u003c/code\u003e property on a \u003ccode\u003eSquareView\u003c/code\u003e or the \u003ccode\u003enonMineSquaresRemaining\u003c/code\u003e value on itself, it must also call either \u003ccode\u003esetNeedsUpdate\u003c/code\u003e on the \u003ccode\u003eSquareView\u003c/code\u003e or \u003ccode\u003erefreshSquaresToClear\u003c/code\u003e on itself to force a refresh.\u003c/p\u003e\n\n\u003cp\u003eIt\u0026rsquo;s as big a violation of rule 3 as possible.\u003c/p\u003e\n\n\u003ch2 id=\"how-horrible-is-the-result\"\u003eHow horrible is the result?\u003c/h2\u003e\n\n\u003cp\u003eThe \u003ccode\u003eGameViewController\u003c/code\u003e feels like two completely different classes smashed together – it\u0026rsquo;s clearly doing too many things.\u003c/p\u003e\n\n\u003cp\u003eAnd the \u003ccode\u003eSquareView\u003c/code\u003e (a \u003ccode\u003eUIButton\u003c/code\u003e subclass) contains \u003ccode\u003einit(fromDictionary:)\u003c/code\u003e and \u003ccode\u003etoDictionary()\u003c/code\u003e functions to aid serialization and deserialization during \u003ccode\u003eUIStateRestoration\u003c/code\u003e – an assignment of responsibility that seems hilariously misplaced.\u003c/p\u003e\n\n\u003cp\u003eBut the app isn\u0026rsquo;t a complete mess. The underlying logic remains clear and simple and none of the work seems laborious or chaotic.\u003c/p\u003e\n\n\u003cp\u003eI wanted a horror show but there\u0026rsquo;s nothing particularly horrific here. Maybe this experiment isn\u0026rsquo;t working.\u003c/p\u003e\n\n\u003ch2 id=\"properly-separated-model-view-controller\"\u003eProperly separated Model-View-Controller\u003c/h2\u003e\n\n\u003cp\u003ePerhaps I need a more direct comparison with a more typical Model-View-Controller implementation to really highlight what\u0026rsquo;s wrong here.\u003c/p\u003e\n\n\u003cp\u003eFor this implementation, \u003ca href=\"https://github.com/mattgallagher/CwlWorstPossibleApplication/tree/separated\"\u003eplease look at the \u0026ldquo;separated\u0026rdquo; branch in the repository\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eIn this version,  \u003ccode\u003eSquare\u003c/code\u003e and \u003ccode\u003eGame\u003c/code\u003e are new types in the new \u003ca href=\"https://github.com/mattgallagher/CwlWorstPossibleApplication/blob/separated/CwlWorstPossibleApplication/Game.swift\"\u003eGame.swift file\u003c/a\u003e. \u003ccode\u003eGame\u003c/code\u003e is the interface to the Model, its only mutating function is \u003ccode\u003etapSquare\u003c/code\u003e and changes must be observed through the \u003ccode\u003eGame.changed\u003c/code\u003e notification.\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eSquare\u003c/code\u003e contains the game-related data members that were previously on \u003ccode\u003eSquareView\u003c/code\u003e and \u003ccode\u003eGame\u003c/code\u003e contains the game-related data members that were previously on \u003ccode\u003eGameViewController\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eSquare\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eCodable\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003ecovering\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eCovering\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecovered\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003eisMine\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eBool\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003eadjacent\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt8\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eGame\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eCodable\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esquares\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSquare\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003eprivate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003enonMineSquaresRemaining\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe \u003ccode\u003eSquareView\u003c/code\u003e still contains the data it needs to draw itself but this data is now merely a \u003cem\u003ecopy\u003c/em\u003e of the corresponding \u003ccode\u003eSquare\u003c/code\u003e value from the \u003ccode\u003eGame\u003c/code\u003e object.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSquareView\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIButton\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esquare\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSquare\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"kr\"\u003edidSet\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003esetNeedsDisplay\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn addition to moving data members around, the following functions from \u003ccode\u003eGameViewController\u003c/code\u003e were all moved to the \u003ccode\u003eGame\u003c/code\u003e class:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eloadGame\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enewSquareViews\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSquareView\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eremaining\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003enewMineField\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emineCount\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSquareView\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003euncover\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esquareViews\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSquareView\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eiterateAdjacent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esquareViews\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSquareView\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSquareView\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAnd the button action method on \u003ccode\u003eGameViewController\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kr\"\u003e@objc\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003esquareTapped\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eAny\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003ehas its contents moved to the \u003ccode\u003etapSquare\u003c/code\u003e function on the \u003ccode\u003eGame\u003c/code\u003e class (this function is still called from the \u003ccode\u003esquareTapped\u003c/code\u003e function on \u003ccode\u003eGameViewController\u003c/code\u003e).\u003c/p\u003e\n\n\u003cp\u003eSince the \u003ccode\u003eSquareView\u003c/code\u003e no longer contains the primary representation of the data, the \u003ccode\u003etoDictionary()\u003c/code\u003e and \u003ccode\u003einit(fromDictionary:)\u003c/code\u003e functions it contained are gone. The new \u003ccode\u003eGame\u003c/code\u003e instance is compliant with Swift \u003ccode\u003eCodable\u003c/code\u003e so serialization happens automatically on the Model.\u003c/p\u003e\n\n\u003cp\u003eFinally, view updates are handled by making the \u003ccode\u003eGameViewController\u003c/code\u003e observe changes on the \u003ccode\u003eGame\u003c/code\u003e.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eNotificationCenter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaddObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eselector\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003e#selector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003egameChanged\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e:)),\u003c/span\u003e\n   \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eGame\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003echanged\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003enewGame\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"what-does-the-comparison-reveal\"\u003eWhat does the comparison reveal?\u003c/h2\u003e\n\n\u003cp\u003eThere are a handful of minor functionality changes but \u003cstrong\u003ethe biggest change is that code has moved around\u003c/strong\u003e.\u003c/p\u003e\n\n\u003cp\u003eAt first glance, that seems fairly underwhelming – fixing the worst mistake in application design merely involves moving some code around. Surely a little code organization isn\u0026rsquo;t really that important?\u003c/p\u003e\n\n\u003ch3 id=\"i-m-a-liar\"\u003eI\u0026rsquo;m a liar\u003c/h3\u003e\n\n\u003cp\u003eBefore I answer why this is important, I should also be more honest. While \u0026ldquo;moving some code around\u0026rdquo; is the superficial effect, there was more work involved. Specifically:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eI identified the Model data\u003c/li\u003e\n\u003cli\u003eI identified all functions that acted purely on Model data\u003c/li\u003e\n\u003cli\u003eI created a system of notifications for outputting the Model data\u003c/li\u003e\n\u003cli\u003eI ensured that the functions and notifications provided a simple way to interact with the Model\u003c/li\u003e\n\u003cli\u003eI implemented an interface around this entire concept.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIt\u0026rsquo;s difficult to see all of this work from a side-by-side analysis though because \u003cstrong\u003eI had already done most of it in the unseparated version of the app\u003c/strong\u003e. The idea of separating a Model is so ingrained in my head that I had created a de facto Model even when trying to avoid it.\u003c/p\u003e\n\n\u003cp\u003eTo highlight this instinctive separation, I reordered the functions on the \u003ccode\u003eGameViewController\u003c/code\u003e. \u003ca href=\"https://github.com/mattgallagher/CwlWorstPossibleApplication/blob/master/CwlWorstPossibleApplication/GameViewController.swift\"\u003eLook at GameViewController.swift in the unseparated version of the Mines app\u003c/a\u003e and you\u0026rsquo;ll see that everything above line 101 of the \u003ccode\u003eGameViewController\u003c/code\u003e is strictly Model code. It isn\u0026rsquo;t separated out into another class but it isn\u0026rsquo;t directly mingled with view code either.\u003c/p\u003e\n\n\u003cp\u003eEven while writing this article, when I gave a \u0026ldquo;A quick summary of the app\u0026rdquo;, I spent the entire time describing the \u003cem\u003eModel\u003c/em\u003e, even though the app didn\u0026rsquo;t technically have a Model at that point.\u003c/p\u003e\n\n\u003cp\u003eSo yes, the code comparison mostly shows moving code around but that\u0026rsquo;s really just making the organization reflect what I\u0026rsquo;d already written – a de facto (if mingled and obscured) abstraction of the game\u0026rsquo;s data and logic.\u003c/p\u003e\n\n\u003ch3 id=\"the-model-as-an-abstraction\"\u003eThe Model as an abstraction\u003c/h3\u003e\n\n\u003cp\u003eThe separated Model implementation of the app clarifies the abstraction offered by the Model and strictly enforces it.\u003c/p\u003e\n\n\u003cp\u003eBy abstraction, I mean that the \u003ccode\u003eGame\u003c/code\u003e interface performs a lot of hidden work internally but externally it appears quite simple. It exposes two non-private functions – \u003ccode\u003einit\u003c/code\u003e and \u003ccode\u003etapSquare\u003c/code\u003e – that match the two sole means of interaction available to the user during the game (starting a new game and tapping on a square). The output from the \u003ccode\u003eGame\u003c/code\u003e is the minefield state communicated through the \u003ccode\u003eGame.changed\u003c/code\u003e notification.\u003c/p\u003e\n\n\u003cp\u003eThe \u003ccode\u003eGame\u003c/code\u003e abstraction simplifies 100 lines of code to construct and maintain the game down to 2 actions and 1 output. While there\u0026rsquo;s some work to correctly observe the notification output (roughly 10 lines in the \u003ccode\u003eGameViewController\u003c/code\u003e), this abstraction still represents a significant code size and complexity reduction from the perspective of the \u003ccode\u003eGameViewController\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThis is the importance of having a Model in your application design pattern: it allows you to reduce complexity by:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ereducing steps required in the rest of the program\u003c/li\u003e\n\u003cli\u003eremoving the need to ensure correctness from the rest of the program\u003c/li\u003e\n\u003cli\u003eremoving the need for action locations to know about state observing locations\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIt\u0026rsquo;s important to have the Model be a freely chosen abstraction because the Controller and View are not. \u003ccode\u003eUIViewController\u003c/code\u003e and \u003ccode\u003eUIView\u003c/code\u003e subclasses are collections of functionality, largely dictated by the implementation constraints and requirements of the UIKit framework. They\u0026rsquo;re not free to model an arbitrary abstraction. The Model is valuable because it is an application framework independent component.\u003c/p\u003e\n\n\u003ch3 id=\"leaky-and-bad-abstractions\"\u003eLeaky and bad abstractions\u003c/h3\u003e\n\n\u003cp\u003eI\u0026rsquo;ve already argued that there was a de facto Model abstraction being used \u003cem\u003ebefore\u003c/em\u003e I officially separated the Model. However, an abstraction only works to reduce complexity when steps are taken to avoid outside components assuming its inner workings – the de facto abstraction offered no real hiding or shielding of its implementation.\u003c/p\u003e\n\n\u003cp\u003eWhen outside components assume the inner workings of an abstraction, we call the abstraction a \u0026ldquo;leaky\u0026rdquo; abstraction. If there are \u003cem\u003eno\u003c/em\u003e hidden workings of the interface then it isn\u0026rsquo;t really an abstraction at all.\u003c/p\u003e\n\n\u003cp\u003eFor example, imagine that when I separated the Model, I hadn\u0026rsquo;t moved all the functions into the \u003ccode\u003eGame\u003c/code\u003e structure, I merely moved the data members and exposed them as mutable properties:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eGame\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eCodable\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003esquares\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eArray\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eSquare\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003enonMineSquaresRemaining\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIf this was the entire Model definition, all of the work to maintain it would remain on the \u003ccode\u003eGameViewController\u003c/code\u003e, exactly as before. This non-abstracted Model interface wouldn\u0026rsquo;t offer any benefit to the program.\u003c/p\u003e\n\n\u003ch3 id=\"application-design-patterns-are-potentially-useless\"\u003eApplication design patterns are potentially useless\u003c/h3\u003e\n\n\u003cp\u003eThis is why I have problems unambiguously discussing application design patterns. A Model \u003cem\u003eshould\u003c/em\u003e provide an abstraction, it \u003cem\u003eshould\u003c/em\u003e reduce complexity and improve locality of your code and logic. But whether it actually helps is dependent on your implementation. If you choose a useless abstraction for your Model then there\u0026rsquo;s potentially no benefit to having it separated.\u003c/p\u003e\n\n\u003cp\u003eApplication design patterns don\u0026rsquo;t provide implementations, they merely suggest some components – which on their own are completely useless. It\u0026rsquo;s the programmer\u0026rsquo;s responsibility to use good abstractions where possible for these components. Following a good application design pattern \u003cem\u003eshould\u003c/em\u003e lead to good abstractions but it doesn\u0026rsquo;t just magically happen.\u003c/p\u003e\n\n\u003cp\u003eA useful way to think about application design patterns is as a thought experiment which challenges us to explain our program from different perspectives. An application design pattern poses the question: if you were forced to route updates or actions in your program through an interface between these components, how would you explain your program\u0026rsquo;s state and behavior at that boundary? The question encourages an abstraction of the requirements and available options at a specific vantage point. Whether considering that perspective leads to a clean, simple abstraction of your program\u0026rsquo;s behavior will determine whether that application design pattern is beneficial for your program.\u003c/p\u003e\n\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\n\u003cp\u003eDepending on your Model abstraction, either of the following might be true:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003cp\u003eSeparating the Model from the View mostly just moves code around.\u003c/p\u003e\u003c/li\u003e\n\n\u003cli\u003e\u003cp\u003eSeparating the Model from the View reduces overall implementation complexity through careful abstraction, better separation of concerns, better code locality and simpler propagation of data dependencies.\u003c/p\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eIn fact, both of these statements could be descriptions of the \u003cem\u003esame\u003c/em\u003e program, as in the case of the \u003ca href=\"https://github.com/mattgallagher/CwlWorstPossibleApplication\"\u003eMines app\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eWriting an application without a separated Model is considered the worst application design, not because it immediately leads to disaster but because it indicates that you\u0026rsquo;ve never tried to clearly isolate what your program \u003cem\u003edoes\u003c/em\u003e. We don\u0026rsquo;t write applications because we love constructing views and controllers – these are merely a means to an end. We write applications to present our Model, perform actions on it and view the results.\u003c/p\u003e\n\n\u003cp\u003eThe worst possible application design is one that doesn\u0026rsquo;t understand what the app \u003cem\u003eis\u003c/em\u003e and obscures its own nature by scattering it around arbitrarily.\u003c/p\u003e\n\n\u003ch3 id=\"looking-forward\"\u003eLooking forward\u003c/h3\u003e\n\n\u003cp\u003eThe Model-View-Controller pattern typically describes the Model as containing all the data in the application and the View as a mere a display of that data. However, there is often data that affects the display of a View – like scroll state, navigation state or uncommitted data entry fields – that exists only in the View and not in the Model, in apparent violation of the Model-View-Controller principles.\u003c/p\u003e\n\n\u003cp\u003eIn the next article, I\u0026rsquo;ll look at what happens when we require this view-state to pass through its own Model and how this view-state can drive the entire application.\u003c/p\u003e\n",
            "date_published": "2017-10-20T10:27:52+10:00"
        }
        
        , {
            "title": "CwlLayout: a Swift wrapper around Auto Layout",
            "id": "https://www.cocoawithlove.com/blog/cwllayout.html",
            "url": "https://www.cocoawithlove.com/blog/cwllayout.html",
            "content_html": "\n\n\u003cp\u003eCocoa\u0026rsquo;s Auto Layout is an effective constraints system but as an API for \u0026ldquo;layout\u0026rdquo;, it leaves a lot to be desired. In most respects, Auto Layout is a constraints API upon which we can \u003cem\u003ebuild\u003c/em\u003e a layout system but is not itself an API that offers layout.\u003c/p\u003e\n\n\u003cp\u003eIn this article, I\u0026rsquo;m going to look at why using Auto Layout directly can be frustrating or limiting, before showing my own CwlLayout code which is a thin layer over Auto Layout (for either iOS or macOS) that I use to make layout less laborious and less error prone.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eYou can \u003ca href=\"https://github.com/mattgallagher/CocoaWithLovePlaygrounds\"\u003edownload this article as a Swift Playground\u003c/a\u003e from github.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\n\u003ch2 id=\"declarative-programming\"\u003eDeclarative programming\u003c/h2\u003e\n\n\u003cp\u003eDeclarative programming is about describing a program as a set of rules and relationships. Syntactically, declarative programming is often about assembling a whole system of rules as either a single expression or domain-specific language whose structure reflects the relationship between the rules in the system.\u003c/p\u003e\n\n\u003cp\u003eLayout is an inherently declarative task. Layout is a set of rules (which Auto Layout calls \u0026ldquo;constraints\u0026rdquo;) that apply to the contents of a view, ideally for the entire lifetime of the contents. Constraint programming itself is sometimes considered a subdiscipline of declarative programming.\u003c/p\u003e\n\n\u003cp\u003eUnfortunately, despite Auto Layout modelling a declarative system, it doesn\u0026rsquo;t offer a very declarative API. There are a handful of ways to use Auto Layout but none can be written as a single expression, most require a number of mutable property changes and in many cases, multiple constraints must applied at separate times.\u003c/p\u003e\n\n\u003cp\u003eThe end result is unaesthetic code that is inconsistent by default. In fact, since each view requires 4 separate constraints (width, height, x-placement, y-placement), any arbitrary set of Auto Layout constraints is far more likely to be inconsistent than consistent – and an inconsistent system of rules is no system at all.\u003c/p\u003e\n\n\u003ch2 id=\"an-example-layout\"\u003eAn example layout\u003c/h2\u003e\n\n\u003cp\u003eLet\u0026rsquo;s look at a \u0026ldquo;simple\u0026rdquo; layout example to see what I mean. All of the examples in this article construct the following layout:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/blog/basic_layout.png\" alt=\"Figure 1: a simple layout involving two bottom-aligned labels\" /\u003e\n\u003cfigcaption\u003eFigure 1: a simple layout involving two bottom-aligned labels\u003c/figcaption\u003e\u003c/p\u003e\n\n\u003cp\u003eThis layout contains two \u003ccode\u003eUILabel\u003c/code\u003es and the gray area is the boundary of the container \u003ccode\u003eUIView\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe layout aligns the bottom edges of the two \u003ccode\u003eUILabel\u003c/code\u003es, makes both labels the same width and places both within the parent view so that the tallest touches the upper margin of the view, the left and right labels touch the left and right margins, the labels are horizontally separated by a margin width and the bottom of the view is left vacant.\u003c/p\u003e\n\n\u003cp\u003eA key point to note about this layout is that it doesn\u0026rsquo;t encode the height of either label. If the text changed the labels would adjust their heights, possibly changing which label touches the top margin and possibly changing how much of the view is left vacant at the bottom but they would maintain their equal widths and maintain their aligned bottom edge.\u003c/p\u003e\n\n\u003ch2 id=\"manually-applied-constraints\"\u003eManually applied constraints\u003c/h2\u003e\n\n\u003cp\u003eLet\u0026rsquo;s see how this looks using manually applied constraints:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"nc\"\u003eUIKit\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eimport\u003c/span\u003e \u003cspan class=\"nc\"\u003ePlaygroundSupport\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eexample1\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIView\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILabel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILabel\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etranslatesAutoresizingMaskIntoConstraints\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n   \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etranslatesAutoresizingMaskIntoConstraints\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaddSubview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaddSubview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003econstraints\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n      \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eleadingAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eequalTo\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elayoutMarginsGuide\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eleadingAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n      \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etrailingAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eequalTo\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elayoutMarginsGuide\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etrailingAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n      \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebottomAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eequalTo\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebottomAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n      \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etrailingAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eequalTo\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eleadingAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econstant\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n      \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etopAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003egreaterThanOrEqualTo\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elayoutMarginsGuide\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etopAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n      \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etopAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003egreaterThanOrEqualTo\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elayoutMarginsGuide\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etopAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n      \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewidthAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eequalTo\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewidthAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eNSLayoutConstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eactivate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econstraints\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eleftTop\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etopAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eequalTo\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elayoutMarginsGuide\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etopAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eleftTop\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epriority\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eLayoutDimension\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePriorityDefaultLow\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eleftTop\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisActive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003erightTop\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etopAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eequalTo\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elayoutMarginsGuide\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etopAnchor\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"n\"\u003erightTop\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epriority\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eLayoutDimension\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ePriorityDefaultLow\u003c/span\u003e\n   \u003cspan class=\"n\"\u003erightTop\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisActive\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eview1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erunExample\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereversed\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eexample\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eexample1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eNOTE:\u003c/strong\u003e if you\u0026rsquo;re viewing this in the \u003ca href=\"https://github.com/mattgallagher/CocoaWithLovePlaygrounds\"\u003eSwift Playground\u003c/a\u003e, the last \u003ccode\u003elet view1 =\u003c/code\u003e line will have a gray \u0026ldquo;Show Result\u0026rdquo; square in the right margin. Click this square to view the layout. Set the \u003ccode\u003ereversed\u003c/code\u003e parameter to \u003ccode\u003etrue\u003c/code\u003e to swap the labels on the text fields.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThe clear problem here is the raw volume of code. I\u0026rsquo;ve had to write nine separate constraints, set a handful of properties and other actions including adding subviews and activating constraints. It\u0026rsquo;s a \u003cem\u003elot\u003c/em\u003e of unforgiving, meticulous work. Omitting any line will not merely change the layout but is likely to leave the layout in one of the following four problematic states:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003einconsistent (no single solution that satisfies all constraints)\u003c/li\u003e\n\u003cli\u003eambiguous (more than one solution that satisfies all constraints)\u003c/li\u003e\n\u003cli\u003eoverlapping (views partially or completely occupying the same space, unintentionally)\u003c/li\u003e\n\u003cli\u003eoverflowing (views exceeding the bounds of the parent, unintentionally)\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThese problems will not manifest as compile-time errors that clearly say \u0026ldquo;fix this line\u0026rdquo;, they are runtime errors which may give confusing or difficult to understand results. Even if you get information in the console about reporting \u0026ldquo;ambiguous layout affecting height of view [x]\u0026ldquo;, it can be very difficult to go back to your mess of constraints and find where you\u0026rsquo;ve gone wrong.\u003c/p\u003e\n\n\u003cp\u003eConstraints are hard.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eBrain teaser\u003c/strong\u003e: one (and only one) of the 9 constraints can be removed without leaving the layout in one of the four problematic states listed, above. Can you guess which one?\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eMuch of the debate I see around Auto Layout focusses on how it\u0026rsquo;s cumbersome to implement in code (as opposed to Interface Builder) but all of these 9 constraints would still need to be applied in Interface Builder to achieve this layout and you\u0026rsquo;d still need to understand \u003cem\u003ewhy\u003c/em\u003e each of the constraints is necessary.\u003c/p\u003e\n\n\u003cp\u003eInterface Builder can give more immediate feedback when the layout is ambiguous or inconsistent but it doesn\u0026rsquo;t change the number of constraints you\u0026rsquo;ll need to create or the need guess, from messages like \u0026ldquo;ambiguous layout affecting height of view [x]\u0026ldquo;, where you may have made a mistake. You need a deep understanding of the constraints system to avoid misuse and while it\u0026rsquo;s not rocket science, it can still be confusing.\u003c/p\u003e\n\n\u003ch2 id=\"pseudo-layouts\"\u003ePseudo-layouts\u003c/h2\u003e\n\n\u003cp\u003eThe problems with manually applied constraints stem from the fact that views require at least 4 constraints at any time (width, height, x-placement, y-placement) but the API applies 1 rule at a time. Ensuring the set of rules is consistent requires knowledge about the desired end-effect. Columns? Rows? Aspect ratio sizing?\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s try another approach – the Auto Layout \u003ccode\u003econstraints(withVisualFormat:...\u003c/code\u003e function.\u003c/p\u003e\n\n\u003cp\u003eOstensibly, the purpose of this function is to provide better visualization of constraints but it has a much greater advantage: geometry. The \u003ccode\u003econstraints(withVisualFormat:...\u003c/code\u003e function partially models a column or row so it can determine which additional constraints might be required to ensure alignment within the column or row and ordering of items from end-to-end.\u003c/p\u003e\n\n\u003cp\u003eHere\u0026rsquo;s how it plays out:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eexample2\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIView\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILabel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILabel\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etranslatesAutoresizingMaskIntoConstraints\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n   \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etranslatesAutoresizingMaskIntoConstraints\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaddSubview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaddSubview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eviews\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;left\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;right\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n   \n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003econstraints1\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNSLayoutConstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstraints\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithVisualFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e\u0026#34;|-[left]-[right(==left)]-|\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ealignAllBottom\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emetrics\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eviews\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eviews\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003econstraints2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNSLayoutConstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstraints\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithVisualFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e\u0026#34;V:|-(\u0026gt;=8)-[left]\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[],\u003c/span\u003e \u003cspan class=\"n\"\u003emetrics\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eviews\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eviews\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003econstraints3\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eNSLayoutConstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003econstraints\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewithVisualFormat\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"s\"\u003e\u0026#34;V:|-(\u0026gt;=8)-[right]\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[],\u003c/span\u003e \u003cspan class=\"n\"\u003emetrics\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eviews\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eviews\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eNSLayoutConstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eactivate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econstraints1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eNSLayoutConstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eactivate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econstraints2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eNSLayoutConstraint\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eactivate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003econstraints3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eview2\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erunExample\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereversed\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eexample\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eexample2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIt\u0026rsquo;s a lot shorter but it\u0026rsquo;s still precarious. While impossible constraints are  less common, ambiguous layouts are still possible due to the fact that the modelling is primarily 1-dimensional but constraints must agree in two dimensions.\u003c/p\u003e\n\n\u003cp\u003eThere also remain numerous esoteric requirements like the \u0026ldquo;greater or equal\u0026rdquo; vertical spacing constraint that could easily be misapplied, creating problems in this type of layout.\u003c/p\u003e\n\n\u003ch2 id=\"an-actual-layout\"\u003eAn actual layout\u003c/h2\u003e\n\n\u003cp\u003eNo matter how you apply them, constraints are not layouts; constraints are building blocks from which we can \u003cem\u003emake\u003c/em\u003e layouts. An actual layout requires starting a different way.\u003c/p\u003e\n\n\u003cp\u003eUIKit and AppKit provide \u003ccode\u003eUIStackView\u003c/code\u003e/\u003ccode\u003eNSStackView\u003c/code\u003e. Let\u0026rsquo;s take a look:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eexample3\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIView\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILabel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILabel\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003erow\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUIStackView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003earrangedSubviews\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n   \u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ealignment\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebottom\u003c/span\u003e\n   \u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003espacing\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\n   \n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003etopAlignedBox\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eUIStackView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003earrangedSubviews\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003erow\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n   \u003cspan class=\"n\"\u003etopAlignedBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ealignment\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etop\u003c/span\u003e\n   \u003cspan class=\"n\"\u003etopAlignedBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eautoresizingMask\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[.\u003c/span\u003e\u003cspan class=\"n\"\u003eflexibleWidth\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflexibleHeight\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n   \u003cspan class=\"n\"\u003etopAlignedBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eframe\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebounds\u003c/span\u003e\n   \u003cspan class=\"n\"\u003etopAlignedBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eisLayoutMarginsRelativeArrangement\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n   \u003cspan class=\"n\"\u003etopAlignedBox\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epreservesSuperviewLayoutMargins\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eaddSubview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etopAlignedBox\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eview3\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erunExample\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereversed\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eexample\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eexample3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eUsing a \u003ccode\u003eUIStackView\u003c/code\u003e is vastly better than raw constraints. \u003ccode\u003eUIStackView\u003c/code\u003e distributes views equally along its axis – which happens to be the arrangement I\u0026rsquo;ve used in this article – and most of the properties on the stack view can simply be omitted and the layout would not be ambiguous, inconsistent, overlapping or overflowing.\u003c/p\u003e\n\n\u003cp\u003eHowever, there are a few problems:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eThere are still properties whose configuration can\u0026rsquo;t be omitted\u003c/li\u003e\n\u003cli\u003eStack view can\u0026rsquo;t be configured in a single expression\u003c/li\u003e\n\u003cli\u003eStack view is relatively inflexible\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eOn the first problem: you need to correctly place the outer stack view in the view or \u003cem\u003enothing\u003c/em\u003e will appear. Delete the \u003ccode\u003eframe\u003c/code\u003e line to see what happens. The \u003ccode\u003eautoresizingMask\u003c/code\u003e can also be problematic if the container view needs to resize.\u003c/p\u003e\n\n\u003cp\u003eOn the second problem: you can see in the example that I had to nest one stack view within another to achieve the correct layout. Nested layers is not a problem but since stack views can\u0026rsquo;t be fully configured in a single expression, the implementation grows increasingly messy as we need to assign all the stack views to variables, configure them and finally assemble them.\u003c/p\u003e\n\n\u003cp\u003eOn the third point: unless you resort to adding bare constraints (the very situation we\u0026rsquo;re trying to avoid) it can be difficult to control the widths of items in a Stack View row or the heights in a Stack View column. Supposedly, \u003ccode\u003eUIStackView\u003c/code\u003e scales based on compression resistance and hugging priority but I was not able to use these values to tweak the sizes of the child views.\u003c/p\u003e\n\n\u003ch2 id=\"cwllayout\"\u003eCwlLayout\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eUIStackView\u003c/code\u003e/\u003ccode\u003eNSStackView\u003c/code\u003e provide a good conceptual model for layout but their implementation is lacking.\u003c/p\u003e\n\n\u003cp\u003eA declarative approach – where the whole system of constraints is established in a single expression – would be much better. Fortunately, Swift has a number of syntactic advantages that can help us, here. Swift has:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eenums with associated types\u003c/li\u003e\n\u003cli\u003edot lookup of static members on a type\u003c/li\u003e\n\u003cli\u003etypesafe variable argument lists\u003c/li\u003e\n\u003cli\u003eparameters with default arguments\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eBy using these, we can write code that is close to a structured declarative language-within-a-language for specifying layout.\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s take a look:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eexample4\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIView\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILabel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILabel\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eapplyLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehorizontal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ealign\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eleading\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehorizontal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ealign\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etrailing\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ematchedPair\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eview4\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erunExample\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereversed\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eexample\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eexample4\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eConceptually, this uses the same approach as the previous \u003ccode\u003eUIStackView\u003c/code\u003e example: we have a row containing a pair of views aligned to the bottom edge inside another box aligned to the top (alignment here is perpendicular to the layout direction so the \u003ccode\u003ealign\u003c/code\u003e parameters \u003ccode\u003e.leading\u003c/code\u003e and \u003ccode\u003e.trailing\u003c/code\u003e are interpreted as \u0026ldquo;vertically leading\u0026rdquo; – i.e. top – and \u0026ldquo;vertically trailing\u0026rdquo; – i.e. bottom).\u003c/p\u003e\n\n\u003cp\u003eCompared to \u003ccode\u003eUIStackView\u003c/code\u003e though, this example is more syntactically efficient, has a visual structure that reflects its compositional structure, is a single expression and is inherently consistent.\u003c/p\u003e\n\n\u003cp\u003eThat last point might be the most important: you can remove subviews entirely from the hierarchy but there is nothing you can remove that leaves the layout in an inconsistent, ambiguous, overlapping or overflowing state. Don\u0026rsquo;t misunderstand me: you can still \u003cem\u003eadd\u003c/em\u003e inconsistent constraints with CwlLayout but you need to take positive action to \u003cem\u003eintroduce\u003c/em\u003e inconsistency – the system is consistent by default.\u003c/p\u003e\n\n\u003cp\u003eYou\u0026rsquo;ll notice too that there\u0026rsquo;s no need to add subviews or configure other properties on the views like \u003ccode\u003etranslatesAutoresizingMaskIntoConstraints\u003c/code\u003e. It is all handled automatically. Additionally, a subsequent call to \u003ccode\u003eapplyLayout\u003c/code\u003e (including \u003ccode\u003eapplyLayout(nil)\u003c/code\u003e) will precisely remove any previously applied layout, the constraints applied by the layout and any added subviews (leaving views and constraints added by other means untouched). Everything is done in a single operation.\u003c/p\u003e\n\n\u003ch2 id=\"some-variations\"\u003eSome variations\u003c/h2\u003e\n\n\u003ch3 id=\"custom-size-constraints\"\u003eCustom size constraints\u003c/h3\u003e\n\n\u003cp\u003eI mentioned that one of the drawbacks to \u003ccode\u003eUIStackView\u003c/code\u003e is that it can be difficult to control the size of contained items – the stack view applies its own sizing logic which is opaque and difficult to override.\u003c/p\u003e\n\n\u003cp\u003eFor example, imagine instead of this \u003csup\u003e50\u003c/sup\u003e\u0026frasl;\u003csub\u003e50\u003c/sub\u003e split, we wanted a \u003csup\u003e75\u003c/sup\u003e\u0026frasl;\u003csub\u003e25\u003c/sub\u003e split. With CwlLayout, it\u0026rsquo;s simple to use a \u003ccode\u003esizedView\u003c/code\u003e (one which includes explicit size constraints):\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eexample5\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIView\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILabel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILabel\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eapplyLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehorizontal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ealign\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eleading\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehorizontal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ealign\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etrailing\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esizedView\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003elengthEqualTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eratio\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.75\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003econstant\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mf\"\u003e0.75\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einterViewSpace\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eview5\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erunExample\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereversed\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eexample\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eexample5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe \u003ccode\u003e0.75\u003c/code\u003e ratio is a ratio of the parent container – i.e. the inner \u003ccode\u003e.horizontal\u003c/code\u003e layout, which the outer \u003ccode\u003e.horizontal\u003c/code\u003e layout has already inset by the view\u0026rsquo;s margins. However, we also want to leave space for the 8 pixel space between the two labels, hence the \u003ccode\u003e-0.75 * 8\u003c/code\u003e constant which is subtracted from the width, leaving a perfect 3:1 ratio between the two labels.\u003c/p\u003e\n\n\u003cp\u003eThe \u0026ldquo;8 unit space\u0026rdquo; is created by \u003ccode\u003einterViewSpace\u003c/code\u003e, equivalent to \u003ccode\u003e.space(8.0)\u003c/code\u003e. CwlLayout included an \u003ccode\u003einterViewSpace\u003c/code\u003e automatically between the \u003ccode\u003ematchedPair\u003c/code\u003e in the previous example but since we\u0026rsquo;re managing the row more manually this time, it\u0026rsquo;s been explicitly included. This 8 unit separation is a standard space that Apple suggests for container margins and spacing between adjacent views.\u003c/p\u003e\n\n\u003cp\u003eNote however that \u003ccode\u003eUIViewController\u003c/code\u003e has very different margins and the \u003ccode\u003esafeAreaGuides\u003c/code\u003e in iOS 11 are different again. CwlLayout respects margins by default on the outermost layout container and there\u0026rsquo;s a \u003ccode\u003emarginEdges\u003c/code\u003e parameter (hidden in this example) that lets you toggle each margin edge between safe-area, layout margins and no margins.\u003c/p\u003e\n\n\u003cp\u003eIt\u0026rsquo;s also possible to specify the \u003ccode\u003ebreadth\u003c/code\u003e (size perpendicular to layout direction). If the \u003ccode\u003ebreadth\u003c/code\u003e is specified as a ratio, it can be a ratio of the parent container or a ratio of the \u003ccode\u003elength\u003c/code\u003e so aspect ratio preserving sizing is possible.\u003c/p\u003e\n\n\u003ch3 id=\"controlling-vertical-placement\"\u003eControlling vertical placement\u003c/h3\u003e\n\n\u003cp\u003eThe two previous examples have used nested \u003ccode\u003e.horizontal\u003c/code\u003e rows (because it\u0026rsquo;s what I used in the \u003ccode\u003eUIStackView\u003c/code\u003e example) but I could just as easily change the outer container to a column and start controlling vertical placement:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eexample6\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUIView\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILabel\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eUILabel\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eapplyLayout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evertical\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003espace\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003eequalTo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eratio\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mf\"\u003e0.15\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehorizontal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ealign\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etrailing\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ematchedPair\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n               \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003eleft\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n               \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kr\"\u003eright\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e),\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003espace\u003c/span\u003e\u003cspan class=\"p\"\u003e(.\u003c/span\u003e\u003cspan class=\"n\"\u003efillRemaining\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eview6\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erunExample\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ereversed\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eexample\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eexample6\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"usage\"\u003eUsage\u003c/h2\u003e\n\n\u003cp\u003eThe \u003ca href=\"https://github.com/mattgallagher/CocoaWithLovePlaygrounds/blob/master/CwlLayout.playground/Sources/CwlLayout.swift\"\u003eCwlLayout.swift file\u003c/a\u003e is available in the \u003ca href=\"https://github.com/mattgallagher/CocoaWithLovePlaygrounds/tree/master/CwlLayout.playground/Sources\"\u003eSources folder\u003c/a\u003e of the \u003ca href=\"https://github.com/mattgallagher/CocoaWithLovePlaygrounds\"\u003eSwift Playground for this article\u003c/a\u003e. The file has no dependencies beyond AppKit/UIKit so you can just drop it into any of your projects.\u003c/p\u003e\n\n\u003cp\u003eCwlLayout supports deployment targets of macOS 10.11, iOS 9 and later.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eSwift 4 and iOS 11/macOS 10.13\u003c/strong\u003e: If you\u0026rsquo;re building with Swift 4, then you \u003cem\u003emust\u003c/em\u003e use the iOS 11 or macOS 10.13 SDK. If you\u0026rsquo;re building with Swift 3.2 or lower, then you must use the iOS 10 or macOS 10.12 SDK. I don\u0026rsquo;t like tying the Swift version and SDK versions together like this but I\u0026rsquo;m not sure how else to handle the changes in the SDK overlay.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThe file lacks full test coverage so there may be some rough edges. If you encounter any obvious bugs, let me know.\u003c/p\u003e\n\n\u003cp\u003eAt the moment, CwlLayout does not support animation. It would be nice to animate from one arrangement to another but that\u0026rsquo;s a task for the future. Support for text baseline alignment is also not yet implemented.\u003c/p\u003e\n\n\u003cp\u003eIf you look at the code, you\u0026rsquo;ll notice that there\u0026rsquo;s a \u003ccode\u003eDEBUG\u003c/code\u003e setting in there. For many tasks, CwlLayout uses \u003ccode\u003eUILayoutGuide\u003c/code\u003e/\u003ccode\u003eNSLayoutGuide\u003c/code\u003e to define regions but a compile condition will switch these guides to \u003ccode\u003eUIView\u003c/code\u003e/\u003ccode\u003eNSView\u003c/code\u003e instead since views show up better in the debugging tools in Xcode.\u003c/p\u003e\n\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\n\u003cp\u003eUsing Auto Layout constraints directly is an exercise in frustration. They are inconsistent by default and errors won\u0026rsquo;t be caught by the compiler, so runtime problems are a continual issue. The fact that the code is often unaesthetic and uncomposeable adds to the frustration.\u003c/p\u003e\n\n\u003cp\u003eApple\u0026rsquo;s documentation and videos focus on using Auto Layout in Interface Builder, which avoids the aesthetics of the code but the fact remains that even in Interface Builder, you\u0026rsquo;re still just applying the same independent constraints and it\u0026rsquo;s still prone to being inconsistent if you\u0026rsquo;re not precise and accurate.\u003c/p\u003e\n\n\u003cp\u003eA far better solution for programming a declarative constraints system is to use an API that itself is declarative and builds the whole system as a single composeable expression and rather than constructing individual constraints separately. An approach that understands the whole system and can automatically include constraints needed will also aid consistency.\u003c/p\u003e\n\n\u003cp\u003eA \u003ccode\u003eUIStackView\u003c/code\u003e or \u003ccode\u003eNSStackView\u003c/code\u003e gets part of the way towards this ideal. These classes understand the overall layout and limit the amount of inconsistency but they are relatively inflexible and typically require multiple statements to configure.\u003c/p\u003e\n\n\u003cp\u003eCwlLayout isn\u0026rsquo;t complicated or revolutionary; it is just a more-flexible column and row approach like \u003ccode\u003eUIStackView\u003c/code\u003e or \u003ccode\u003eNSStackView\u003c/code\u003e. Unlike \u003ccode\u003eUIStackView\u003c/code\u003e or \u003ccode\u003eNSStackView\u003c/code\u003e however, it is designed exclusively for Swift and takes advantage of Swift\u0026rsquo;s syntactic efficiency for a more aesthetic design.\u003c/p\u003e\n\n\u003ch3 id=\"looking-forward\"\u003eLooking forward\u0026hellip;\u003c/h3\u003e\n\n\u003cp\u003eLayout is just the tip of the iceberg.\u003c/p\u003e\n\n\u003cp\u003eAlmost all app development – windows, views, controls, buttons, actions, fonts – can be handled as a set of rules. Some rules determine the mapping between model and display and some dictate how events and user-actions should be routed and handled.\u003c/p\u003e\n\n\u003cp\u003eHow would a declarative approach for an entire app look?\u003c/p\u003e\n",
            "date_published": "2017-08-03T01:08:27+10:00"
        }
        
        , {
            "title": "An aside about flatMap and monads",
            "id": "https://www.cocoawithlove.com/blog/an-aside-about-flatmap-and-monads.html",
            "url": "https://www.cocoawithlove.com/blog/an-aside-about-flatmap-and-monads.html",
            "content_html": "\n\n\u003cp\u003eIn the \u003ca href=\"/blog/statements-messages-reducers.html\"\u003eprevious article\u003c/a\u003e, I used a Swift function named \u003ccode\u003eflatMap\u003c/code\u003e. There are three kinds of function named \u003ccode\u003eflatMap\u003c/code\u003e in the Swift standard library but I used the one that is the least monadic.\u003c/p\u003e\n\n\u003cp\u003eDiscussing the monad-ish-ness of \u003ccode\u003eflatMap\u003c/code\u003e in Swift is a weird thing to do. Swift doesn\u0026rsquo;t use the word \u0026ldquo;monad\u0026rdquo; anywhere in its documentation so monads are far from fundamental to Swift.\u003c/p\u003e\n\n\u003cp\u003eYet monads are essential in some programming languages. Reprising the previous article\u0026rsquo;s topic of \u0026ldquo;units of computation\u0026rdquo;, monads are a fundamental unit of computation in Haskell. Influence from Haskell may leave Swift programmers curious about monads wondering if they too should try to use them more often in their programs.\u003c/p\u003e\n\n\u003cp\u003eIn this article, I\u0026rsquo;ll look at monads; what they are, why they\u0026rsquo;re fundamental in Haskell, whether \u003ccode\u003eflatMap\u003c/code\u003e is necessarily a monad and the importance in Swift of constructs that are monad-ish but not strictly monadic.\u003c/p\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\n\u003ch2 id=\"what-is-a-monad\"\u003eWhat is a monad?\u003c/h2\u003e\n\n\u003cp\u003eA \u003cstrong\u003emonad\u003c/strong\u003e is a \u0026ldquo;container\u0026rdquo; type (like \u003ccode\u003eArray\u003c/code\u003e, \u003ccode\u003eOptional\u003c/code\u003e, etc) that is acted upon through a particular transformation called \u003cstrong\u003ebind\u003c/strong\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe bind transformation is not very complicated but it involves an intermediate step which can make it all seem a little abstract. Here\u0026rsquo;s a diagram to try and make it easier to picture:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/blog/monad.svg\" alt=\"Figure 1: a diagram of a monadic bind transformation\" /\u003e\u003c/p\u003e\n\n\u003cfigcaption\u003eA dataflow diagram of a typical monadic bind transformation\u003c/figcaption\u003e\n\n\u003cp\u003eA bind operation does the following (as shown by the red circles in the diagram):\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003etakes a container that can contain zero or more instances, e.g. \u003ccode\u003eBox\u0026lt;T\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003etakes a function which transforms an instance of the contained type from (1) into a new container of the same \u003cem\u003ekind\u003c/em\u003e as in (1) containing zero or more new instances of a potentially new type, e.g. \u003ccode\u003e(T)-\u0026gt; Box\u0026lt;U\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eapplies the function from (2) to each of the contained instances from (1)\u003c/li\u003e\n\u003cli\u003econcatenates all containers produced by (3) into a single container, e.g. \u003ccode\u003e(Box\u0026lt;Box\u0026lt;U\u0026gt;\u0026gt;) -\u0026gt; Box\u0026lt;U\u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eA fully conforming monad places a few additional requirements on the container type and the concatenate step but these requirements are not really relevant to understanding monads so I\u0026rsquo;ll skip them.\u003c/p\u003e\n\n\u003cp\u003eInstead, let\u0026rsquo;s take a quick step back and discuss the scenario in which we might need such a specific transformation.\u003c/p\u003e\n\n\u003ch3 id=\"a-scenario-where-we-might-use-a-monad\"\u003eA scenario where we might use a monad\u003c/h3\u003e\n\n\u003cp\u003eImagine we have lots of functions that take plain, unwrapped inputs like \u003ccode\u003eInt\u003c/code\u003e or \u003ccode\u003eString\u003c/code\u003e and these functions happen to return results wrapped in containers like \u003ccode\u003eOptional\u0026lt;Double\u0026gt;\u003c/code\u003e or \u003ccode\u003eArray\u0026lt;Character\u0026gt;\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eSince our functions happen to return results in containers, we end up with a lot of containers.\u003c/p\u003e\n\n\u003cp\u003eIt\u0026rsquo;s usually not a problem to go from unwrapped values to one layer of containment – a container may help us hold multiple values or remind us that an operation may have failed – but if we happened to apply a container-returning function once, we might want to applying another similar function again in the future. Suddenly \u003ccode\u003eOptional\u0026lt;Double\u0026gt;\u003c/code\u003e becomes \u003ccode\u003eOptional\u0026lt;Optional\u0026lt;Float\u0026gt;\u0026gt;\u003c/code\u003e or \u003ccode\u003eArray\u0026lt;Character\u0026gt;\u003c/code\u003e becomes \u003ccode\u003eArray\u0026lt;Array\u0026lt;UnicodeScalar\u0026gt;\u0026gt;\u003c/code\u003e and now things start to get unwieldy.\u003c/p\u003e\n\n\u003cp\u003eIf we care about the end-results, not the structure in-between, then the bind transformation of a monad helps us repeatedly apply container-returning functions without needing increasingly deeper layers of wrapping around our results.\u003c/p\u003e\n\n\u003ch2 id=\"why-do-haskell-programmers-care-so-much\"\u003eWhy do Haskell programmers care so much?\u003c/h2\u003e\n\n\u003cp\u003eIf you didn\u0026rsquo;t realize from the explanation and the scenario: monads are fairly specific.\u003c/p\u003e\n\n\u003cp\u003eA bind transformation can be useful in an imperative language but even in a situation ideally suited to monads, you might instinctively process things another way. You may just perform your own \u003ccode\u003efor\u003c/code\u003e loop over the data and perform the concatenation yourself as you go. Or you could apply a post-processing \u003ccode\u003ereduce\u003c/code\u003e step after the \u003ccode\u003emap\u003c/code\u003e that does its own container unwrapping and concatenation.\u003c/p\u003e\n\n\u003cp\u003eWhy are monads so fundamental in Haskell?\u003c/p\u003e\n\n\u003cp\u003eThe answer is that it\u0026rsquo;s not \u003cem\u003egeneral\u003c/em\u003e monads that are useful in Haskell as much as \u003cem\u003eone-way\u003c/em\u003e monads – the IO monad in particular – and how they interact with the Haskell runtime system.\u003c/p\u003e\n\n\u003cp\u003eIn a strict functional programming language like Haskell, functions are not allowed to mutate state or have side effects. This complicates any interaction with the user, the file system, networking, the operating system or other services since \u003cem\u003eall\u003c/em\u003e of these interactions are stateful and have side effects.\u003c/p\u003e\n\n\u003cp\u003eThe way Haskell deals with these problems is that you can interact with these services freely but you never get access to the result. Instead, you get a container (an IO monad) that you can never unwrap. If you never unwrap a container containing side effects, then you remain free from the impact of those side effects – your actions remain the same regardless of whether the container holds a fully parsed data structure or a file-not-found error.\u003c/p\u003e\n\n\u003cp\u003eHow can you handle a container that you can never unwrap? With transformations like \u003ccode\u003emap\u003c/code\u003e, of course. A \u003ccode\u003emap\u003c/code\u003e transformation in Haskell is effectively your code telling the runtime system: please look inside the container for me and should the container contain a value, then apply this function.\u003c/p\u003e\n\n\u003cp\u003eAnd since many of the functions you might apply in Haskell will themselves return IO monads, the bind transformation becomes useful so we can concatenate successful steps through our own program.\u003c/p\u003e\n\n\u003ch2 id=\"monads-as-the-fundamental-unit-of-computation-in-haskell\"\u003eMonads as the fundamental \u0026ldquo;unit of computation\u0026rdquo; in Haskell\u003c/h2\u003e\n\n\u003cp\u003eIn short video on Microsoft\u0026rsquo;s Channel 9 titled \u003ca href=\"https://channel9.msdn.com/Blogs/Charles/Simon-Peyton-Jones-Towards-a-Programming-Language-Nirvana\"\u003eTowards a Programming Language Nirvana\u003c/a\u003e (from 2007), \u003ca href=\"https://en.wikipedia.org/wiki/Simon_Peyton_Jones\"\u003eSimon Peyton Jones\u003c/a\u003e, \u003ca href=\"https://en.wikipedia.org/wiki/Erik_Meijer_(computer_scientist)\"\u003eErik Meijer\u003c/a\u003e and \u003ca href=\"https://en.wikipedia.org/wiki/Butler_Lampson\"\u003eButler Lampson\u003c/a\u003e talk about how programming is fundamentally about doing work, creating output and having effects but – as the video explains – pure functional programming languages like Haskell are about \u003cem\u003enot\u003c/em\u003e having effects, rendering them useless.\u003c/p\u003e\n\n\u003cp\u003ePeyton Jones is being facetious, of course, Haskell does have \u003cem\u003esome\u003c/em\u003e effects which Peyton Jones calls \u0026ldquo;controlled\u0026rdquo; effects. Haskell acheives these controlled effects by using the one-way nature of the IO monad to keep code and effects separated.\u003c/p\u003e\n\n\u003cp\u003eSince the IO monad is the means by which Haskell controls effects, the IO monad is literally how you program in Haskell. Each IO monadic bind can be considered a single effect and the only way to build a series of effects (i.e. a program) is to have multiple IO monadic bind steps. In this way, the IO monad is literally the building block used to build Haskell programs. Haskell even offers special \u003ccode\u003edo\u003c/code\u003e syntax for creating a function that is aesthetically a series of monadic bind steps so the aethetics of the program can match the procedural structure.\u003c/p\u003e\n\n\u003ch2 id=\"swift-and-flatmap\"\u003eSwift and \u003ccode\u003eflatMap\u003c/code\u003e\u003c/h2\u003e\n\n\u003cp\u003eLet\u0026rsquo;s bring the discussion back to Swift.\u003c/p\u003e\n\n\u003cp\u003eI\u0026rsquo;ve explained that a bind transformation is like a \u003ccode\u003emap\u003c/code\u003e where the function it applies returns a container type and the monad transformation unwraps all the returned containers and concatenates them together.\u003c/p\u003e\n\n\u003cp\u003eThis is \u003cem\u003eclose\u003c/em\u003e to the same description as some of the \u003ccode\u003eflatMap\u003c/code\u003e functions in Swift:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eReturns an array containing the concatenated results of calling the given transformation with each element of this sequence.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"nc\"\u003eSequence\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eflatMap\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eS\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eSequence\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kr\"\u003ethrows\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eS\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kr\"\u003erethrows\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eElement\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003cp\u003eSo are the types in Swift that implement \u003ccode\u003eflatMap\u003c/code\u003e monads?\u003c/p\u003e\n\n\u003ch3 id=\"not-quite-a-monad\"\u003eNot quite a monad\u003c/h3\u003e\n\n\u003cp\u003eA true monad transformation requires that all the container types involved be the same kind - a restriction which is not enforced, here. This \u003ccode\u003eflatMap\u003c/code\u003e function operates on any \u003ccode\u003eSequence\u003c/code\u003e, produces a second \u003ccode\u003eSequence\u003c/code\u003e kind that isn\u0026rsquo;t necessarily the same as the first and returns the concatenation as an \u003ccode\u003eArray\u003c/code\u003e. This function is only a monad if both the \u003ccode\u003eSequence\u003c/code\u003e arguments are \u003ccode\u003eArray\u003c/code\u003e. All other usage of this function results in not-a-monad.\u003c/p\u003e\n\n\u003cp\u003eDoes this matter?\u003c/p\u003e\n\n\u003cp\u003ePragmatically speaking, the definition of this function makes it a lot \u003cem\u003eeasier\u003c/em\u003e to use a container type with this function, since the container type doesn\u0026rsquo;t need to offer its own construction and concatenation operators (\u003ccode\u003eArray\u003c/code\u003e is used instead).\u003c/p\u003e\n\n\u003cp\u003eOn the negative side, there is the problem that you\u0026rsquo;d need a new overload of \u003ccode\u003eflatMap\u003c/code\u003e if you wanted to return \u003ccode\u003eSet\u003c/code\u003e or some other \u003ccode\u003eSequence\u003c/code\u003e or \u003ccode\u003eCollection\u003c/code\u003e. This problem is mitigated by the fact that in these cases you can simply use the \u003ccode\u003e.lazy.flatMap\u003c/code\u003e variant instead and concatenate the sequence to a \u003ccode\u003eSet\u003c/code\u003e yourself.\u003c/p\u003e\n\n\u003cp\u003eBut it\u0026rsquo;s still not technically a monad.\u003c/p\u003e\n\n\u003ch3 id=\"exactly-a-monad\"\u003eExactly a monad\u003c/h3\u003e\n\n\u003cp\u003eSwift does have a true one monad: \u003ccode\u003eOptional\u003c/code\u003e and its implementation of \u003ccode\u003eflatMap\u003c/code\u003e:\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"nc\"\u003eOptional\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eflatMap\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eU\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003etransform\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eWrapped\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kr\"\u003ethrows\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eU\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e \u003cspan class=\"kr\"\u003erethrows\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eU\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003cp\u003eAll containers are \u003ccode\u003eOptional\u003c/code\u003e. Neat and tidy.\u003c/p\u003e\n\n\u003cp\u003eOf course, we don\u0026rsquo;t always use this \u003ccode\u003eflatMap\u003c/code\u003e. If we can, it\u0026rsquo;s better to use optional chaining:\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esecond\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e}.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ethird\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()?.\u003c/span\u003e\u003cspan class=\"n\"\u003esecond\u003c/span\u003e\u003cspan class=\"p\"\u003e()?.\u003c/span\u003e\u003cspan class=\"n\"\u003ethird\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003cp\u003eOptional chaining is more syntactically efficient than \u003ccode\u003eflatMap\u003c/code\u003e but it requires instance methods chained via dots. If you want to pass the previous result into a function as a parameter, you might need to use \u003ccode\u003eflatMap\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch3 id=\"barely-a-monad-at-all\"\u003eBarely a monad at all\u003c/h3\u003e\n\n\u003cp\u003eAnd then there\u0026rsquo;s this version:\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003eextension\u003c/span\u003e \u003cspan class=\"nc\"\u003eSequence\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"c1\"\u003e// Returns an array containing the non-nil results of calling the given\u003c/span\u003e\n   \u003cspan class=\"c1\"\u003e// transformation with each element of this sequence.\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eflatMap\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eS\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kr\"\u003ethrows\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eS\u003c/span\u003e\u003cspan class=\"p\"\u003e?)\u003c/span\u003e \u003cspan class=\"kr\"\u003erethrows\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eS\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003cp\u003eThis is the \u003ccode\u003eflatMap\u003c/code\u003e I used in the previous article. Instead of \u003ccode\u003eflatMap\u003c/code\u003e over \u003ccode\u003eSequence\u003c/code\u003e to \u003ccode\u003eSequence\u003c/code\u003e returning \u003ccode\u003eArray\u003c/code\u003e, this version is \u003ccode\u003eSequence\u003c/code\u003e to \u003ccode\u003eOptional\u003c/code\u003e returning \u003ccode\u003eArray\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eI\u0026rsquo;ve had debates with people about whether this \u003ccode\u003eflatMap\u003c/code\u003e should be renamed because it\u0026rsquo;s not monad-ish (monad-esque? monad-y?) enough to earn the name \u003ccode\u003eflatMap\u003c/code\u003e. The Swift Evolution mailing list has seen similar petitions to rename this function based on its monadic violations.\u003c/p\u003e\n\n\u003cp\u003eI\u0026rsquo;m amused by this debate since an \u003ccode\u003eOptional\u003c/code\u003e is effectively (if not semantically) a collection of one or zero instances, so this function is qualitatively equivalent to the \u003ccode\u003eflatMap\u003c/code\u003e over \u003ccode\u003eSequence\u003c/code\u003e to \u003ccode\u003eSequence\u003c/code\u003e returning \u003ccode\u003eArray\u003c/code\u003e version. Technically it is not possible for any usage of this function to be a monad but pragmatically, it serves exactly the same purpose as the previous \u003ccode\u003eSequence\u003c/code\u003e implemention.\u003c/p\u003e\n\n\u003cp\u003eYes, I realize that Haskell has \u003ccode\u003emapMaybe\u003c/code\u003e and Scala (the origin of the name \u003ccode\u003eflatMap\u003c/code\u003e) requires chained \u003ccode\u003emap\u003c/code\u003e and \u003ccode\u003efilter\u003c/code\u003e in this case – but my feeling is that flattening a sequence of optionals is still a flatten so the name still works.\u003c/p\u003e\n\n\u003ch3 id=\"change-names-for-a-different-reason\"\u003eChange names for a different reason\u003c/h3\u003e\n\n\u003cp\u003eFor the \u003ca href=\"/blog/statements-messages-reducers.html#where-do-we-go-from-here\"\u003eCwlSignal example in the previous article\u003c/a\u003e, I used a \u003ccode\u003eSignal\u003c/code\u003e transformation named \u003ccode\u003efilterMap\u003c/code\u003e. This transformation is equivalent to a \u003ccode\u003emap\u003c/code\u003e that then omits \u003ccode\u003eOptional\u003c/code\u003e results – so I\u0026rsquo;ve renamed this debated \u003ccode\u003eflatMap\u003c/code\u003e in my own library.\u003c/p\u003e\n\n\u003cp\u003eThe name change had nothing to do with avoiding monadic confusion and everything to do with avoiding mismatched functions getting accidentally promoted to returning an \u003ccode\u003eOptional\u003c/code\u003e result and satisfying the wrong overload to \u003ccode\u003eflatMap\u003c/code\u003e instead of giving a compiler error.\u003c/p\u003e\n\n\u003cp\u003eYou can get the same kind of problem with the Swift standard library version of \u003ccode\u003eflatMap\u003c/code\u003e:\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003cp\u003eThis code compiles without problem but it\u0026rsquo;s clearly a mistake; either I intended to use a regular \u003ccode\u003emap\u003c/code\u003e call instead of \u003ccode\u003eflatMap\u003c/code\u003e or I should have performed logic in the closure that returned an \u003ccode\u003eOptional\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThis isn\u0026rsquo;t really a \u003ccode\u003eflatMap\u003c/code\u003e problem as much as it\u0026rsquo;s a warning to be careful with overloads that differ only by an \u003ccode\u003eOptional\u003c/code\u003e or \u003ccode\u003eOptional\u003c/code\u003e returning parameter – it\u0026rsquo;s better to keep these overloads name-isolated to minimize bugs.\u003c/p\u003e\n\n\u003ch2 id=\"monad-like-structures-in-swift\"\u003eMonad-like structures in Swift\u003c/h2\u003e\n\n\u003cp\u003eI\u0026rsquo;ve already shown that optional chaining in Swift is equivalent to a \u003ccode\u003eflatMap\u003c/code\u003e and therefore is a monadic operation:\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ex\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esecond\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e}.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ethird\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"bp\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e()?.\u003c/span\u003e\u003cspan class=\"n\"\u003esecond\u003c/span\u003e\u003cspan class=\"p\"\u003e()?.\u003c/span\u003e\u003cspan class=\"n\"\u003ethird\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003cp\u003ebut it\u0026rsquo;s not the only construct that\u0026rsquo;s a little monadic.\u003c/p\u003e\n\n\u003cp\u003eSwift\u0026rsquo;s error handling is also monad-like, from a certain perspective. Consider the following code:\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003esomeFunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurlString\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eURL\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kr\"\u003ethrows\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eData\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eurl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"n\"\u003emakeUrlOrThrow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efromString\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eurlString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003efile\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"n\"\u003eopenFileOrThrow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"n\"\u003ereadContentsOrThrow\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003cp\u003ethis Swift error-handling based code is essentially the same as the following \u003ccode\u003eflatMap\u003c/code\u003e structured code based around functions returning \u003ccode\u003eOptionals\u003c/code\u003e that are \u003ccode\u003enil\u003c/code\u003e on failure:\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003esomeFunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurlString\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eURL\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eurl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emakeUrlOrNil\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efromString\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eurlString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003efile\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eopenFileOrNil\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003ereadContentsOrNil\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efil\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nv\"\u003e$0\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003cp\u003eOf course, you can just unwrap an \u003ccode\u003eOptional\u003c/code\u003e. Using Swift\u0026rsquo;s syntax for handling optionals, it doesn\u0026rsquo;t look much different and does exactly the same work, even though it\u0026rsquo;s not a monad at all:\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003esomeFunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurlString\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eURL\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eData\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003eurl\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emakeUrlOrNil\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efromString\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eurlString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eguard\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003efile\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eopenFileOrNil\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ereadContentsOrNil\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efil\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003cp\u003eNearly a monad, exactly a monad, not a monad at all; the different is not always significant and you should feel free to choose the syntax and approach you prefer.\u003c/p\u003e\n\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\n\u003cp\u003eEven though monads are essential in languages like Haskell, they\u0026rsquo;re just one of many processing tools in Swift.\u003c/p\u003e\n\n\u003cp\u003eI don\u0026rsquo;t think there\u0026rsquo;s any real need to \u003cem\u003etry\u003c/em\u003e to be monadic in Swift. There are plenty of cases where layers of Error handling or \u003ccode\u003eOptional\u003c/code\u003e or \u003ccode\u003eArray\u003c/code\u003e will naturally encourage you to concatenate results or filter out empty results but whether you choose to do this with \u003ccode\u003eflatMap\u003c/code\u003e or \u003ccode\u003eguard let\u003c/code\u003e or \u003ccode\u003efor\u003c/code\u003e loops is a matter of personal syntactic preference – you\u0026rsquo;ll get the same result in each case.\u003c/p\u003e\n\n\u003cp\u003eAre the types that implement \u003ccode\u003eflatMap\u003c/code\u003e in the Swift standard library monads? The \u003ccode\u003eOptional\u003c/code\u003e version always is. The \u003ccode\u003eSequence\u003c/code\u003e version of \u003ccode\u003eflatMap\u003c/code\u003e is monadic when used with \u003ccode\u003eArray\u003c/code\u003e but otherwise is not. Monads have a requirement that the input, output and intermediate containers all be the same kind and Swift – without higher kinded types – couldn\u0026rsquo;t enforce this, even if it wanted.\u003c/p\u003e\n\n\u003cp\u003eFor the purpose of \u003ccode\u003eflatMap\u003c/code\u003e, it appears that \u003ccode\u003eOptional\u003c/code\u003e is treated as a collection and is permitted to be mixed and matched like any other collection. This bothers some people but personally, I think it makes sense. I\u0026rsquo;ve always been more concerned by the naming problem caused by the fact that \u003ccode\u003eflatMap(x)\u003c/code\u003e needs to be read backwards. The function is really \u003ccode\u003eflatten(map(x))\u003c/code\u003e – a map and then a flatten – which would be more correctly transcribed as \u003ccode\u003emapFlatten\u003c/code\u003e. Like monoids, English isn\u0026rsquo;t commutative.\u003c/p\u003e\n",
            "date_published": "2017-06-30T00:00:22+10:00"
        }
        
        , {
            "title": "Statements, messages and reducers",
            "id": "https://www.cocoawithlove.com/blog/statements-messages-reducers.html",
            "url": "https://www.cocoawithlove.com/blog/statements-messages-reducers.html",
            "content_html": "\n\n\u003cp\u003eCommon advice when improving the design of a program is to break the programs into small isolated units of functionality so that we can consider the behavior within each component separately to the connections between components.\u003c/p\u003e\n\n\u003cp\u003eIf that\u0026rsquo;s the only advice you\u0026rsquo;re given though, it can be difficult to work out how to apply it in practice.\u003c/p\u003e\n\n\u003cp\u003eIn this article, I\u0026rsquo;ll show how this advice can be followed through the simple evolution of a piece of code, arriving at a pattern that is common in concurrent programming (but is useful across most stateful programs) where we build our program from three different tiers of computational unit: \u0026ldquo;statements\u0026rdquo;, \u0026ldquo;messages\u0026rdquo; and \u0026ldquo;reducers\u0026rdquo;.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eYou can \u003ca href=\"https://github.com/mattgallagher/CocoaWithLovePlaygrounds\"\u003edownload this article as a Swift Playground\u003c/a\u003e from github.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\n\u003ch2 id=\"aim\"\u003eAim\u003c/h2\u003e\n\n\u003cp\u003eThe purpose of this article is to show how to isolate state in your program. There are a number of reasons why we might want to do this:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eIf containment is clean, the behavior at a single location is easier to understand\u003c/li\u003e\n\u003cli\u003eIf containment is clean, it is easier to model and understand connections between components.\u003c/li\u003e\n\u003cli\u003eIf state is accessed at a single location, it is easy to move that location inside another execution context (like a queue, thread or simply within a mutex) and make your program threadsafe and asynchronous.\u003c/li\u003e\n\u003cli\u003eIf state can only be accessed in restricted ways, we can more carefully manage dependencies and keep everything up-to-date when dependencies change\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2 id=\"a-series-of-statements\"\u003eA series of statements\u003c/h2\u003e\n\n\u003cp\u003eA \u003cstrong\u003estatement\u003c/strong\u003e is the standard computational unit in an imperative programming language, like Swift. Statements include assigment, functions and control flow and may include effects (changes in state).\u003c/p\u003e\n\n\u003cp\u003eI know, I know, I\u0026rsquo;m explaining basic programming terminology to programmers; I\u0026rsquo;ll be brief.\u003c/p\u003e\n\n\u003cp\u003eHere\u0026rsquo;s a small program where the logic is built from statements:\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eprintCode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003escalar\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eUnicodeScalar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escalar\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;�\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003egrinning\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"mh\"\u003e0x1f600\u003c/span\u003e\n\u003cspan class=\"n\"\u003eprintCode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003egrinning\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003erollingOnTheFloorLaughing\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"mh\"\u003e0x1f600\u003c/span\u003e\n\u003cspan class=\"n\"\u003eprintCode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003erollingOnTheFloorLaughing\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003enotAValidScalar\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"mh\"\u003e0x999999\u003c/span\u003e\n\u003cspan class=\"n\"\u003eprintCode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enotAValidScalar\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003esmirkingFace\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"mh\"\u003e0x1f60f\u003c/span\u003e\n\u003cspan class=\"n\"\u003eprintCode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esmirkingFace\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003estuckOutTongueClosedEyes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"mh\"\u003e0x1f61d\u003c/span\u003e\n\u003cspan class=\"n\"\u003eprintCode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estuckOutTongueClosedEyes\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003cp\u003eThis will print each of the following on their own line: 😀 🤣 � 😏 😝\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eThe boxed question mark character is not a mistake, the code deliberately prints the Unicode replacement character (\u003ccode\u003e0xfffd\u003c/code\u003e) on failure to convert to a \u003ccode\u003eUnicodeScalar\u003c/code\u003e.\u003c/em\u003e\u003c/p\u003e\n\n\u003ch2 id=\"controlling-our-program-through-messages\"\u003eControlling our program through messages\u003c/h2\u003e\n\n\u003cp\u003eThe biggest problem with logic built purely from statements is that extending it with additional functionality is verbose. Looking for ways to eliminate verbosity naturally leads to code driven (at least in part) by data.\u003c/p\u003e\n\n\u003cp\u003eFor example, driving the previous example through data reduces the last 10 lines down to 4:\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ecodes\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x1f600\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mh\"\u003e0x1f923\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mh\"\u003e0x999999\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mh\"\u003e0x1f60f\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mh\"\u003e0x1f61d\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003ecodes\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"n\"\u003eprintCode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003cp\u003eHowever, this example is very simple and it might not be clear that it has really changed anything. We can increase the complexity of the example to make the difference clearer.\u003c/p\u003e\n\n\u003cp\u003eWe\u0026rsquo;ll modify our array to replace the basic \u003ccode\u003eInt\u003c/code\u003e values with a type that needs a little more handling.\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003eenum\u003c/span\u003e \u003cspan class=\"nc\"\u003eInstruction\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eincrement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"kr\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n   \u003cspan class=\"kd\"\u003estatic\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003einstrs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e...)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003einstrs\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003cp\u003eNow, instead of simply printing every \u003ccode\u003eInt\u003c/code\u003e value received, our handling requires maintaining an internal \u003ccode\u003eInt\u003c/code\u003e storage and different \u003ccode\u003eInstruction\u003c/code\u003e values may \u003ccode\u003e.set\u003c/code\u003e the storage, may \u003ccode\u003e.increment\u003c/code\u003e the storage or may request that the storage be \u003ccode\u003e.print\u003c/code\u003eed.\u003c/p\u003e\n\n\u003cp\u003eLet\u0026rsquo;s look at what code we might use to process the array of \u003ccode\u003eInstruction\u003c/code\u003e objects:\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003estruct\u003c/span\u003e \u003cspan class=\"nc\"\u003eInterpreter\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eprintCode\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003escalar\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eUnicodeScalar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n         \u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escalar\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n         \u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;�\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"kr\"\u003emutating\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003ehandleInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003e_\u003c/span\u003e \u003cspan class=\"n\"\u003einstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003einstruction\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eprintCode\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eincrement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kr\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003einterpreter\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eInterpreter\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003einstructions\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kr\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x1f600\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eincrement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x323\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eincrement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x999999\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kr\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x1f60f\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eincrement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mh\"\u003e0xe\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003einstructions\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"n\"\u003einterpreter\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehandleInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003cp\u003eThis code produces the same output as the previous example and uses a very similar \u003ccode\u003eprintCode\u003c/code\u003e function internally but it should be clear that the \u003ccode\u003eInterpreter\u003c/code\u003e struct is running a little mini-program defined by the \u003ccode\u003einstructions\u003c/code\u003e array.\u003c/p\u003e\n\n\u003cp\u003eIt should now be much clearer that our program\u0026rsquo;s logic is composed of logic on two different tiers:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eSwift statements in \u003ccode\u003ehandleInstruction\u003c/code\u003e and \u003ccode\u003eprintCode\u003c/code\u003e which interpret and execute each instruction\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003eInstructions.array\u003c/code\u003e which contains a sequence of messages that need to be interpreted\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eOur second tier of computational unit is the \u003cstrong\u003emessage\u003c/strong\u003e and it is any data which can be fed to a component in a stream, where the structure of data in the stream itself determines the result.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003eTerminology note\u003c/strong\u003e: I\u0026rsquo;m calling these instructions \u0026ldquo;messages\u0026rdquo;, following common terminology in \u003ca href=\"https://en.wikipedia.org/wiki/Process_calculus\"\u003eprocess calculus\u003c/a\u003e and the \u003ca href=\"https://en.wikipedia.org/wiki/Actor_model\"\u003eactor model\u003c/a\u003e, but the term \u0026ldquo;commands\u0026rdquo; is also sometimes used. In some cases, these messages may also be treated as a complete \u0026ldquo;domain specific language\u0026rdquo;.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2 id=\"structuring-logic-through-component-connections\"\u003eStructuring logic through component connections\u003c/h2\u003e\n\n\u003cp\u003eThe biggest problem with the previous code is that its structure does not aesthetically reflect the structure of the computation; it\u0026rsquo;s difficult to see at a glance what direction the logic flows.\u003c/p\u003e\n\n\u003cp\u003eWe need to consider what the structure of the computation really is. We\u0026rsquo;re trying to:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003etake a sequence of instructions\u003c/li\u003e\n\u003cli\u003econvert those instructions into sequence of effects on our internal state\u003c/li\u003e\n\u003cli\u003eemit further messages to a third stage that can \u003ccode\u003eprint\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eIt is possible to identify parts of the \u003ccode\u003eInterpreter\u003c/code\u003e struct that perform these tasks but that struct is not aethetically organized to reflect these three steps.\u003c/p\u003e\n\n\u003cp\u003eSo let\u0026rsquo;s refactor our code to something that directly shows the connection.\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nv\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kr\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x1f600\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eincrement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x323\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eincrement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x999999\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kr\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x1f60f\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eincrement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mh\"\u003e0xe\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\n\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eflatMap\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eincrement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kr\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}.\u003c/span\u003e\u003cspan class=\"n\"\u003eforEach\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003escalar\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eUnicodeScalar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escalar\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;�\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003cp\u003eOnce again, the code will print the same output as previous examples.\u003c/p\u003e\n\n\u003cp\u003eWe now have a three stage pipeline that directly reflects the 3 points above: a sequence of instructions, interpreting instructions and applying state effects, and the output phase.\u003c/p\u003e\n\n\u003ch2 id=\"reducers\"\u003eReducers\u003c/h2\u003e\n\n\u003cp\u003eLet\u0026rsquo;s look in particular at the \u003ccode\u003eflatMap\u003c/code\u003e stage in the middle of our pipeline. Why is it the most important?\u003c/p\u003e\n\n\u003cp\u003eIt\u0026rsquo;s not because of the \u003ccode\u003eflatMap\u003c/code\u003e function itself but because it is the only stage where I used a capturing closure. The \u003ccode\u003estate\u003c/code\u003e variable is captured and referenced exclusively by this stage, making the \u003ccode\u003estate\u003c/code\u003e value effectively a private variable of the \u003ccode\u003eflatMap\u003c/code\u003e closure. The state is only ever indirectly accessed from outside the \u003ccode\u003eflatMap\u003c/code\u003e stage – it is set by providing an input \u003ccode\u003eInstruction\u003c/code\u003e and it is accessed via \u003ccode\u003eInt\u003c/code\u003e values that the \u003ccode\u003eflatMap\u003c/code\u003e stage chooses to emit.\u003c/p\u003e\n\n\u003cp\u003eWe can model this stage like this:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/blog/reducer.svg\" alt=\"Figure 1: a diagram of a reducer, its state and messages\" /\u003e\u003c/p\u003e\n\n\u003cfigcaption\u003eA diagram of stage in a pipeline as a \"reducer\"\u003c/figcaption\u003e\n\n\u003cp\u003eEach of the \u003ccode\u003ea\u003c/code\u003e values in this diagram are the \u003ccode\u003eInstruction\u003c/code\u003e values. The \u003ccode\u003ex\u003c/code\u003e values are the \u003ccode\u003estate\u003c/code\u003e and the \u003ccode\u003eb\u003c/code\u003e values are the \u003ccode\u003eInt?\u003c/code\u003e emitted.\u003c/p\u003e\n\n\u003cp\u003eThis is called a \u003cstrong\u003ereducer\u003c/strong\u003e and it is the third tier of computational unit that I want to discuss. A reducer is an entity with identity (a reference type in Swift) and internal state that is accessed purely by incoming and outgoing messages.\u003c/p\u003e\n\n\u003cp\u003eWhen I say that reducers are the third tier of computation unit that I want to discuss, I\u0026rsquo;m excluding consideration of the contents of the reducer (which are typical Swift statements effecting the encapsulated state) and instead considering the reducer as a single black box unit defined by its connections to other units and suggesting that these boxes are how we can lay out higher level logic.\u003c/p\u003e\n\n\u003cp\u003eAnother way of explaining this is while statements perform logic \u003cem\u003ewithin\u003c/em\u003e an execution context, reducers form logic by spanning between execution contexts.\u003c/p\u003e\n\n\u003cp\u003eI used a capturing closure to ad hoc a reducer from a \u003ccode\u003eflatMap\u003c/code\u003e function and an \u003ccode\u003eInt\u003c/code\u003e variable but most reducers are \u003ccode\u003eclass\u003c/code\u003e instances that maintain their state a little more tightly and assist with integration into a larger graph.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eI\u0026rsquo;m using the term \u0026ldquo;reducer\u0026rdquo; to describe this type of construct. My definition is more accurately an Agent or Actor with \u003ca href=\"https://en.wikipedia.org/wiki/Operational_semantics#Reduction_semantics\"\u003ereduction semantics\u003c/a\u003e. In a weird terminology twist, \u0026ldquo;reducers\u0026rdquo; are also called \u0026ldquo;accumulators\u0026rdquo;, despite those words being near opposites. It\u0026rsquo;s a matter of perspective: a \u0026ldquo;reducer\u0026rdquo; reduces the incoming stream of messages down to a single state value; while an \u0026ldquo;accumulator\u0026rdquo; accumulates new information in its state over time by incorporating each incoming message as it arrives.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2 id=\"where-do-we-go-from-here\"\u003eWhere do we go from here?\u003c/h2\u003e\n\n\u003cp\u003eWe can replace the reducer abstractions with very different kinds of machinery.\u003c/p\u003e\n\n\u003cp\u003eWe could migrate our previous code, which operates on a Swift \u003ccode\u003eArray\u003c/code\u003e of values to the CwlSignal reactive programming framework with effort that is barely more than drag and drop. This would give us access to asynchronous capabilities or true communication channels between different parts of our program.\u003c/p\u003e\n\n\u003cp\u003eHere\u0026rsquo;s how it looks:\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"chroma\"\u003e\u003ccode class=\"language-swift\" data-lang=\"swift\"\u003e\u003cspan class=\"n\"\u003eSignal\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalues\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kr\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x1f600\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eincrement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x323\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eincrement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x999999\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kr\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mh\"\u003e0x1f60f\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eincrement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mh\"\u003e0xe\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\n\u003cspan class=\"p\"\u003e]).\u003c/span\u003e\u003cspan class=\"n\"\u003efilterMap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einitialState\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003einout\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eInstruction\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eInt\u003c/span\u003e\u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eincrement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kr\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}.\u003c/span\u003e\u003cspan class=\"n\"\u003esubscribeValuesAndKeepAlive\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e \u003cspan class=\"k\"\u003ein\u003c/span\u003e\n   \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nv\"\u003escalar\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eUnicodeScalar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003escalar\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"bp\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;�\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\u003cp\u003eThe \u003ccode\u003efilterMap\u003c/code\u003e function here is more ideally suited as a reducer since it offers truly private internal state as part of the API – no more captured variables required to establish private state - otherwise it is semantically equivalent to the previous \u003ccode\u003eflatMap\u003c/code\u003e as it maps over the sequences of values in the signal and filters out optionals.\u003c/p\u003e\n\n\u003cp\u003eThis simple change between abstractions is possible because the contents of the reducer are dependent on the messages, not the reducer machinery itself.\u003c/p\u003e\n\n\u003cp\u003eAs for any additional tiers of computational unit beyond reducers? I don\u0026rsquo;t know, I haven\u0026rsquo;t encountered any. We\u0026rsquo;ve addressed the issue of state encapsulation so any additional tier would be to address a new issue. But if artificial neural networks can have \u0026ldquo;Deep Learning\u0026rdquo;, then why can\u0026rsquo;t programming have \u0026ldquo;Deep Semantics\u0026rdquo;? Clearly, it\u0026rsquo;s the future 😉.\u003c/p\u003e\n\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eYou can \u003ca href=\"https://github.com/mattgallagher/CocoaWithLovePlaygrounds\"\u003edownload this article as a Swift Playground\u003c/a\u003e from github.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eThe lesson here is that the most natural way to break a program into small, isolated components is to organize your program in three different tiers:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003estateful code isolated in reducers with access limited to messages in and messages out\u003c/li\u003e\n\u003cli\u003emessages which act to program reducers into a given state\u003c/li\u003e\n\u003cli\u003egraph structure formed by reducers lays out the higher level logic of the program\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eNone of this is new advice; this all originates in concurrent computation theory from mid-1970s and the advice hasn\u0026rsquo;t changed substantially since the early 1990s when \u0026ldquo;reduction semantics\u0026rdquo; were formalized.\u003c/p\u003e\n\n\u003cp\u003eOf course, that doesn\u0026rsquo;t mean that people always follow good advice. Object-oriented programming was the hammer that people used to try and solve every programming problem though the 1990s and early 2000s and while you can build a reducer from an object, that doesn\u0026rsquo;t mean that all objects are reducers. Unrestricted interfaces on objects can make state, dependencies and interface coupling into a maintenance nightmare.\u003c/p\u003e\n\n\u003cp\u003eHowever, it is straightforward to model your objects as reducers by simplifying the public interface down to:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ea constructor\u003c/li\u003e\n\u003cli\u003ea single function for messages-in\u003c/li\u003e\n\u003cli\u003ea way to subscribe or otherwise connect messages-out\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIt\u0026rsquo;s a situation where \u003cem\u003elimiting\u003c/em\u003e the functionality of an interface will greatly improve the ability to maintain and iterate the design.\u003c/p\u003e\n\n\u003ch3 id=\"looking-forward\"\u003eLooking forward\u0026hellip;\u003c/h3\u003e\n\n\u003cp\u003eIn the example in the \u003ca href=\"#structuring-logic-through-component-connections\"\u003eStructuring logic through component connections\u003c/a\u003e section, I used the controversial definition of \u003ccode\u003eflatMap\u003c/code\u003e (the one that is never a monad). In my next article, I\u0026rsquo;m going to talk about why monads are considered a fundamental unit of computation to many functional programmers yet a strict implementation in imperative programming is sometimes less useful than transforms which aren\u0026rsquo;t quite monads.\u003c/p\u003e\n",
            "date_published": "2017-06-22T00:14:22+10:00"
        }
        
        , {
            "title": "Looking at Model-View-Controller in Cocoa",
            "id": "https://www.cocoawithlove.com/blog/mvc-and-cocoa.html",
            "url": "https://www.cocoawithlove.com/blog/mvc-and-cocoa.html",
            "content_html": "\n\n\u003cp\u003eAccording to Apple\u0026rsquo;s documentation, the standard pattern for Cocoa applications is called Model-View-Controller. Despite the name, this pattern is quite unlike the original definition of Model-View-Controller in Smalltalk-80. Cocoa\u0026rsquo;s application design pattern actually shares more in common with ideas developed at Taligent (an Apple co-developed project from the 1990s) than with the original Smalltalk origin of the term.\u003c/p\u003e\n\n\u003cp\u003eIn this article, I\u0026rsquo;ll look at a little theory and history behind the primary application design pattern used in Cocoa. I\u0026rsquo;ll discuss the key shortcoming of Cocoa\u0026rsquo;s Model-View-Controller approach, Apple\u0026rsquo;s aborted efforts to address this shortcoming and wonder from where the next major improvements will come.\u003c/p\u003e\n\n\u003cp\u003e\u003c/p\u003e\n\n\u003ch2 id=\"smalltalk-80\"\u003eSmalltalk-80\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eProbably the widest quoted pattern in UI development is Model View Controller (MVC) - it\u0026rsquo;s also the most misquoted. I\u0026rsquo;ve lost count of the times I\u0026rsquo;ve seen something described as MVC which turned out to be nothing like it. \u003cstrong\u003e- Martin Fowler, \u003ca href=\"https://www.martinfowler.com/eaaDev/uiArchs.html\"\u003eGUI Architectures\u003c/a\u003e\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eI want to quickly address what Martin Fowler means in the above quote since, by the definition Fowler uses – the definition originally used by Smalltalk-80 – the approach commonly used to develop Cocoa apps is not Model-View-Controller.\u003c/p\u003e\n\n\u003cp\u003eIn Smalltalk-80, interactive views were split into two completely separate objects: the View object and the Controller object. The View object performed display but any click or interaction wasn\u0026rsquo;t handled by the View object and was instead dispatched by the partner Controller object. The important point to understand is that the Controller didn\u0026rsquo;t load, setup or manage the View, nor did one Controller handle actions for multiple Views; in the original definition of Model-View-Controller, the View and Controller were simply the action and display aspects of a single control on screen.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/blog/smalltalk_mvc.svg\" alt=\"Smalltalk's version of Model-View-Controller\" /\u003e\u003c/p\u003e\n\n\u003cfigcaption\u003eSmalltalk-80's version of Model-View-Controller\u003c/a\u003e\u003c/figcaption\u003e\n\n\u003cp\u003eThe diagram of Smalltalk-80\u0026rsquo;s Model-View-Controller shows the \u003cem\u003emodel\u003c/em\u003e as the central component of the object graph, with communication primarily occurring between the model and the view or controller directly.\u003c/p\u003e\n\n\u003cp\u003eThis precise pattern reflects how Smalltalk-80 processed user-input and there\u0026rsquo;s little need to use this precise pattern in modern programs. In that sense, either no modern framework is really Model-View-Controller, or the definition of the term has changed to mean something else.\u003c/p\u003e\n\n\u003ch2 id=\"cocoa-appkit-uikit\"\u003eCocoa (AppKit/UIKit)\u003c/h2\u003e\n\n\u003cp\u003eWhen Cocoa says Model-View-Controller it\u0026rsquo;s mostly trying to evoke the notion of \u003ca href=\"https://en.wikipedia.org/wiki/Separation_of_presentation_and_content\"\u003eSeparated Presentation and Content\u003c/a\u003e in application design (the idea that the model and view should have a decoupled design and be loosely linked at construction). To be fair, it\u0026rsquo;s not just Cocoa that uses Model-View-Controller in this way: \u003cem\u003emost\u003c/em\u003e modern uses of the term are really intended to convey Separated Presentation rather than the original Smalltalk-80 definition.\u003c/p\u003e\n\n\u003cp\u003eLooking at the precise pattern Cocoa actually uses, Apple\u0026rsquo;s Cocoa reference guides use a definition of \u003ca href=\"https://developer.apple.com/library/content/documentation/General/Conceptual/DevPedia-CocoaCore/MVC.html\"\u003eModel-View-Controller\u003c/a\u003e that looks like this:\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/blog/cocoa_mvc.svg\" alt=\"Cocoa's version of Model-View-Controller\" /\u003e\u003c/p\u003e\n\n\u003cfigcaption\u003eCocoa's version of Model-View-Controller\u003c/a\u003e\u003c/figcaption\u003e\n\n\u003cp\u003eThe important point to note is that the controller is the center of the object graph with most communication passing \u003cem\u003evia\u003c/em\u003e the controller – distinct from the Smalltalk-80 version where the \u003cem\u003emodel\u003c/em\u003e was the center of the graph.\u003c/p\u003e\n\n\u003cp\u003eCocoa doesn\u0026rsquo;t \u003cem\u003eforce\u003c/em\u003e this pattern on apps but it is strongly implied by all application templates. Loading from NIB files strongly encourages the use of \u003ccode\u003eNSWindowController\u003c/code\u003e/\u003ccode\u003eUIViewController\u003c/code\u003e. The delegate requirements of \u003ccode\u003eNSTableView\u003c/code\u003e/\u003ccode\u003eUITableView\u003c/code\u003e and related classes strongly imply a coordinator class that understands responsibilities of the entire presentation. Classes like \u003ccode\u003eUITabBarController\u003c/code\u003e and \u003ccode\u003eUINavigationController\u003c/code\u003e explicitly require instances of \u003ccode\u003eUIViewController\u003c/code\u003e to coordinate views as they are swapped in and out.\u003c/p\u003e\n\n\u003ch2 id=\"taligent\"\u003eTaligent\u003c/h2\u003e\n\n\u003cp\u003eIn academic discussions, the pattern that Cocoa calls Model-View-Controller is usually called \u003ca href=\"https://en.wikipedia.org/wiki/Model–view–presenter\"\u003eModel-View-Presenter\u003c/a\u003e. The two are identical except that what Cocoa calls Controllers are instead called Presenters. The name \u0026ldquo;Presenter\u0026rdquo; reflects their role setting up the scene and coordinating the action. In some cases, the Presenter object may be called a \u0026ldquo;Supervising Controller\u0026rdquo; – you can understand why \u0026ldquo;Model-View-Supervising Controller\u0026rdquo; might get simplified back down to Model-View-Controller again.\u003c/p\u003e\n\n\u003cp\u003eThe term Model-View-Presenter originated in the \u003ca href=\"https://en.wikipedia.org/wiki/Taligent\"\u003eTaligent\u003c/a\u003e project. The most commonly cited paper is \u003ca href=\"http://www.wildcrest.com/Potel/Portfolio/mvp.pdf\"\u003e\u0026ldquo;MVP: Model-View-Presenter, The Taligent Programming Model for C++ and Java\u0026rdquo;\u003c/a\u003e from 1997 but Taligent\u0026rsquo;s classes for implementing this model were \u003ca href=\"https://root.cern.ch/TaligentDocs/TaligentOnline/DocumentRoot/1.0/Docs/classes/TGUIPresenter.html\"\u003edocumented at least as early as 1995\u003c/a\u003e.\u003c/p\u003e\n\n\u003cdiv class=\"aside\"\u003e\u003ca href=\"https://www.wired.com/1993/02/taligent/\"\u003eThis Wired article from 1993\u003c/a\u003e gives an interesting insight into Taligent and the apparent bloat and infighting that doomed it.\u003c/div\u003e\n\n\u003cp\u003eTaligent was a company originally started within Apple as a project code-named \u0026ldquo;Pink\u0026rdquo; (after the color of index cards used for its ideas) to provide an operating system replacement for \u003ca href=\"https://en.wikipedia.org/wiki/System_7\"\u003eSystem 7\u003c/a\u003e (which was mapped out on \u0026ldquo;Blue\u0026rdquo; index cards). The project had a series of famous development and management problems during which Apple withdrew and focussed on the equally doomed \u003ca href=\"https://en.wikipedia.org/wiki/Copland_(operating_system)\"\u003eCopland\u003c/a\u003e project. Taligent was continued at IBM where it was released as a series of application frameworks named CommonPoint, rather than an operating system, before being shut down in 1998.\u003c/p\u003e\n\n\u003cdiv class=\"aside\"\u003eThe \u003ca href=\"https://root.cern.ch/TaligentDocs/TaligentOnline/DocumentRoot/1.0/Docs/books/index.html\"\u003eTaligent documentation\u003c/a\u003e, from 1995, is fascinating to read. The \u003ca href=\"https://root.cern.ch/TaligentDocs/TaligentOnline/DocumentRoot/1.0/Docs/books/WM/WM_3.html\"\u003eGuide to Designing Programs\u003c/a\u003e discusses many ideas relevant to application design, 22 years later. However, the \u003ca href=\"https://root.cern.ch/TaligentDocs/TaligentOnline/DocumentRoot/1.0/Docs/books/PF/PF_1.html\"\u003eProgramming with the Presentation Framework tutorial\u003c/a\u003e is horrifically bad: baffling, over-technical and unapproachable.\u003c/div\u003e\n\n\u003cp\u003eWhile NeXTStep predates Taligent, the controller classes in AppKit – which are now \u003cem\u003edefining\u003c/em\u003e aspect of AppKit\u0026rsquo;s Model-View-Controller design pattern – did not appear until NeXTStep 4 in 1996 (a major redesign of NeXTStep and the first NeXTStep version to incorporate the \u003ccode\u003eNS\u003c/code\u003e prefix that remains in macOS until this day). I don\u0026rsquo;t know that NeXTStep borrowed directly from Taligent – it\u0026rsquo;s possible this is simply a case of convergent evolution or multiple companies hiring from the same talent pool. All I can really tell from my 2017 vantage point is that Taligent published first.\u003c/p\u003e\n\n\u003ch2 id=\"the-controller-problem\"\u003eThe Controller Problem\u003c/h2\u003e\n\n\u003cp\u003eUnderstanding Cocoa\u0026rsquo;s Model-View-Controller as a variation on the Model-View-Presenter pattern – where the Presenter or Supervising Controller is responsible for the lifecycle, action and change propagations of all of the views under it in the scene – is important since it leads to the largest problem in the pattern: the \u0026ldquo;Controller Problem\u0026rdquo;.\u003c/p\u003e\n\n\u003cp\u003eThe Controller Problem, also called \u0026ldquo;Massive/Huge/Giant View Controllers\u0026rdquo;, is the problem where controllers in Cocoa have a horrible tendency to grow large by taking on a number of separate responsibilities that are primarily related by co-location in the view – not necessarily by any functional or data dependencies. Most non-trivial projects have a handful of controllers in the 2000 lines range or larger.\u003c/p\u003e\n\n\u003cp\u003eLet me be clear: it\u0026rsquo;s not the size alone that\u0026rsquo;s the problem here but the \u003cem\u003eway\u003c/em\u003e that controllers grow this big that\u0026rsquo;s concerning: \u003cstrong\u003econtrollers in Cocoa are an aggregation of responsibilities that may or may not be related\u003c/strong\u003e. A view controller may be responsible for a half-dozen or more views and each one may have construction, configuration, data display, data updating, layout, animation and action and other state maintenance responsibilities that end up in the parent view controller.\u003c/p\u003e\n\n\u003cp\u003eThat mix of independent and interdependent responsibilities at substantial scale is a maintenance nightmare. The large quantity of code blobs makes actual dependencies and interrelated functionality difficult to find. Controllers are always difficult to test (due to significant app and bundle state dependencies making isolation difficult) but the problems of scale and semi-dependence compound to make everything worse.\u003c/p\u003e\n\n\u003cp\u003eThe only solution to the Controller Problem is to continuously refactor large view controllers into multiple smaller, simpler controllers. This may involve redesigning or rethinking data structures to disentangle and eliminate dependencies that pass through the view controller and design sensible approaches to have multiple view controllers communicate. It can be done but it can involve lots of work, has all the normal risks of introducing bugs with each change, remains difficult to test (as with everything view controller related), yet despite all this, offers zero functionality gain for the end user.\u003c/p\u003e\n\n\u003ch2 id=\"bindings\"\u003eBindings\u003c/h2\u003e\n\n\u003cp\u003eApple have known about the Controller Problem for some time, as evidenced by their Mac OS X 10.3 introduction of Cocoa Bindings.\u003c/p\u003e\n\n\u003cdiv class=\"aside\"\u003eIf you'd like to learn more about Cocoa Bindings, read Apple's page \"\u003ca href=\"https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CocoaBindings/Concepts/WhatAreBindings.html\"\u003eWhat are Cocoa Bindings?\u003c/a\u003e\".\u003c/div\u003e\n\n\u003cp\u003eA binding is a runtime constructed path between two components. These components are usually a source of data and an observer of that data. The binding allows these components to communicate changes without needing any explicit code path. Instead, the path between the two components is defined in data – for Cocoa bindings, this is called a \u0026ldquo;key-path\u0026rdquo;. By specifying a key-path through the controller all the way to the model properties that govern the views\u0026rsquo; state, bindings can ameliorate the Controller Problem by dramatically reducing – or even eliminating – code paths through the controller.\u003c/p\u003e\n\n\u003cp\u003e\u003cimg src=\"/assets/blog/cocoa_bindings_mvc.svg\" alt=\"Cocoa's Model-View-Controller with Bindings\" /\u003e\u003c/p\u003e\n\n\u003cfigcaption\u003eCode paths through the Controller are replaced by Bindings\u003c/a\u003e\u003c/figcaption\u003e\n\n\u003cp\u003eMore than a decade after their introduction, Cocoa Bindings remain all-but-forgotten. You can still use bindings in AppKit (they were never deprecated) but they were never introduced to UIKit, reflecting an impression that they never quite succeeded in their aim of making view programming easier.\u003c/p\u003e\n\n\u003cp\u003eI think Bindings attacked a problem that needed attacking and in some cases could work really well – especially when combined with \u003ccode\u003eNSArrayController\u003c/code\u003e to drive an \u003ccode\u003eNSTableView\u003c/code\u003e – but I can understand why they didn\u0026rsquo;t take over Mac programming.\u003c/p\u003e\n\n\u003cp\u003eThe key advantage of Cocoa Bindings (less code in your view controller) was achieved by a large amount of configuration in Interface Builder inspector panels. This can be confusing if you\u0026rsquo;re looking for functionality in your code (it\u0026rsquo;s not \u003cem\u003ein\u003c/em\u003e your code), can be difficult to search (although Xcode\u0026rsquo;s project-wide searching eventually gained the ability to search XIB files), difficult to debug (model data changes without the stack trace passing through your code), is very difficult to teach to newcomers who are unlikely to want to search through the inspector panels, can be even more cryptic than staring at code (you can\u0026rsquo;t add comments or restructure a XIB file) and can fall victim to annoying Interface Builder issues like localization mixups and version control merge issues.\u003c/p\u003e\n\n\u003cp\u003eIn my opinion, the critical failing for Cocoa Bindings remains the difficulty in adding custom transformations and custom properties. These could both be done but the work involved in registering transformers and exposing bindings dictionaries made a tiresome affair. It always just seemed easier to pass the data through the view controller without bindings. This meant that Bindings tended to help the \u003cem\u003esimplest\u003c/em\u003e problems (that didn\u0026rsquo;t need much help) but didn\u0026rsquo;t have much impact on the harder problems.\u003c/p\u003e\n\n\u003ch2 id=\"something-new\"\u003eSomething new?\u003c/h2\u003e\n\n\u003cp\u003eSince Cocoa Bindings in Mac OS X 10.3, there haven\u0026rsquo;t really been \u003cem\u003eany\u003c/em\u003e clear attempts by Apple to alter the design pattern used for Cocoa apps.\u003c/p\u003e\n\n\u003cp\u003eWe did get Storyboards in iOS 5 and Mac OS X 10.10 but storyboards aren\u0026rsquo;t really an attempt to \u003cem\u003echange\u003c/em\u003e the design pattern as much as they are an attempt to facilitate the existing design pattern. Storyboards re-inforce the Model-View-Presenter design pattern by encouraging use of \u003ccode\u003eNS\u003c/code\u003e/\u003ccode\u003eUIViewController\u003c/code\u003e. Storyboards do help by encouraging smaller more focussed view controllers and very slightly reducing the \u0026ldquo;Presentation\u0026rdquo; burden of setup and transition. However, since they are configured in Interface Builder, they do exhibit a number of the issues that affected Cocoa Bindings.\u003c/p\u003e\n\n\u003cp\u003eFor those of us hoping for something more ambitious in application design patterns, Storyboards don\u0026rsquo;t offer much that\u0026rsquo;s new.\u003c/p\u003e\n\n\u003cp\u003eNew ideas in application design do exist. Outside Apple, we have options like \u003ca href=\"/blog/reactive-programming-what-and-why.html\"\u003eReactive Programming\u003c/a\u003e (which can fulfill most the role of Bindings if we choose), \u003ca href=\"https://www.objc.io/issues/13-architecture/mvvm/\"\u003eModel-View-ViewModel\u003c/a\u003e (which reduces the work for a controller by bringing a transformed section of the model closer to the view), \u003ca href=\"http://reswift.github.io/ReSwift/master/\"\u003eunidirectional dataflow\u003c/a\u003e (which reduces the need for binding by forcing data changes through a single reducer and broadcasting all data changes to the whole app); all of which are popular within different circles.\u003c/p\u003e\n\n\u003cp\u003eThere are also frameworks for doing things radically differently, like \u003ca href=\"https://facebook.github.io/react-native/\"\u003eReact Native\u003c/a\u003e or \u003ca href=\"https://github.com/salutis/swift-elm\"\u003eSwift-Elm\u003c/a\u003e, although sacrificing Swift or Cocoa entirely comes with a significant set of drawbacks.\u003c/p\u003e\n\n\u003cp\u003eIt\u0026rsquo;s unclear if any of these will have an effect on official Cocoa app development. Swift proved that Apple are willing to dramatically shake things up occasionally and there\u0026rsquo;s an argument that Swift has increased the desire for a design pattern or view framework that takes advantage of aspects of the Swift language. However, it will likely be some time before Apple are willing to introduce a major Swift-only framework.\u003c/p\u003e\n\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\n\u003cp\u003eIf we take NeXTStep 4 as the origin date for Cocoa\u0026rsquo;s current Model-View-Controller pattern then it is 20 years old this year. It\u0026rsquo;s not \u003cem\u003ebroken\u003c/em\u003e but it has its drawbacks and it doesn\u0026rsquo;t feel as exciting or efficient as it once did.\u003c/p\u003e\n\n\u003cp\u003eApple made its only significant effort to improve the design pattern, Cocoa Bindings, relatively early. Its reception was mixed and it has not been carried forward onto Apple\u0026rsquo;s newer platforms.\u003c/p\u003e\n\n\u003cp\u003eI don\u0026rsquo;t have any information about internal efforts by the AppKit or UIKit teams but it\u0026rsquo;s not immediately apparent that Apple are looking to make any dramatic changes any time soon. There are a number of possible design patterns employed in third-party frameworks which aim to improve the overall application design pattern in Cocoa but there doesn\u0026rsquo;t appear to be consensus that any one of these is necessarily the way forward. I do think these efforts reflect an interest in \u003cem\u003esome\u003c/em\u003e kind of improvement.\u003c/p\u003e\n",
            "date_published": "2017-02-28T19:49:56+11:00"
        }
        
    ]
}
